<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>卡鲁秋 - 前端小工具集合</title><link rel="icon" href="/toolbox-frontend/favicon.ico"/><meta name="next-head-count" content="4"/><link rel="stylesheet" href="/toolbox-frontend/styles/animate.css/@4.1.1/animate.css"/><link rel="preload" href="/toolbox-frontend/_next/static/css/e443953a41d4ccca.css" as="style"/><link rel="stylesheet" href="/toolbox-frontend/_next/static/css/e443953a41d4ccca.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/toolbox-frontend/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/toolbox-frontend/_next/static/chunks/webpack-c5f674d417b86779.js" defer=""></script><script src="/toolbox-frontend/_next/static/chunks/framework-aec4381329cec0e4.js" defer=""></script><script src="/toolbox-frontend/_next/static/chunks/main-82d23b26b43cd32b.js" defer=""></script><script src="/toolbox-frontend/_next/static/chunks/pages/_app-f3d697fda40e8318.js" defer=""></script><script src="/toolbox-frontend/_next/static/chunks/6396-e9161609a76be07a.js" defer=""></script><script src="/toolbox-frontend/_next/static/chunks/8490-2f2be535c5ee8413.js" defer=""></script><script src="/toolbox-frontend/_next/static/chunks/1664-f865873e77459860.js" defer=""></script><script src="/toolbox-frontend/_next/static/chunks/2555-3011663e4a0eccc6.js" defer=""></script><script src="/toolbox-frontend/_next/static/chunks/pages/questions/%5Bid%5D-276193ea31b022a9.js" defer=""></script><script src="/toolbox-frontend/_next/static/q3M24btTcV4I6am4xdDk6/_buildManifest.js" defer=""></script><script src="/toolbox-frontend/_next/static/q3M24btTcV4I6am4xdDk6/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex h-full min-h-[100vh] w-full flex-col" style="flex-direction:column;min-height:100vh"><main class="flex flex-1 grow-[1] flex-col" style="flex:1"><div class="flex h-full flex-1 flex-col" style="position:relative"><div class="flex space-x-6 bg-white p-6"><div class="flex-1"><div class="ant-card ant-card-bordered article-card min-h-full !border-[#d9d9d9] css-12jzuas"><div class="ant-card-body"><article><header><h1 class="mb-5 text-4xl font-bold">手写Promise</h1></header><section class="mb-12 flex items-center space-x-8"><div class="ant-space css-12jzuas ant-space-horizontal ant-space-align-center group cursor-pointer"><div class="ant-space-item" style="margin-right:8px"><span role="img" aria-label="branches" class="anticon anticon-branches group-hover:text-[#1171ee]"><svg viewBox="64 64 896 896" focusable="false" data-icon="branches" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"></path></svg></span></div><div class="ant-space-item"><span class="group-hover:text-[#1171ee]">#382</span></div></div><div class="ant-space css-12jzuas ant-space-horizontal ant-space-align-center group cursor-pointer"><div class="ant-space-item"><span class="group-hover:text-sky-500">hankliu62</span></div></div><div class="ant-space css-12jzuas ant-space-horizontal ant-space-align-center"><div class="ant-space-item"><span class="text-[#8a919f]">2024-02-12 08:42:05</span></div></div><div class="ant-space css-12jzuas ant-space-horizontal ant-space-align-center"><div class="ant-space-item"><div class="flex items-center justify-start"><span class="ant-tag ant-tag-has-color css-12jzuas" style="background-color:#faad14">handwritten</span></div></div></div></section><section><div><div class="ant-skeleton ant-skeleton-active css-12jzuas"><div class="ant-skeleton-content"><h3 class="ant-skeleton-title" style="width:38%"></h3><ul class="ant-skeleton-paragraph"><li></li><li></li><li style="width:61%"></li></ul></div></div></div></section></article></div></div></div><div class="w-64 bg-white"><div><div class=""><div class="ant-collapse ant-collapse-icon-position-end question-menus-collapse css-12jzuas"><div class="ant-collapse-item ant-collapse-item-active"><div class="ant-collapse-header" aria-expanded="true" aria-disabled="false" role="button" tabindex="0"><div class="ant-collapse-expand-icon"><span role="img" aria-label="right" class="anticon anticon-right ant-collapse-arrow"><svg viewBox="64 64 896 896" focusable="false" style="-ms-transform:rotate(90deg);transform:rotate(90deg)" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"></path></svg></span></div><span class="ant-collapse-header-text"><span class="text-base">目录</span></span><div class="ant-collapse-extra"><div class="-mr-2">收起</div></div></div><div class="ant-collapse-content ant-collapse-content-active"><div class="ant-collapse-content-box"><ul class="max-h-[620px] list-none space-y-3 overflow-y-auto text-slate-500 dark:text-slate-400"></ul></div></div></div></div></div></div></div></div></div><div style="position:fixed;z-index:9999;top:16px;left:16px;right:16px;bottom:16px;pointer-events:none"></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"issue":{"url":"https://api.github.com/repos/hankliu62/interview/issues/382","repository_url":"https://api.github.com/repos/hankliu62/interview","labels_url":"https://api.github.com/repos/hankliu62/interview/issues/382/labels{/name}","comments_url":"https://api.github.com/repos/hankliu62/interview/issues/382/comments","events_url":"https://api.github.com/repos/hankliu62/interview/issues/382/events","html_url":"https://github.com/hankliu62/interview/issues/382","id":2129651415,"node_id":"I_kwDOLNphd85-7-bX","number":382,"title":"手写Promise","user":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"labels":[{"id":6547468054,"node_id":"LA_kwDOLNphd88AAAABhkJvFg","url":"https://api.github.com/repos/hankliu62/interview/labels/handwritten","name":"handwritten","color":"faad14","default":false,"description":"手写题相关"}],"state":"open","locked":false,"assignee":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"assignees":[{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2024-02-12T08:42:05Z","updated_at":"2024-03-04T14:18:29Z","closed_at":null,"author_association":"OWNER","active_lock_reason":null,"body":"要实现一个符合 Promise/A+ 规范的 Promise，需要注意以下几个要点：\r\n\r\n1. 状态转移：Promise 可以处于三种状态之一，分别是“pending”（等待状态）、“fulfilled”（已完成状态）和“rejected”（已拒绝状态）。当 Promise 转移到已完成或已拒绝状态时，需要保证状态不可逆转。\r\n2. 异步处理：Promise 可以处理异步操作，例如使用定时器或者在事件回调中执行异步代码。需要确保在异步操作完成之后，Promise 状态可以正确地转移。\r\n3. 链式调用：Promise 支持链式调用，也就是说每次调用 then() 方法后，都会返回一个新的 Promise。在 Promise 链中，每个 Promise 的状态都会受到前一个 Promise 的影响，因此需要保证每个 Promise 都能正确处理自己的状态。\r\n4. 错误处理：当 Promise 被拒绝时，可以通过 catch() 方法或在 then() 方法中传入第二个参数来处理错误。需要保证错误能够正确地冒泡，并且能够捕获到所有可能出现的错误。\r\n5. 静态方法：Promise 还有一些静态方法，例如 Promise.all()、Promise.race()、Promise.resolve() 和 Promise.reject() 等。这些方法与实例方法有所不同，需要额外注意实现。\r\n6. 链式调用的值传递：在链式调用中，每个 then() 方法可以返回一个值或一个新的 Promise。如果返回一个值，后续的 then() 方法应该接收到这个值。如果返回一个新的 Promise，后续的 then() 方法应该等待这个 Promise 完成，并接收到它的结果。\r\n\r\n``` javascript\r\nclass MyPromise {\r\n  constructor(executor) {\r\n    this.state = 'pending';\r\n    this.value = null;\r\n    this.reason = null;\r\n    this.onResolvedCallbacks = [];\r\n    this.onRejectedCallbacks = [];\r\n\r\n    const resolve = (value) =\u003e {\r\n      if (this.state === 'pending') {\r\n        this.state = 'fulfilled';\r\n        this.value = value;\r\n        this.onResolvedCallbacks.forEach(callback =\u003e callback(value));\r\n      }\r\n    }\r\n\r\n    const reject = (reason) =\u003e {\r\n      if (this.state === 'pending') {\r\n        this.state = 'rejected';\r\n        this.reason = reason;\r\n        this.onRejectedCallbacks.forEach(callback =\u003e callback(reason));\r\n      }\r\n    }\r\n\r\n    try {\r\n      executor(resolve, reject);\r\n    } catch (error) {\r\n      reject(error);\r\n    }\r\n  }\r\n\r\n  then(onResolved, onRejected) {\r\n    onResolved = typeof onResolved === 'function' ? onResolved : value =\u003e value;\r\n    onRejected = typeof onRejected === 'function' ? onRejected : reason =\u003e { throw reason };\r\n\r\n    const promise = new MyPromise((resolve, reject) =\u003e {\r\n      const handle = (callback, state) =\u003e {\r\n        try {\r\n          const result = callback(this.value);\r\n          if (result instanceof MyPromise) {\r\n            result.then(resolve, reject);\r\n          } else {\r\n            state(result);\r\n          }\r\n        } catch (error) {\r\n          reject(error);\r\n        }\r\n      }\r\n\r\n      if (this.state === 'fulfilled') {\r\n        setTimeout(() =\u003e handle(onResolved, resolve), 0);\r\n      } else if (this.state === 'rejected') {\r\n        setTimeout(() =\u003e handle(onRejected, reject), 0);\r\n      } else {\r\n        this.onResolvedCallbacks.push(() =\u003e handle(onResolved, resolve));\r\n        this.onRejectedCallbacks.push(() =\u003e handle(onRejected, reject));\r\n      }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  catch(onRejected) {\r\n    return this.then(null, onRejected);\r\n  }\r\n\r\n  static resolve(value) {\r\n    return new MyPromise(resolve =\u003e resolve(value));\r\n  }\r\n\r\n  static reject(reason) {\r\n    return new MyPromise((_, reject) =\u003e reject(reason));\r\n  }\r\n\r\n  static all(promises) {\r\n    return new MyPromise((resolve, reject) =\u003e {\r\n      const results = [];\r\n      let count = 0;\r\n\r\n      const handleResult = (index, value) =\u003e {\r\n        results[index] = value;\r\n        count++;\r\n        if (count === promises.length) {\r\n          resolve(results);\r\n        }\r\n      }\r\n\r\n      for (let i = 0; i \u003c promises.length; i++) {\r\n        promises[i].then(value =\u003e handleResult(i, value), reject);\r\n      }\r\n    });\r\n  }\r\n\r\n  static race(promises) {\r\n    return new MyPromise((resolve, reject) =\u003e {\r\n      for (let i = 0; i \u003c promises.length; i++) {\r\n        promises[i].then(resolve, reject);\r\n      }\r\n    });\r\n  }\r\n}\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/hankliu62/interview/issues/382/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hankliu62/interview/issues/382/timeline","performed_via_github_app":null,"state_reason":null},"menus":[]},"__N_SSG":true},"page":"/questions/[id]","query":{"id":"382"},"buildId":"q3M24btTcV4I6am4xdDk6","assetPrefix":"/toolbox-frontend","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>