<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>卡鲁秋 - 前端小工具</title><link rel="icon" href="/toolkit/favicon.ico"/><meta name="description" content="卡鲁秋的前端工具网站，提供了一系列实用的前端开发工具和功能，技术网站汇总，旨在帮助开发者更加高效地进行前端开发。"/><meta name="keywords" content="前端工具,前端开发,前端开发工具,前端开发工具集合,toolbox,frontend,卡鲁秋,Hank,HankLiu"/><meta name="author" content="Hank.Liu"/><meta name="next-head-count" content="7"/><link rel="stylesheet" href="/toolkit/styles/animate.css/@4.1.1/animate.css"/><link rel="preload" href="/toolkit/_next/static/css/f5460a021fc371e8.css" as="style"/><link rel="stylesheet" href="/toolkit/_next/static/css/f5460a021fc371e8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/toolkit/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/toolkit/_next/static/chunks/webpack-ce7c55ca7efa7362.js" defer=""></script><script src="/toolkit/_next/static/chunks/framework-aec4381329cec0e4.js" defer=""></script><script src="/toolkit/_next/static/chunks/main-65c03d41a91f9ca8.js" defer=""></script><script src="/toolkit/_next/static/chunks/pages/_app-663e05d45e239ea8.js" defer=""></script><script src="/toolkit/_next/static/chunks/9691-52831ba1a45a37ee.js" defer=""></script><script src="/toolkit/_next/static/chunks/8490-9c9cad1e305c687c.js" defer=""></script><script src="/toolkit/_next/static/chunks/1664-f865873e77459860.js" defer=""></script><script src="/toolkit/_next/static/chunks/pages/articles/%5Bid%5D-b6bd1d5b4743d958.js" defer=""></script><script src="/toolkit/_next/static/01n3oM-TaM2WlnAyxyv2V/_buildManifest.js" defer=""></script><script src="/toolkit/_next/static/01n3oM-TaM2WlnAyxyv2V/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex h-full min-h-[100vh] w-full flex-col" style="flex-direction:column;min-height:100vh"><main class="flex flex-1 grow-[1] flex-col" style="flex:1"><div class="flex h-full flex-1 flex-col" style="position:relative"><div class="flex space-x-6 bg-white p-6"><div class="flex-1 overflow-x-hidden"><div class="ant-card ant-card-bordered article-card min-h-full !border-[#d9d9d9] css-12jzuas"><div class="ant-card-body"><article><div class="mx-auto mb-[36px] max-w-[1045px] px-[30px] lg:mb-[52px] lg:flex lg:px-0"><div id="banner" class="media-wrapper image-media-wrapper w-full overflow-hidden rounded-[8px] border-[1px] border-solid border-[#1D2129] lg:ml-0 lg:h-[320px] lg:w-[500px]"><div class="hidden before"></div><div class="hidden after"></div><div class="scale-103 h-full w-full border-[8px] border-solid border-white lg:scale-100 cover-wrapper"><img class="h-full w-full rounded-md object-cover cover" src="/toolkit/dashboard/images/banner.png" alt=""/></div></div><div class="mt-[60px] overflow-hidden lg:ml-[32px] lg:mt-0 lg:flex-1"><h1 class="leading-130 montserrat-bold mb-[9px] text-[36px] font-medium text-[#1D2129] lg:mb-[8px]">Nginx常用基础配置详解</h1><div class="mb-[9px] flex whitespace-nowrap lg:mb-[10px]"><div class="leading-120 cursor-pointer truncate text-[24px] font-normal text-[#1D2129] underline-offset-2 hover:underline lg:text-[20px]" aria-hidden="true"># VOL.<!-- -->651</div><div class="leading-120 ml-[48px] text-[24px] font-normal text-[#1D2129] lg:ml-[32px] lg:text-[20px]">2024/04/08</div></div><div class="mb-[12px] flex flex-wrap lg:mb-0"><div class="leading-150 mb-[12px] mr-[18px] rounded-[30px] border border-solid border-[#1D2129] px-[24px] py-[6px] text-[20px] font-normal text-[#1D2129] lg:mb-[12px] lg:mr-[10px] lg:rounded-[20px] lg:px-[16px] lg:py-[4px] lg:text-[14px]">blog</div><div class="leading-150 mb-[12px] mr-[18px] rounded-[30px] border border-solid border-[#1D2129] px-[24px] py-[6px] text-[20px] font-normal text-[#1D2129] lg:mb-[12px] lg:mr-[10px] lg:rounded-[20px] lg:px-[16px] lg:py-[4px] lg:text-[14px]">nginx</div></div><div class="my-[30px] hidden w-[213px] border border-[#1D2129] lg:mb-[20px] lg:mt-[8px] lg:block"></div><div class="lg:rounded-0 rounded-[12px] bg-white/30 p-[36px] lg:flex lg:bg-transparent lg:p-0"><div class="float-left h-[118px] w-[118px] lg:float-none lg:h-[112px] lg:w-[112px]"><img src="https://avatars.githubusercontent.com/u/8088864?v=4" class="h-full w-full rounded-[8px] object-cover lg:rounded-[12px]" alt=""/></div><div class="lg:ml-[32px] lg:flex-1 lg:overflow-hidden"><div class="mb-[10px] flex h-[118px] flex-col justify-center pl-[36px] lg:h-auto lg:flex-row lg:items-center lg:justify-between lg:pl-0"><div class="leading-130 montserrat-bold mb-[12px] w-full truncate text-[30px] font-medium text-[#1D2129] lg:mb-0 lg:flex-1 lg:text-[24px]">hankliu62</div><a class="leading-170 ml-0 whitespace-pre-wrap text-[20px] font-normal !text-[#1D2129] !underline hover:!text-[#1D2129] hover:!underline focus:!text-[#1D2129] lg:ml-[5px] lg:text-[14px]" href="https://github.com/hankliu62" target="_blank" rel="noreferrer">TA的个人名片</a></div><div class="leading-170 text-[20px] font-normal text-[#4E5969] lg:text-[14px]">HankLiu前端开发工程师，精通前端，涉猎后端，对前端有着浓厚的兴趣，希望能够在前端这条路上一直走下去。努力去听风的声音，不必在意风的方向。</div></div></div></div></div><div class="ant-divider css-12jzuas ant-divider-horizontal !mt-0 !border-[#bfc3c7]" role="separator"></div><section><div><div class="ant-skeleton ant-skeleton-active css-12jzuas"><div class="ant-skeleton-content"><h3 class="ant-skeleton-title" style="width:38%"></h3><ul class="ant-skeleton-paragraph"><li></li><li></li><li style="width:61%"></li></ul></div></div></div></section></article></div></div></div><div class="w-64 bg-white"><div><div class=""><div class="ant-collapse ant-collapse-icon-position-end question-menus-collapse css-12jzuas"><div class="ant-collapse-item ant-collapse-item-active"><div class="ant-collapse-header" aria-expanded="true" aria-disabled="false" role="button" tabindex="0"><div class="ant-collapse-expand-icon"><span role="img" aria-label="right" class="anticon anticon-right ant-collapse-arrow"><svg viewBox="64 64 896 896" focusable="false" style="-ms-transform:rotate(90deg);transform:rotate(90deg)" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"></path></svg></span></div><span class="ant-collapse-header-text"><span class="text-base">目录</span></span><div class="ant-collapse-extra"><div class="-mr-2">收起</div></div></div><div class="ant-collapse-content ant-collapse-content-active"><div class="ant-collapse-content-box"><ul class="max-h-[620px] list-none space-y-3 overflow-y-auto text-slate-500 dark:text-slate-400"><li id="## Nginx常用基础配置详解

### 介绍

Nginx 是一个高性能的开源 Web 服务器，它不仅可以作为 HTTP 服务器使用，还可以用作反向代理服务器、负载均衡器、缓存服务器等。在实际应用中，正确配置 Nginx 是确保网站稳定性和性能的重要步骤。本文将详细介绍一些常用的 Nginx 基础配置，包括虚拟主机配置、HTTP 重定向、反向代理等内容，并提供详细的示例说明。

### 虚拟主机配置

虚拟主机是 Nginx 中非常重要的概念，它允许您在一台服务器上托管多个网站。下面是一个简单的虚拟主机配置示例：

```nginx
server {
    listen 80;
    server_name example.com www.example.com;

    root /var/www/example;
    index index.html index.htm;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

- **`listen 80;`**：指定 `Nginx` 监听的端口号。
- **`server_name example.com www.example.com;`**：指定虚拟主机的域名。
- **`root /var/www/example;`**：指定网站的根目录。
- **`index index.html index.htm;`**：指定默认的索引文件。
- **`location /`**：配置请求的 `URL` 路径。
- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。

### HTTP 重定向
HTTP 重定向是将一个 URL 请求重定向到另一个 URL 的过程。下面是一个简单的 HTTP 重定向配置示例：

``` nginx
server {
    listen 80;
    server_name www.example.com;

    return 301 http://example.com$request_uri;
}
```

这个配置会将所有访问 `www.example.com` 的请求重定向到 `example.com`，保证网站的访问统一性。

### 反向代理
`Nginx` 反向代理是将客户端的请求转发给后端服务器的过程，常用于负载均衡和隐藏后端服务器。下面是一个简单的反向代理配置示例：

``` nginx
server {
  listen 80;
  server_name www.example.com;

  location / {
    proxy_pass http://backend_server;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
```

- **`proxy_pass http://backend_server;`**：指定后端服务器的地址。
- **`proxy_set_header`**：设置代理请求的头部信息，如 `Host`、`X-Real-IP`、`X-Forwarded-For` 等。

### SSL/TLS 配置

`SSL/TLS` 是保护网站安全的重要手段，`Nginx` 提供了丰富的 `SSL/TLS` 配置选项。下面是一个简单的 `SSL/TLS` 配置示例：

``` nginx
server {
  listen                      80;
  server_name                 www.example.com;
  # 将 http 重定向转移到 https
  return 301 https://$server_name$request_uri;
}

server {
  listen                      443 ssl;
  server_name                 www.example.com;
  ssl_certificate             /etc/nginx/ssl/www.example.com.pem;
  ssl_certificate_key         /etc/nginx/ssl/www.example.com.key;
  ssl_session_timeout         10m;
  ssl_ciphers                 ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
  ssl_protocols               TLSv1 TLSv1.1 TLSv1.2;
  ssl_prefer_server_ciphers   on;

  location / {
    root                    /var/nginx/html;
    index                   index.html index.htm index.md;
    try_files               $uri $uri/ /index.html;
  }
}

```

- **`listen 443 ssl;`**：指定监听的端口号，并开启 SSL。
- **`ssl_certificate 和 ssl_certificate_key`**：指定 SSL 证书和私钥的路径。
- **`ssl_protocols`**：指定允许的 SSL/TLS 协议版本。
- **`ssl_prefer_server_ciphers on;`**：优先使用服务器端的加密算法。
- **`ssl_ciphers`**：指定允许的加密算法。

### 隐藏 Nginx 版本信息

要隐藏 `Nginx` 版本信息，您可以通过在配置文件中进行相应的设置来实现。具体来说，您需要修改 `nginx.conf` 文件，使用 `server_tokens off;` 指令来关闭 `Nginx` 的版本号显示。以下是如何进行配置的示例：

``` nginx
http {
  server_tokens off;
}
```

将上述配置添加到 `nginx.conf` 文件的 `http` 块中即可禁用 `Nginx` 版本号显示。

### 禁止 ip 直接访问 80 端口

要禁止直接通过 `IP` 地址访问 `80` 端口，您可以通过 `Nginx` 配置文件进行相应的设置。具体来说，您可以配置一个默认的 `server` 块，用于捕获所有请求，并返回一个错误页面或者重定向到其他地址。以下是一个示例配置：

``` nginx
server {
  listen 80 default_server;
  server_name _;

  return 444;
}
```

在这个配置中：

- **`listen 80 default_server;`**：指定 `Nginx` 监听默认的 `HTTP` 端口，并将此 `server` 块标记为默认服务器。
- **`server_name _;`**： 表示该 `server` 块将匹配所有请求。
- **`return 444;`**： 是一个特殊的 `Nginx` 返回指令，它会立即关闭客户端连接，相当于不做任何响应。

通过这样的配置，当有请求通过 `IP` 地址直接访问 `80` 端口时，`Nginx` 将返回一个 `444` 错误，不会提供任何内容，从而实现了禁止直接访问 `80` 端口的目的。

### 启动 web 服务 (react 项目为例)

``` nginx
server {
  # 项目启动端口
  listen            80;
  # 域名（localhost）
  server_name       _;
  # 禁止 iframe 嵌套
  add_header        X-Frame-Options SAMEORIGIN;

  # 访问地址 根路径配置
  location / {
    # 项目目录
    root            /var/nginx/html;
    # 默认读取文件
    index           index.html;
    # 配置 history 模式的刷新空白
    try_files       $uri $uri/ /index.html;
  }

  # 后缀匹配，解决静态资源找不到问题
  location ~* \.(gif|jpg|jpeg|png|css|js|ico)$ {
    root            /var/nginx/html/static/;
  }

  # 图片防盗链
  location ~/static/.*\.(jpg|jpeg|png|gif|webp)$ {
    root              /var/nginx/html;
    valid_referers    *.example.com;
    if ($invalid_referer) {
      return          403;
    }
  }

  # 访问限制
  location /static {
    root               /var/nginx/html;
    # allow 允许
    allow              39.xxx.xxx.xxx;
    # deny  拒绝
    deny               all;
  }
}
```

在这个配置中：

- **`listen 80;`**： 指定 Nginx 监听的端口号。
- **`server_name _;`**： 表示该 `server` 块将匹配所有请求。
- **`location /`**： 配置请求的 · 路径，尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。
- **`add_header X-Frame-Options SAMEORIGIN;`**：设置响应的头部信息 `X-Frame-Options`，不允许我们的页面嵌套到第三方网页里面。
- **`root /var/nginx/html;`**： 指定网站的根目录，这里是 `React` 项目构建后的静态文件目录。
- **`index index.html;`**： 指定默认的索引文件。
- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。

### 一个web服务，配置多个项目 (location 匹配路由区别)

``` nginx
server {
  listen                80;
  server_name           _;

  # 主应用
  location / {
    root                /var/nginx/html/main;
    index               index.html;
    try_files           $uri $uri/ /index.html;
  }

  # 子应用一
  location ^~ /user/ {
    proxy_pass          http://localhost:8001;
    proxy_redirect      off;
    proxy_set_header    Host $host;
    proxy_set_header    X-Real-IP $remote_addr;
    proxy_set_header    X-Forwarded-For
    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # 子应用二
  location ^~ /product/ {
    proxy_pass          http://localhost:8002;
    proxy_redirect      off;
    proxy_set_header    Host $host;
    proxy_set_header    X-Real-IP $remote_addr;
    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # 静态资源读取不到问题处理
  rewrite ^/api/profile/(.*)$ /(替换成正确路径的文件的上一层目录)/$1 last;
}

# 子应用一服务
server {
  listen                8001;
  server_name           _;
  location / {
    root                /var/nginx/html/user;
    index               index.html;
    try_files           $uri $uri/ /index.html;
  }

  location ^~ /user/ {
    alias               /var/nginx/html/user/;
    index               index.html index.htm;
    try_files           $uri /user/index.html;
  }

  # 接口代理
  location  /api {
    proxy_pass          http://localhost:3001;
  }
}

# 子应用二服务
server {
  listen                8002;
  server_name           _;

  location / {
    root                /var/nginx/html/product;
    index               index.html;
    try_files           $uri $uri/ /index.html;
  }

  location ^~ /product/ {
    alias               /var/nginx/html/product/;
    index               index.html index.htm;
    try_files           $uri /product/index.html;
  }

  # 接口代理
  location  /api {
    proxy_pass          http://localhost:3002;
  }
}
```

在上述配置中

- **`location ^~ /user/`**：使用 `^~` 修饰的 `location` 块，匹配以 `/user/` 开头的 `URI`。如果请求的 `URI` 以 `/user/` 开头，则 `Nginx` 将立即停止搜索其他 `location` 块，而是使用这个 `location` 块进行处理，`location` 块里面使用反向代理，指向服务器 `http://localhost:8001` 的地址。
- **`location ^~ /product/`**：同上，匹配以 `/product/` 开头的 `URI`。

### PC端和移动端使用不同的项目文件映射

要在 `Nginx` 中根据用户设备类型（例如PC端和移动端）使用不同的项目文件映射，您可以使用 `map` 指令创建一个变量，根据用户的 `User-Agent` 头部信息来判断设备类型，并使用if语句根据变量的值来选择不同的文件映射。以下是一个示例配置：

``` nginx
map $http_user_agent $is_mobile {
  default 0;
  ~*iphone 1;
  ~*android 1;
  ~*mobile 1;
}

server {
  listen 80;
  server_name example.com;

  root /var/www;

  location / {
    if ($is_mobile) {
      alias /var/www/mobile/;
    }
    alias /var/www/desktop/;
    try_files $uri $uri/ /index.html;
  }
}
```

或者

``` nginx
server {
  location / {
    root /var/www/desktop;
    if ($http_user_agent ~* &#x27;(mobile|android|iphone|ipad|phone)&#x27;) {
      root /var/www/mobile;
    }
    index index.html;
  }
}
```

在这个配置中：

- **`map $http_user_agent $is_mobile`**：创建一个变量 `$is_mobile`，根据 `$http_user_agent` 中的 `User-Agent` 头部信息判断设备类型。如果 `User-Agent` 中包含 `iphone`、`android`、`mobile` 等关键词，则将 `$is_mobile` 设置为 `1`，否则设置为 `0`。
- **`location /`**：对所有请求进行匹配。
- **`if ($is_mobile)`**：使用 `if` 语句根据 `$is_mobile` 的值判断设备类型。如果是移动设备，则将请求映射到 `/var/www/mobile/` 目录；否则映射到 `/var/www/desktop/` 目录。
- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `/index.html`。

需要注意的是，尽管 `if` 语句在 `Nginx` 中是有效的，但它可能会导致性能问题，并且在某些情况下可能不起作用。如果您担心性能问题，可以考虑使用更高效的方法，如根据不同的 `User-Agent` 头部信息设置不同的变量，并使用 `map` 指令匹配。

### 配置负载均衡

要在 `Nginx` 中配置负载均衡，您可以使用 `upstream` 块定义一组后端服务器，并在 `server` 块中使用 `proxy_pass` 指令将请求代理到这组后端服务器。以下是一个示例配置：

``` nginx
http {
  upstream backend {
    server backend1.example.com;
    server backend2.example.com;
    server backend3.example.com;
  }

  server {
    listen 80;
    server_name example.com;

    location / {
      proxy_pass          http://backend;
      proxy_set_header    Host $proxy_host;
      proxy_set_header    X-Real-IP $remote_addr;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
    }
  }
}
```

在这个配置中：

- **`upstream backend`**：定义了一个名为 `backend` 的负载均衡组，其中包含了三个后端服务器：`backend1.example.com`、`backend2.example.com` 和 `backend3.example.com`。
- **`server块中的location /`**：匹配所有请求。
- **`proxy_pass http://backend;`**：将请求代理到名为 `backend` 的负载均衡组中的服务器。`Nginx` 会自动根据默认的负载均衡算法（轮询）将请求分发到这组后端服务器中的一个。
- **`proxy_set_header`**：设置代理请求的头部信息，如真实 `IP` 地址、转发者 `IP` 地址和主机地址。


您还可以根据需要添加其他负载均衡配置选项，例如设置负载均衡算法、调整权重等。以下是一个更复杂的负载均衡配置示例：

``` nginx
http {
  upstream backend {
    least_conn; # 使用最少连接数算法
    server backend1.example.com weight=3;
    server backend2.example.com;
    server backend3.example.com;
  }

  server {
    listen 80;
    server_name example.com;

    location / {
      proxy_pass http://backend;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $host;
    }
  }
}
```

在这个配置中：

- **`least_conn`**：使用最少连接数算法进行负载均衡。
- **`server backend1.example.com weight=3;`**：设置 `backend1.example.com` 的权重为 `3`，比其他后端服务器更具优先级。
- **`proxy_set_header`**：设置代理请求的头部信息，如真实 `IP` 地址、转发者 `IP` 地址和主机地址。


### 总结

本文介绍了一些常用的 `Nginx` 基础配置，包括虚拟主机配置、`HTTP` 重定向、反向代理、`SSL/TLS` 配置等内容，并提供了详细的示例说明。正确配置 `Nginx` 不仅可以提高网站的性能和安全性，还能提升用户体验和搜索引擎排名。希望本文能够帮助您更好地理解和应用 `Nginx`，在实际项目中发挥其作用。

**注意：**

配置完成后，保存并关闭文件，然后重新加载Nginx以使配置生效：

``` bash
sudo systemctl reload nginx
```" class="border-0 !border-l-2 border-solid border-transparent pr-[16px] text-base !border-sky-500"><a class="w-full overflow-hidden !text-[#515767] !text-sky-500" href="/toolkit/articles/651#nginx%E5%B8%B8%E7%94%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3--###-%E4%BB%8B%E7%BB%8D--nginx-%E6%98%AF%E4%B8%80%E4%B8%AA%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E5%BC%80%E6%BA%90-web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%83%E4%B8%8D%E4%BB%85%E5%8F%AF%E4%BB%A5%E4%BD%9C%E4%B8%BA-http-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E8%BF%98%E5%8F%AF%E4%BB%A5%E7%94%A8%E4%BD%9C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AD%89%E5%9C%A8%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E4%B8%AD%E6%AD%A3%E7%A1%AE%E9%85%8D%E7%BD%AE-nginx-%E6%98%AF%E7%A1%AE%E4%BF%9D%E7%BD%91%E7%AB%99%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%92%8C%E6%80%A7%E8%83%BD%E7%9A%84%E9%87%8D%E8%A6%81%E6%AD%A5%E9%AA%A4%E6%9C%AC%E6%96%87%E5%B0%86%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84-nginx-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E5%8C%85%E6%8B%AC%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AEhttp-%E9%87%8D%E5%AE%9A%E5%90%91%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%AD%89%E5%86%85%E5%AE%B9%E5%B9%B6%E6%8F%90%E4%BE%9B%E8%AF%A6%E7%BB%86%E7%9A%84%E7%A4%BA%E4%BE%8B%E8%AF%B4%E6%98%8E--###-%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE--%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%98%AF-nginx-%E4%B8%AD%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81%E7%9A%84%E6%A6%82%E5%BF%B5%E5%AE%83%E5%85%81%E8%AE%B8%E6%82%A8%E5%9C%A8%E4%B8%80%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%89%98%E7%AE%A1%E5%A4%9A%E4%B8%AA%E7%BD%91%E7%AB%99%E4%B8%8B%E9%9D%A2%E6%98%AF%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B--%60%60%60nginx-server-{-----listen-80;-----server_name-example.com-www.example.com;------root-/var/www/example;-----index-index.html-index.htm;------location-/-{---------try_files-$uri-$uri/-/index.html;-----}-}-%60%60%60----**%60listen-80;%60**%E6%8C%87%E5%AE%9A-%60nginx%60-%E7%9B%91%E5%90%AC%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7---**%60server_name-example.com-www.example.com;%60**%E6%8C%87%E5%AE%9A%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E7%9A%84%E5%9F%9F%E5%90%8D---**%60root-/var/www/example;%60**%E6%8C%87%E5%AE%9A%E7%BD%91%E7%AB%99%E7%9A%84%E6%A0%B9%E7%9B%AE%E5%BD%95---**%60index-index.html-index.htm;%60**%E6%8C%87%E5%AE%9A%E9%BB%98%E8%AE%A4%E7%9A%84%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6---**%60location-/%60**%E9%85%8D%E7%BD%AE%E8%AF%B7%E6%B1%82%E7%9A%84-%60url%60-%E8%B7%AF%E5%BE%84---**%60try_files-$uri-$uri/-/index.html;%60**%E5%B0%9D%E8%AF%95%E5%AF%BB%E6%89%BE%E4%B8%8E%E8%AF%B7%E6%B1%82-%60uri%60-%E5%8C%B9%E9%85%8D%E7%9A%84%E6%96%87%E4%BB%B6%E5%A6%82%E6%9E%9C%E6%89%BE%E4%B8%8D%E5%88%B0%E5%88%99%E8%BF%94%E5%9B%9E-%60index.html%60--###-http-%E9%87%8D%E5%AE%9A%E5%90%91-http-%E9%87%8D%E5%AE%9A%E5%90%91%E6%98%AF%E5%B0%86%E4%B8%80%E4%B8%AA-url-%E8%AF%B7%E6%B1%82%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E5%8F%A6%E4%B8%80%E4%B8%AA-url-%E7%9A%84%E8%BF%87%E7%A8%8B%E4%B8%8B%E9%9D%A2%E6%98%AF%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84-http-%E9%87%8D%E5%AE%9A%E5%90%91%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B--%60%60%60-nginx-server-{-----listen-80;-----server_name-www.example.com;------return-301-http:/example.com$request_uri;-}-%60%60%60--%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%BC%9A%E5%B0%86%E6%89%80%E6%9C%89%E8%AE%BF%E9%97%AE-%60www.example.com%60-%E7%9A%84%E8%AF%B7%E6%B1%82%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0-%60example.com%60%E4%BF%9D%E8%AF%81%E7%BD%91%E7%AB%99%E7%9A%84%E8%AE%BF%E9%97%AE%E7%BB%9F%E4%B8%80%E6%80%A7--###-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-%60nginx%60-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%98%AF%E5%B0%86%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91%E7%BB%99%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E8%BF%87%E7%A8%8B%E5%B8%B8%E7%94%A8%E4%BA%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E9%9A%90%E8%97%8F%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E9%9D%A2%E6%98%AF%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B--%60%60%60-nginx-server-{---listen-80;---server_name-www.example.com;----location-/-{-----proxy_pass-http:/backend_server;-----proxy_set_header-host-$host;-----proxy_set_header-x-real-ip-$remote_addr;-----proxy_set_header-x-forwarded-for-$proxy_add_x_forwarded_for;-----proxy_set_header-x-forwarded-proto-$scheme;---}-}-%60%60%60----**%60proxy_pass-http:/backend_server;%60**%E6%8C%87%E5%AE%9A%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%9C%B0%E5%9D%80---**%60proxy_set_header%60**%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%E8%AF%B7%E6%B1%82%E7%9A%84%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF%E5%A6%82-%60host%60%60x-real-ip%60%60x-forwarded-for%60-%E7%AD%89--###-ssl/tls-%E9%85%8D%E7%BD%AE--%60ssl/tls%60-%E6%98%AF%E4%BF%9D%E6%8A%A4%E7%BD%91%E7%AB%99%E5%AE%89%E5%85%A8%E7%9A%84%E9%87%8D%E8%A6%81%E6%89%8B%E6%AE%B5%60nginx%60-%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%B0%E5%AF%8C%E7%9A%84-%60ssl/tls%60-%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9%E4%B8%8B%E9%9D%A2%E6%98%AF%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84-%60ssl/tls%60-%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B--%60%60%60-nginx-server-{---listen----------------------80;---server_name-----------------www.example.com;---#-%E5%B0%86-http-%E9%87%8D%E5%AE%9A%E5%90%91%E8%BD%AC%E7%A7%BB%E5%88%B0-https---return-301-https:/$server_name$request_uri;-}--server-{---listen----------------------443-ssl;---server_name-----------------www.example.com;---ssl_certificate-------------/etc/nginx/ssl/www.example.com.pem;---ssl_certificate_key---------/etc/nginx/ssl/www.example.com.key;---ssl_session_timeout---------10m;---ssl_ciphers-----------------ecdhe-rsa-aes128-gcm-sha256:ecdhe:ecdh:aes:high:!null:!anull:!md5:!adh:!rc4;---ssl_protocols---------------tlsv1-tlsv1.1-tlsv1.2;---ssl_prefer_server_ciphers---on;----location-/-{-----root--------------------/var/nginx/html;-----index-------------------index.html-index.htm-index.md;-----try_files---------------$uri-$uri/-/index.html;---}-}--%60%60%60----**%60listen-443-ssl;%60**%E6%8C%87%E5%AE%9A%E7%9B%91%E5%90%AC%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7%E5%B9%B6%E5%BC%80%E5%90%AF-ssl---**%60ssl_certificate-%E5%92%8C-ssl_certificate_key%60**%E6%8C%87%E5%AE%9A-ssl-%E8%AF%81%E4%B9%A6%E5%92%8C%E7%A7%81%E9%92%A5%E7%9A%84%E8%B7%AF%E5%BE%84---**%60ssl_protocols%60**%E6%8C%87%E5%AE%9A%E5%85%81%E8%AE%B8%E7%9A%84-ssl/tls-%E5%8D%8F%E8%AE%AE%E7%89%88%E6%9C%AC---**%60ssl_prefer_server_ciphers-on;%60**%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E7%9A%84%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95---**%60ssl_ciphers%60**%E6%8C%87%E5%AE%9A%E5%85%81%E8%AE%B8%E7%9A%84%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95--###-%E9%9A%90%E8%97%8F-nginx-%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF--%E8%A6%81%E9%9A%90%E8%97%8F-%60nginx%60-%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%82%A8%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E8%BF%9B%E8%A1%8C%E7%9B%B8%E5%BA%94%E7%9A%84%E8%AE%BE%E7%BD%AE%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%85%B7%E4%BD%93%E6%9D%A5%E8%AF%B4%E6%82%A8%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9-%60nginx.conf%60-%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8-%60server_tokens-off;%60-%E6%8C%87%E4%BB%A4%E6%9D%A5%E5%85%B3%E9%97%AD-%60nginx%60-%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7%E6%98%BE%E7%A4%BA%E4%BB%A5%E4%B8%8B%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE%E7%9A%84%E7%A4%BA%E4%BE%8B--%60%60%60-nginx-http-{---server_tokens-off;-}-%60%60%60--%E5%B0%86%E4%B8%8A%E8%BF%B0%E9%85%8D%E7%BD%AE%E6%B7%BB%E5%8A%A0%E5%88%B0-%60nginx.conf%60-%E6%96%87%E4%BB%B6%E7%9A%84-%60http%60-%E5%9D%97%E4%B8%AD%E5%8D%B3%E5%8F%AF%E7%A6%81%E7%94%A8-%60nginx%60-%E7%89%88%E6%9C%AC%E5%8F%B7%E6%98%BE%E7%A4%BA--###-%E7%A6%81%E6%AD%A2-ip-%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE-80-%E7%AB%AF%E5%8F%A3--%E8%A6%81%E7%A6%81%E6%AD%A2%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87-%60ip%60-%E5%9C%B0%E5%9D%80%E8%AE%BF%E9%97%AE-%6080%60-%E7%AB%AF%E5%8F%A3%E6%82%A8%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87-%60nginx%60-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E7%9B%B8%E5%BA%94%E7%9A%84%E8%AE%BE%E7%BD%AE%E5%85%B7%E4%BD%93%E6%9D%A5%E8%AF%B4%E6%82%A8%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E9%BB%98%E8%AE%A4%E7%9A%84-%60server%60-%E5%9D%97%E7%94%A8%E4%BA%8E%E6%8D%95%E8%8E%B7%E6%89%80%E6%9C%89%E8%AF%B7%E6%B1%82%E5%B9%B6%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2%E6%88%96%E8%80%85%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E5%85%B6%E4%BB%96%E5%9C%B0%E5%9D%80%E4%BB%A5%E4%B8%8B%E6%98%AF%E4%B8%80%E4%B8%AA%E7%A4%BA%E4%BE%8B%E9%85%8D%E7%BD%AE--%60%60%60-nginx-server-{---listen-80-default_server;---server_name-_;----return-444;-}-%60%60%60--%E5%9C%A8%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD----**%60listen-80-default_server;%60**%E6%8C%87%E5%AE%9A-%60nginx%60-%E7%9B%91%E5%90%AC%E9%BB%98%E8%AE%A4%E7%9A%84-%60http%60-%E7%AB%AF%E5%8F%A3%E5%B9%B6%E5%B0%86%E6%AD%A4-%60server%60-%E5%9D%97%E6%A0%87%E8%AE%B0%E4%B8%BA%E9%BB%98%E8%AE%A4%E6%9C%8D%E5%8A%A1%E5%99%A8---**%60server_name-_;%60**-%E8%A1%A8%E7%A4%BA%E8%AF%A5-%60server%60-%E5%9D%97%E5%B0%86%E5%8C%B9%E9%85%8D%E6%89%80%E6%9C%89%E8%AF%B7%E6%B1%82---**%60return-444;%60**-%E6%98%AF%E4%B8%80%E4%B8%AA%E7%89%B9%E6%AE%8A%E7%9A%84-%60nginx%60-%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4%E5%AE%83%E4%BC%9A%E7%AB%8B%E5%8D%B3%E5%85%B3%E9%97%AD%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E7%9B%B8%E5%BD%93%E4%BA%8E%E4%B8%8D%E5%81%9A%E4%BB%BB%E4%BD%95%E5%93%8D%E5%BA%94--%E9%80%9A%E8%BF%87%E8%BF%99%E6%A0%B7%E7%9A%84%E9%85%8D%E7%BD%AE%E5%BD%93%E6%9C%89%E8%AF%B7%E6%B1%82%E9%80%9A%E8%BF%87-%60ip%60-%E5%9C%B0%E5%9D%80%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE-%6080%60-%E7%AB%AF%E5%8F%A3%E6%97%B6%60nginx%60-%E5%B0%86%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA-%60444%60-%E9%94%99%E8%AF%AF%E4%B8%8D%E4%BC%9A%E6%8F%90%E4%BE%9B%E4%BB%BB%E4%BD%95%E5%86%85%E5%AE%B9%E4%BB%8E%E8%80%8C%E5%AE%9E%E7%8E%B0%E4%BA%86%E7%A6%81%E6%AD%A2%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE-%6080%60-%E7%AB%AF%E5%8F%A3%E7%9A%84%E7%9B%AE%E7%9A%84--###-%E5%90%AF%E5%8A%A8-web-%E6%9C%8D%E5%8A%A1-(react-%E9%A1%B9%E7%9B%AE%E4%B8%BA%E4%BE%8B)--%60%60%60-nginx-server-{---#-%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8%E7%AB%AF%E5%8F%A3---listen------------80;---#-%E5%9F%9F%E5%90%8Dlocalhost---server_name-------_;---#-%E7%A6%81%E6%AD%A2-iframe-%E5%B5%8C%E5%A5%97---add_header--------x-frame-options-sameorigin;----#-%E8%AE%BF%E9%97%AE%E5%9C%B0%E5%9D%80-%E6%A0%B9%E8%B7%AF%E5%BE%84%E9%85%8D%E7%BD%AE---location-/-{-----#-%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95-----root------------/var/nginx/html;-----#-%E9%BB%98%E8%AE%A4%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6-----index-----------index.html;-----#-%E9%85%8D%E7%BD%AE-history-%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%88%B7%E6%96%B0%E7%A9%BA%E7%99%BD-----try_files-------$uri-$uri/-/index.html;---}----#-%E5%90%8E%E7%BC%80%E5%8C%B9%E9%85%8D%E8%A7%A3%E5%86%B3%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%89%BE%E4%B8%8D%E5%88%B0%E9%97%AE%E9%A2%98---location-~*-/.(gif|jpg|jpeg|png|css|js|ico)$-{-----root------------/var/nginx/html/static/;---}----#-%E5%9B%BE%E7%89%87%E9%98%B2%E7%9B%97%E9%93%BE---location-~/static/.*/.(jpg|jpeg|png|gif|webp)$-{-----root--------------/var/nginx/html;-----valid_referers----*.example.com;-----if-($invalid_referer)-{-------return----------403;-----}---}----#-%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6---location-/static-{-----root---------------/var/nginx/html;-----#-allow-%E5%85%81%E8%AE%B8-----allow--------------39.xxx.xxx.xxx;-----#-deny--%E6%8B%92%E7%BB%9D-----deny---------------all;---}-}-%60%60%60--%E5%9C%A8%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD----**%60listen-80;%60**-%E6%8C%87%E5%AE%9A-nginx-%E7%9B%91%E5%90%AC%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7---**%60server_name-_;%60**-%E8%A1%A8%E7%A4%BA%E8%AF%A5-%60server%60-%E5%9D%97%E5%B0%86%E5%8C%B9%E9%85%8D%E6%89%80%E6%9C%89%E8%AF%B7%E6%B1%82---**%60location-/%60**-%E9%85%8D%E7%BD%AE%E8%AF%B7%E6%B1%82%E7%9A%84-%C2%B7-%E8%B7%AF%E5%BE%84%E5%B0%9D%E8%AF%95%E5%AF%BB%E6%89%BE%E4%B8%8E%E8%AF%B7%E6%B1%82-%60uri%60-%E5%8C%B9%E9%85%8D%E7%9A%84%E6%96%87%E4%BB%B6%E5%A6%82%E6%9E%9C%E6%89%BE%E4%B8%8D%E5%88%B0%E5%88%99%E8%BF%94%E5%9B%9E-%60index.html%60---**%60add_header-x-frame-options-sameorigin;%60**%E8%AE%BE%E7%BD%AE%E5%93%8D%E5%BA%94%E7%9A%84%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF-%60x-frame-options%60%E4%B8%8D%E5%85%81%E8%AE%B8%E6%88%91%E4%BB%AC%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%B5%8C%E5%A5%97%E5%88%B0%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BD%91%E9%A1%B5%E9%87%8C%E9%9D%A2---**%60root-/var/nginx/html;%60**-%E6%8C%87%E5%AE%9A%E7%BD%91%E7%AB%99%E7%9A%84%E6%A0%B9%E7%9B%AE%E5%BD%95%E8%BF%99%E9%87%8C%E6%98%AF-%60react%60-%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E5%90%8E%E7%9A%84%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95---**%60index-index.html;%60**-%E6%8C%87%E5%AE%9A%E9%BB%98%E8%AE%A4%E7%9A%84%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6---**%60try_files-$uri-$uri/-/index.html;%60**%E5%B0%9D%E8%AF%95%E5%AF%BB%E6%89%BE%E4%B8%8E%E8%AF%B7%E6%B1%82-%60uri%60-%E5%8C%B9%E9%85%8D%E7%9A%84%E6%96%87%E4%BB%B6%E5%A6%82%E6%9E%9C%E6%89%BE%E4%B8%8D%E5%88%B0%E5%88%99%E8%BF%94%E5%9B%9E-%60index.html%60--###-%E4%B8%80%E4%B8%AAweb%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AA%E9%A1%B9%E7%9B%AE-(location-%E5%8C%B9%E9%85%8D%E8%B7%AF%E7%94%B1%E5%8C%BA%E5%88%AB)--%60%60%60-nginx-server-{---listen----------------80;---server_name-----------_;----#-%E4%B8%BB%E5%BA%94%E7%94%A8---location-/-{-----root----------------/var/nginx/html/main;-----index---------------index.html;-----try_files-----------$uri-$uri/-/index.html;---}----#-%E5%AD%90%E5%BA%94%E7%94%A8%E4%B8%80---location-^~-/user/-{-----proxy_pass----------http:/localhost:8001;-----proxy_redirect------off;-----proxy_set_header----host-$host;-----proxy_set_header----x-real-ip-$remote_addr;-----proxy_set_header----x-forwarded-for-----proxy_set_header----x-forwarded-for-$proxy_add_x_forwarded_for;---}----#-%E5%AD%90%E5%BA%94%E7%94%A8%E4%BA%8C---location-^~-/product/-{-----proxy_pass----------http:/localhost:8002;-----proxy_redirect------off;-----proxy_set_header----host-$host;-----proxy_set_header----x-real-ip-$remote_addr;-----proxy_set_header----x-forwarded-for-$proxy_add_x_forwarded_for;---}----#-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AF%BB%E5%8F%96%E4%B8%8D%E5%88%B0%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86---rewrite-^/api/profile/(.*)$-/(%E6%9B%BF%E6%8D%A2%E6%88%90%E6%AD%A3%E7%A1%AE%E8%B7%AF%E5%BE%84%E7%9A%84%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%8A%E4%B8%80%E5%B1%82%E7%9B%AE%E5%BD%95)/$1-last;-}--#-%E5%AD%90%E5%BA%94%E7%94%A8%E4%B8%80%E6%9C%8D%E5%8A%A1-server-{---listen----------------8001;---server_name-----------_;---location-/-{-----root----------------/var/nginx/html/user;-----index---------------index.html;-----try_files-----------$uri-$uri/-/index.html;---}----location-^~-/user/-{-----alias---------------/var/nginx/html/user/;-----index---------------index.html-index.htm;-----try_files-----------$uri-/user/index.html;---}----#-%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%90%86---location--/api-{-----proxy_pass----------http:/localhost:3001;---}-}--#-%E5%AD%90%E5%BA%94%E7%94%A8%E4%BA%8C%E6%9C%8D%E5%8A%A1-server-{---listen----------------8002;---server_name-----------_;----location-/-{-----root----------------/var/nginx/html/product;-----index---------------index.html;-----try_files-----------$uri-$uri/-/index.html;---}----location-^~-/product/-{-----alias---------------/var/nginx/html/product/;-----index---------------index.html-index.htm;-----try_files-----------$uri-/product/index.html;---}----#-%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%90%86---location--/api-{-----proxy_pass----------http:/localhost:3002;---}-}-%60%60%60--%E5%9C%A8%E4%B8%8A%E8%BF%B0%E9%85%8D%E7%BD%AE%E4%B8%AD----**%60location-^~-/user/%60**%E4%BD%BF%E7%94%A8-%60^~%60-%E4%BF%AE%E9%A5%B0%E7%9A%84-%60location%60-%E5%9D%97%E5%8C%B9%E9%85%8D%E4%BB%A5-%60/user/%60-%E5%BC%80%E5%A4%B4%E7%9A%84-%60uri%60%E5%A6%82%E6%9E%9C%E8%AF%B7%E6%B1%82%E7%9A%84-%60uri%60-%E4%BB%A5-%60/user/%60-%E5%BC%80%E5%A4%B4%E5%88%99-%60nginx%60-%E5%B0%86%E7%AB%8B%E5%8D%B3%E5%81%9C%E6%AD%A2%E6%90%9C%E7%B4%A2%E5%85%B6%E4%BB%96-%60location%60-%E5%9D%97%E8%80%8C%E6%98%AF%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA-%60location%60-%E5%9D%97%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%60location%60-%E5%9D%97%E9%87%8C%E9%9D%A2%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%8C%87%E5%90%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%60http:/localhost:8001%60-%E7%9A%84%E5%9C%B0%E5%9D%80---**%60location-^~-/product/%60**%E5%90%8C%E4%B8%8A%E5%8C%B9%E9%85%8D%E4%BB%A5-%60/product/%60-%E5%BC%80%E5%A4%B4%E7%9A%84-%60uri%60--###-pc%E7%AB%AF%E5%92%8C%E7%A7%BB%E5%8A%A8%E7%AB%AF%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%96%87%E4%BB%B6%E6%98%A0%E5%B0%84--%E8%A6%81%E5%9C%A8-%60nginx%60-%E4%B8%AD%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E8%AE%BE%E5%A4%87%E7%B1%BB%E5%9E%8B%E4%BE%8B%E5%A6%82pc%E7%AB%AF%E5%92%8C%E7%A7%BB%E5%8A%A8%E7%AB%AF%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%96%87%E4%BB%B6%E6%98%A0%E5%B0%84%E6%82%A8%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-%60map%60-%E6%8C%87%E4%BB%A4%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E7%9A%84-%60user-agent%60-%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF%E6%9D%A5%E5%88%A4%E6%96%AD%E8%AE%BE%E5%A4%87%E7%B1%BB%E5%9E%8B%E5%B9%B6%E4%BD%BF%E7%94%A8if%E8%AF%AD%E5%8F%A5%E6%A0%B9%E6%8D%AE%E5%8F%98%E9%87%8F%E7%9A%84%E5%80%BC%E6%9D%A5%E9%80%89%E6%8B%A9%E4%B8%8D%E5%90%8C%E7%9A%84%E6%96%87%E4%BB%B6%E6%98%A0%E5%B0%84%E4%BB%A5%E4%B8%8B%E6%98%AF%E4%B8%80%E4%B8%AA%E7%A4%BA%E4%BE%8B%E9%85%8D%E7%BD%AE--%60%60%60-nginx-map-$http_user_agent-$is_mobile-{---default-0;---~*iphone-1;---~*android-1;---~*mobile-1;-}--server-{---listen-80;---server_name-example.com;----root-/var/www;----location-/-{-----if-($is_mobile)-{-------alias-/var/www/mobile/;-----}-----alias-/var/www/desktop/;-----try_files-$uri-$uri/-/index.html;---}-}-%60%60%60--%E6%88%96%E8%80%85--%60%60%60-nginx-server-{---location-/-{-----root-/var/www/desktop;-----if-($http_user_agent-~*-&#x27;(mobile|android|iphone|ipad|phone)&#x27;)-{-------root-/var/www/mobile;-----}-----index-index.html;---}-}-%60%60%60--%E5%9C%A8%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD----**%60map-$http_user_agent-$is_mobile%60**%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F-%60$is_mobile%60%E6%A0%B9%E6%8D%AE-%60$http_user_agent%60-%E4%B8%AD%E7%9A%84-%60user-agent%60-%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF%E5%88%A4%E6%96%AD%E8%AE%BE%E5%A4%87%E7%B1%BB%E5%9E%8B%E5%A6%82%E6%9E%9C-%60user-agent%60-%E4%B8%AD%E5%8C%85%E5%90%AB-%60iphone%60%60android%60%60mobile%60-%E7%AD%89%E5%85%B3%E9%94%AE%E8%AF%8D%E5%88%99%E5%B0%86-%60$is_mobile%60-%E8%AE%BE%E7%BD%AE%E4%B8%BA-%601%60%E5%90%A6%E5%88%99%E8%AE%BE%E7%BD%AE%E4%B8%BA-%600%60---**%60location-/%60**%E5%AF%B9%E6%89%80%E6%9C%89%E8%AF%B7%E6%B1%82%E8%BF%9B%E8%A1%8C%E5%8C%B9%E9%85%8D---**%60if-($is_mobile)%60**%E4%BD%BF%E7%94%A8-%60if%60-%E8%AF%AD%E5%8F%A5%E6%A0%B9%E6%8D%AE-%60$is_mobile%60-%E7%9A%84%E5%80%BC%E5%88%A4%E6%96%AD%E8%AE%BE%E5%A4%87%E7%B1%BB%E5%9E%8B%E5%A6%82%E6%9E%9C%E6%98%AF%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E5%88%99%E5%B0%86%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E5%88%B0-%60/var/www/mobile/%60-%E7%9B%AE%E5%BD%95%E5%90%A6%E5%88%99%E6%98%A0%E5%B0%84%E5%88%B0-%60/var/www/desktop/%60-%E7%9B%AE%E5%BD%95---**%60try_files-$uri-$uri/-/index.html;%60**%E5%B0%9D%E8%AF%95%E5%AF%BB%E6%89%BE%E4%B8%8E%E8%AF%B7%E6%B1%82-%60uri%60-%E5%8C%B9%E9%85%8D%E7%9A%84%E6%96%87%E4%BB%B6%E5%A6%82%E6%9E%9C%E6%89%BE%E4%B8%8D%E5%88%B0%E5%88%99%E8%BF%94%E5%9B%9E-%60/index.html%60--%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%E5%B0%BD%E7%AE%A1-%60if%60-%E8%AF%AD%E5%8F%A5%E5%9C%A8-%60nginx%60-%E4%B8%AD%E6%98%AF%E6%9C%89%E6%95%88%E7%9A%84%E4%BD%86%E5%AE%83%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%B9%B6%E4%B8%94%E5%9C%A8%E6%9F%90%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8B%E5%8F%AF%E8%83%BD%E4%B8%8D%E8%B5%B7%E4%BD%9C%E7%94%A8%E5%A6%82%E6%9E%9C%E6%82%A8%E6%8B%85%E5%BF%83%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%8F%AF%E4%BB%A5%E8%80%83%E8%99%91%E4%BD%BF%E7%94%A8%E6%9B%B4%E9%AB%98%E6%95%88%E7%9A%84%E6%96%B9%E6%B3%95%E5%A6%82%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84-%60user-agent%60-%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E5%8F%98%E9%87%8F%E5%B9%B6%E4%BD%BF%E7%94%A8-%60map%60-%E6%8C%87%E4%BB%A4%E5%8C%B9%E9%85%8D--###-%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1--%E8%A6%81%E5%9C%A8-%60nginx%60-%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%82%A8%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-%60upstream%60-%E5%9D%97%E5%AE%9A%E4%B9%89%E4%B8%80%E7%BB%84%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B9%B6%E5%9C%A8-%60server%60-%E5%9D%97%E4%B8%AD%E4%BD%BF%E7%94%A8-%60proxy_pass%60-%E6%8C%87%E4%BB%A4%E5%B0%86%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%90%86%E5%88%B0%E8%BF%99%E7%BB%84%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A5%E4%B8%8B%E6%98%AF%E4%B8%80%E4%B8%AA%E7%A4%BA%E4%BE%8B%E9%85%8D%E7%BD%AE--%60%60%60-nginx-http-{---upstream-backend-{-----server-backend1.example.com;-----server-backend2.example.com;-----server-backend3.example.com;---}----server-{-----listen-80;-----server_name-example.com;------location-/-{-------proxy_pass----------http:/backend;-------proxy_set_header----host-$proxy_host;-------proxy_set_header----x-real-ip-$remote_addr;-------proxy_set_header----x-forwarded-for-$proxy_add_x_forwarded_for;-----}---}-}-%60%60%60--%E5%9C%A8%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD----**%60upstream-backend%60**%E5%AE%9A%E4%B9%89%E4%BA%86%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BA-%60backend%60-%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%BB%84%E5%85%B6%E4%B8%AD%E5%8C%85%E5%90%AB%E4%BA%86%E4%B8%89%E4%B8%AA%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%60backend1.example.com%60%60backend2.example.com%60-%E5%92%8C-%60backend3.example.com%60---**%60server%E5%9D%97%E4%B8%AD%E7%9A%84location-/%60**%E5%8C%B9%E9%85%8D%E6%89%80%E6%9C%89%E8%AF%B7%E6%B1%82---**%60proxy_pass-http:/backend;%60**%E5%B0%86%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%90%86%E5%88%B0%E5%90%8D%E4%B8%BA-%60backend%60-%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%60nginx%60-%E4%BC%9A%E8%87%AA%E5%8A%A8%E6%A0%B9%E6%8D%AE%E9%BB%98%E8%AE%A4%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95%E8%BD%AE%E8%AF%A2%E5%B0%86%E8%AF%B7%E6%B1%82%E5%88%86%E5%8F%91%E5%88%B0%E8%BF%99%E7%BB%84%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%AD%E7%9A%84%E4%B8%80%E4%B8%AA---**%60proxy_set_header%60**%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%E8%AF%B7%E6%B1%82%E7%9A%84%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF%E5%A6%82%E7%9C%9F%E5%AE%9E-%60ip%60-%E5%9C%B0%E5%9D%80%E8%BD%AC%E5%8F%91%E8%80%85-%60ip%60-%E5%9C%B0%E5%9D%80%E5%92%8C%E4%B8%BB%E6%9C%BA%E5%9C%B0%E5%9D%80---%E6%82%A8%E8%BF%98%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E9%9C%80%E8%A6%81%E6%B7%BB%E5%8A%A0%E5%85%B6%E4%BB%96%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9%E4%BE%8B%E5%A6%82%E8%AE%BE%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95%E8%B0%83%E6%95%B4%E6%9D%83%E9%87%8D%E7%AD%89%E4%BB%A5%E4%B8%8B%E6%98%AF%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A4%8D%E6%9D%82%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B--%60%60%60-nginx-http-{---upstream-backend-{-----least_conn;-#-%E4%BD%BF%E7%94%A8%E6%9C%80%E5%B0%91%E8%BF%9E%E6%8E%A5%E6%95%B0%E7%AE%97%E6%B3%95-----server-backend1.example.com-weight=3;-----server-backend2.example.com;-----server-backend3.example.com;---}----server-{-----listen-80;-----server_name-example.com;------location-/-{-------proxy_pass-http:/backend;-------proxy_set_header-x-real-ip-$remote_addr;-------proxy_set_header-x-forwarded-for-$proxy_add_x_forwarded_for;-------proxy_set_header-host-$host;-----}---}-}-%60%60%60--%E5%9C%A8%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD----**%60least_conn%60**%E4%BD%BF%E7%94%A8%E6%9C%80%E5%B0%91%E8%BF%9E%E6%8E%A5%E6%95%B0%E7%AE%97%E6%B3%95%E8%BF%9B%E8%A1%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1---**%60server-backend1.example.com-weight=3;%60**%E8%AE%BE%E7%BD%AE-%60backend1.example.com%60-%E7%9A%84%E6%9D%83%E9%87%8D%E4%B8%BA-%603%60%E6%AF%94%E5%85%B6%E4%BB%96%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9B%B4%E5%85%B7%E4%BC%98%E5%85%88%E7%BA%A7---**%60proxy_set_header%60**%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%E8%AF%B7%E6%B1%82%E7%9A%84%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF%E5%A6%82%E7%9C%9F%E5%AE%9E-%60ip%60-%E5%9C%B0%E5%9D%80%E8%BD%AC%E5%8F%91%E8%80%85-%60ip%60-%E5%9C%B0%E5%9D%80%E5%92%8C%E4%B8%BB%E6%9C%BA%E5%9C%B0%E5%9D%80---###-%E6%80%BB%E7%BB%93--%E6%9C%AC%E6%96%87%E4%BB%8B%E7%BB%8D%E4%BA%86%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84-%60nginx%60-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E5%8C%85%E6%8B%AC%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%60http%60-%E9%87%8D%E5%AE%9A%E5%90%91%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%60ssl/tls%60-%E9%85%8D%E7%BD%AE%E7%AD%89%E5%86%85%E5%AE%B9%E5%B9%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E8%AF%A6%E7%BB%86%E7%9A%84%E7%A4%BA%E4%BE%8B%E8%AF%B4%E6%98%8E%E6%AD%A3%E7%A1%AE%E9%85%8D%E7%BD%AE-%60nginx%60-%E4%B8%8D%E4%BB%85%E5%8F%AF%E4%BB%A5%E6%8F%90%E9%AB%98%E7%BD%91%E7%AB%99%E7%9A%84%E6%80%A7%E8%83%BD%E5%92%8C%E5%AE%89%E5%85%A8%E6%80%A7%E8%BF%98%E8%83%BD%E6%8F%90%E5%8D%87%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E5%92%8C%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8E%92%E5%90%8D%E5%B8%8C%E6%9C%9B%E6%9C%AC%E6%96%87%E8%83%BD%E5%A4%9F%E5%B8%AE%E5%8A%A9%E6%82%A8%E6%9B%B4%E5%A5%BD%E5%9C%B0%E7%90%86%E8%A7%A3%E5%92%8C%E5%BA%94%E7%94%A8-%60nginx%60%E5%9C%A8%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8F%91%E6%8C%A5%E5%85%B6%E4%BD%9C%E7%94%A8--**%E6%B3%A8%E6%84%8F**--%E9%85%8D%E7%BD%AE%E5%AE%8C%E6%88%90%E5%90%8E%E4%BF%9D%E5%AD%98%E5%B9%B6%E5%85%B3%E9%97%AD%E6%96%87%E4%BB%B6%E7%84%B6%E5%90%8E%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BDnginx%E4%BB%A5%E4%BD%BF%E9%85%8D%E7%BD%AE%E7%94%9F%E6%95%88--%60%60%60-bash-sudo-systemctl-reload-nginx-%60%60%60"><div class="truncate" style="padding-left:16px">Nginx常用基础配置详解

### 介绍

Nginx 是一个高性能的开源 Web 服务器，它不仅可以作为 HTTP 服务器使用，还可以用作反向代理服务器、负载均衡器、缓存服务器等。在实际应用中，正确配置 Nginx 是确保网站稳定性和性能的重要步骤。本文将详细介绍一些常用的 Nginx 基础配置，包括虚拟主机配置、HTTP 重定向、反向代理等内容，并提供详细的示例说明。

### 虚拟主机配置

虚拟主机是 Nginx 中非常重要的概念，它允许您在一台服务器上托管多个网站。下面是一个简单的虚拟主机配置示例：

```nginx
server {
    listen 80;
    server_name example.com www.example.com;

    root /var/www/example;
    index index.html index.htm;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

- **`listen 80;`**：指定 `Nginx` 监听的端口号。
- **`server_name example.com www.example.com;`**：指定虚拟主机的域名。
- **`root /var/www/example;`**：指定网站的根目录。
- **`index index.html index.htm;`**：指定默认的索引文件。
- **`location /`**：配置请求的 `URL` 路径。
- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。

### HTTP 重定向
HTTP 重定向是将一个 URL 请求重定向到另一个 URL 的过程。下面是一个简单的 HTTP 重定向配置示例：

``` nginx
server {
    listen 80;
    server_name www.example.com;

    return 301 http://example.com$request_uri;
}
```

这个配置会将所有访问 `www.example.com` 的请求重定向到 `example.com`，保证网站的访问统一性。

### 反向代理
`Nginx` 反向代理是将客户端的请求转发给后端服务器的过程，常用于负载均衡和隐藏后端服务器。下面是一个简单的反向代理配置示例：

``` nginx
server {
  listen 80;
  server_name www.example.com;

  location / {
    proxy_pass http://backend_server;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
```

- **`proxy_pass http://backend_server;`**：指定后端服务器的地址。
- **`proxy_set_header`**：设置代理请求的头部信息，如 `Host`、`X-Real-IP`、`X-Forwarded-For` 等。

### SSL/TLS 配置

`SSL/TLS` 是保护网站安全的重要手段，`Nginx` 提供了丰富的 `SSL/TLS` 配置选项。下面是一个简单的 `SSL/TLS` 配置示例：

``` nginx
server {
  listen                      80;
  server_name                 www.example.com;
  # 将 http 重定向转移到 https
  return 301 https://$server_name$request_uri;
}

server {
  listen                      443 ssl;
  server_name                 www.example.com;
  ssl_certificate             /etc/nginx/ssl/www.example.com.pem;
  ssl_certificate_key         /etc/nginx/ssl/www.example.com.key;
  ssl_session_timeout         10m;
  ssl_ciphers                 ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
  ssl_protocols               TLSv1 TLSv1.1 TLSv1.2;
  ssl_prefer_server_ciphers   on;

  location / {
    root                    /var/nginx/html;
    index                   index.html index.htm index.md;
    try_files               $uri $uri/ /index.html;
  }
}

```

- **`listen 443 ssl;`**：指定监听的端口号，并开启 SSL。
- **`ssl_certificate 和 ssl_certificate_key`**：指定 SSL 证书和私钥的路径。
- **`ssl_protocols`**：指定允许的 SSL/TLS 协议版本。
- **`ssl_prefer_server_ciphers on;`**：优先使用服务器端的加密算法。
- **`ssl_ciphers`**：指定允许的加密算法。

### 隐藏 Nginx 版本信息

要隐藏 `Nginx` 版本信息，您可以通过在配置文件中进行相应的设置来实现。具体来说，您需要修改 `nginx.conf` 文件，使用 `server_tokens off;` 指令来关闭 `Nginx` 的版本号显示。以下是如何进行配置的示例：

``` nginx
http {
  server_tokens off;
}
```

将上述配置添加到 `nginx.conf` 文件的 `http` 块中即可禁用 `Nginx` 版本号显示。

### 禁止 ip 直接访问 80 端口

要禁止直接通过 `IP` 地址访问 `80` 端口，您可以通过 `Nginx` 配置文件进行相应的设置。具体来说，您可以配置一个默认的 `server` 块，用于捕获所有请求，并返回一个错误页面或者重定向到其他地址。以下是一个示例配置：

``` nginx
server {
  listen 80 default_server;
  server_name _;

  return 444;
}
```

在这个配置中：

- **`listen 80 default_server;`**：指定 `Nginx` 监听默认的 `HTTP` 端口，并将此 `server` 块标记为默认服务器。
- **`server_name _;`**： 表示该 `server` 块将匹配所有请求。
- **`return 444;`**： 是一个特殊的 `Nginx` 返回指令，它会立即关闭客户端连接，相当于不做任何响应。

通过这样的配置，当有请求通过 `IP` 地址直接访问 `80` 端口时，`Nginx` 将返回一个 `444` 错误，不会提供任何内容，从而实现了禁止直接访问 `80` 端口的目的。

### 启动 web 服务 (react 项目为例)

``` nginx
server {
  # 项目启动端口
  listen            80;
  # 域名（localhost）
  server_name       _;
  # 禁止 iframe 嵌套
  add_header        X-Frame-Options SAMEORIGIN;

  # 访问地址 根路径配置
  location / {
    # 项目目录
    root            /var/nginx/html;
    # 默认读取文件
    index           index.html;
    # 配置 history 模式的刷新空白
    try_files       $uri $uri/ /index.html;
  }

  # 后缀匹配，解决静态资源找不到问题
  location ~* \.(gif|jpg|jpeg|png|css|js|ico)$ {
    root            /var/nginx/html/static/;
  }

  # 图片防盗链
  location ~/static/.*\.(jpg|jpeg|png|gif|webp)$ {
    root              /var/nginx/html;
    valid_referers    *.example.com;
    if ($invalid_referer) {
      return          403;
    }
  }

  # 访问限制
  location /static {
    root               /var/nginx/html;
    # allow 允许
    allow              39.xxx.xxx.xxx;
    # deny  拒绝
    deny               all;
  }
}
```

在这个配置中：

- **`listen 80;`**： 指定 Nginx 监听的端口号。
- **`server_name _;`**： 表示该 `server` 块将匹配所有请求。
- **`location /`**： 配置请求的 · 路径，尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。
- **`add_header X-Frame-Options SAMEORIGIN;`**：设置响应的头部信息 `X-Frame-Options`，不允许我们的页面嵌套到第三方网页里面。
- **`root /var/nginx/html;`**： 指定网站的根目录，这里是 `React` 项目构建后的静态文件目录。
- **`index index.html;`**： 指定默认的索引文件。
- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。

### 一个web服务，配置多个项目 (location 匹配路由区别)

``` nginx
server {
  listen                80;
  server_name           _;

  # 主应用
  location / {
    root                /var/nginx/html/main;
    index               index.html;
    try_files           $uri $uri/ /index.html;
  }

  # 子应用一
  location ^~ /user/ {
    proxy_pass          http://localhost:8001;
    proxy_redirect      off;
    proxy_set_header    Host $host;
    proxy_set_header    X-Real-IP $remote_addr;
    proxy_set_header    X-Forwarded-For
    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # 子应用二
  location ^~ /product/ {
    proxy_pass          http://localhost:8002;
    proxy_redirect      off;
    proxy_set_header    Host $host;
    proxy_set_header    X-Real-IP $remote_addr;
    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # 静态资源读取不到问题处理
  rewrite ^/api/profile/(.*)$ /(替换成正确路径的文件的上一层目录)/$1 last;
}

# 子应用一服务
server {
  listen                8001;
  server_name           _;
  location / {
    root                /var/nginx/html/user;
    index               index.html;
    try_files           $uri $uri/ /index.html;
  }

  location ^~ /user/ {
    alias               /var/nginx/html/user/;
    index               index.html index.htm;
    try_files           $uri /user/index.html;
  }

  # 接口代理
  location  /api {
    proxy_pass          http://localhost:3001;
  }
}

# 子应用二服务
server {
  listen                8002;
  server_name           _;

  location / {
    root                /var/nginx/html/product;
    index               index.html;
    try_files           $uri $uri/ /index.html;
  }

  location ^~ /product/ {
    alias               /var/nginx/html/product/;
    index               index.html index.htm;
    try_files           $uri /product/index.html;
  }

  # 接口代理
  location  /api {
    proxy_pass          http://localhost:3002;
  }
}
```

在上述配置中

- **`location ^~ /user/`**：使用 `^~` 修饰的 `location` 块，匹配以 `/user/` 开头的 `URI`。如果请求的 `URI` 以 `/user/` 开头，则 `Nginx` 将立即停止搜索其他 `location` 块，而是使用这个 `location` 块进行处理，`location` 块里面使用反向代理，指向服务器 `http://localhost:8001` 的地址。
- **`location ^~ /product/`**：同上，匹配以 `/product/` 开头的 `URI`。

### PC端和移动端使用不同的项目文件映射

要在 `Nginx` 中根据用户设备类型（例如PC端和移动端）使用不同的项目文件映射，您可以使用 `map` 指令创建一个变量，根据用户的 `User-Agent` 头部信息来判断设备类型，并使用if语句根据变量的值来选择不同的文件映射。以下是一个示例配置：

``` nginx
map $http_user_agent $is_mobile {
  default 0;
  ~*iphone 1;
  ~*android 1;
  ~*mobile 1;
}

server {
  listen 80;
  server_name example.com;

  root /var/www;

  location / {
    if ($is_mobile) {
      alias /var/www/mobile/;
    }
    alias /var/www/desktop/;
    try_files $uri $uri/ /index.html;
  }
}
```

或者

``` nginx
server {
  location / {
    root /var/www/desktop;
    if ($http_user_agent ~* &#x27;(mobile|android|iphone|ipad|phone)&#x27;) {
      root /var/www/mobile;
    }
    index index.html;
  }
}
```

在这个配置中：

- **`map $http_user_agent $is_mobile`**：创建一个变量 `$is_mobile`，根据 `$http_user_agent` 中的 `User-Agent` 头部信息判断设备类型。如果 `User-Agent` 中包含 `iphone`、`android`、`mobile` 等关键词，则将 `$is_mobile` 设置为 `1`，否则设置为 `0`。
- **`location /`**：对所有请求进行匹配。
- **`if ($is_mobile)`**：使用 `if` 语句根据 `$is_mobile` 的值判断设备类型。如果是移动设备，则将请求映射到 `/var/www/mobile/` 目录；否则映射到 `/var/www/desktop/` 目录。
- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `/index.html`。

需要注意的是，尽管 `if` 语句在 `Nginx` 中是有效的，但它可能会导致性能问题，并且在某些情况下可能不起作用。如果您担心性能问题，可以考虑使用更高效的方法，如根据不同的 `User-Agent` 头部信息设置不同的变量，并使用 `map` 指令匹配。

### 配置负载均衡

要在 `Nginx` 中配置负载均衡，您可以使用 `upstream` 块定义一组后端服务器，并在 `server` 块中使用 `proxy_pass` 指令将请求代理到这组后端服务器。以下是一个示例配置：

``` nginx
http {
  upstream backend {
    server backend1.example.com;
    server backend2.example.com;
    server backend3.example.com;
  }

  server {
    listen 80;
    server_name example.com;

    location / {
      proxy_pass          http://backend;
      proxy_set_header    Host $proxy_host;
      proxy_set_header    X-Real-IP $remote_addr;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
    }
  }
}
```

在这个配置中：

- **`upstream backend`**：定义了一个名为 `backend` 的负载均衡组，其中包含了三个后端服务器：`backend1.example.com`、`backend2.example.com` 和 `backend3.example.com`。
- **`server块中的location /`**：匹配所有请求。
- **`proxy_pass http://backend;`**：将请求代理到名为 `backend` 的负载均衡组中的服务器。`Nginx` 会自动根据默认的负载均衡算法（轮询）将请求分发到这组后端服务器中的一个。
- **`proxy_set_header`**：设置代理请求的头部信息，如真实 `IP` 地址、转发者 `IP` 地址和主机地址。


您还可以根据需要添加其他负载均衡配置选项，例如设置负载均衡算法、调整权重等。以下是一个更复杂的负载均衡配置示例：

``` nginx
http {
  upstream backend {
    least_conn; # 使用最少连接数算法
    server backend1.example.com weight=3;
    server backend2.example.com;
    server backend3.example.com;
  }

  server {
    listen 80;
    server_name example.com;

    location / {
      proxy_pass http://backend;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $host;
    }
  }
}
```

在这个配置中：

- **`least_conn`**：使用最少连接数算法进行负载均衡。
- **`server backend1.example.com weight=3;`**：设置 `backend1.example.com` 的权重为 `3`，比其他后端服务器更具优先级。
- **`proxy_set_header`**：设置代理请求的头部信息，如真实 `IP` 地址、转发者 `IP` 地址和主机地址。


### 总结

本文介绍了一些常用的 `Nginx` 基础配置，包括虚拟主机配置、`HTTP` 重定向、反向代理、`SSL/TLS` 配置等内容，并提供了详细的示例说明。正确配置 `Nginx` 不仅可以提高网站的性能和安全性，还能提升用户体验和搜索引擎排名。希望本文能够帮助您更好地理解和应用 `Nginx`，在实际项目中发挥其作用。

**注意：**

配置完成后，保存并关闭文件，然后重新加载Nginx以使配置生效：

``` bash
sudo systemctl reload nginx
```</div></a></li></ul></div></div></div></div></div></div></div></div></div><div style="position:fixed;z-index:9999;top:16px;left:16px;right:16px;bottom:16px;pointer-events:none"></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/651","repository_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com","labels_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/651/labels{/name}","comments_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/651/comments","events_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/651/events","html_url":"https://github.com/hankliu62/hankliu62.github.com/issues/651","id":2230261967,"node_id":"I_kwDOBiJZIc6E7xjP","number":651,"title":"Nginx常用基础配置详解","user":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"labels":[{"id":688950687,"node_id":"MDU6TGFiZWw2ODg5NTA2ODc=","url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/labels/blog","name":"blog","color":"1677ff","default":false,"description":"博客文章"},{"id":6795273556,"node_id":"LA_kwDOBiJZIc8AAAABlQelVA","url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/labels/nginx","name":"nginx","color":"086883","default":false,"description":"分类 - nginx 相关"}],"state":"open","locked":false,"assignee":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"assignees":[{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2024-04-08T05:02:43Z","updated_at":"2024-04-08T05:04:07Z","closed_at":null,"author_association":"OWNER","active_lock_reason":null,"body":"## Nginx常用基础配置详解\n\n### 介绍\n\nNginx 是一个高性能的开源 Web 服务器，它不仅可以作为 HTTP 服务器使用，还可以用作反向代理服务器、负载均衡器、缓存服务器等。在实际应用中，正确配置 Nginx 是确保网站稳定性和性能的重要步骤。本文将详细介绍一些常用的 Nginx 基础配置，包括虚拟主机配置、HTTP 重定向、反向代理等内容，并提供详细的示例说明。\n\n### 虚拟主机配置\n\n虚拟主机是 Nginx 中非常重要的概念，它允许您在一台服务器上托管多个网站。下面是一个简单的虚拟主机配置示例：\n\n```nginx\nserver {\n    listen 80;\n    server_name example.com www.example.com;\n\n    root /var/www/example;\n    index index.html index.htm;\n\n    location / {\n        try_files $uri $uri/ /index.html;\n    }\n}\n```\n\n- **`listen 80;`**：指定 `Nginx` 监听的端口号。\n- **`server_name example.com www.example.com;`**：指定虚拟主机的域名。\n- **`root /var/www/example;`**：指定网站的根目录。\n- **`index index.html index.htm;`**：指定默认的索引文件。\n- **`location /`**：配置请求的 `URL` 路径。\n- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。\n\n### HTTP 重定向\nHTTP 重定向是将一个 URL 请求重定向到另一个 URL 的过程。下面是一个简单的 HTTP 重定向配置示例：\n\n``` nginx\nserver {\n    listen 80;\n    server_name www.example.com;\n\n    return 301 http://example.com$request_uri;\n}\n```\n\n这个配置会将所有访问 `www.example.com` 的请求重定向到 `example.com`，保证网站的访问统一性。\n\n### 反向代理\n`Nginx` 反向代理是将客户端的请求转发给后端服务器的过程，常用于负载均衡和隐藏后端服务器。下面是一个简单的反向代理配置示例：\n\n``` nginx\nserver {\n  listen 80;\n  server_name www.example.com;\n\n  location / {\n    proxy_pass http://backend_server;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n  }\n}\n```\n\n- **`proxy_pass http://backend_server;`**：指定后端服务器的地址。\n- **`proxy_set_header`**：设置代理请求的头部信息，如 `Host`、`X-Real-IP`、`X-Forwarded-For` 等。\n\n### SSL/TLS 配置\n\n`SSL/TLS` 是保护网站安全的重要手段，`Nginx` 提供了丰富的 `SSL/TLS` 配置选项。下面是一个简单的 `SSL/TLS` 配置示例：\n\n``` nginx\nserver {\n  listen                      80;\n  server_name                 www.example.com;\n  # 将 http 重定向转移到 https\n  return 301 https://$server_name$request_uri;\n}\n\nserver {\n  listen                      443 ssl;\n  server_name                 www.example.com;\n  ssl_certificate             /etc/nginx/ssl/www.example.com.pem;\n  ssl_certificate_key         /etc/nginx/ssl/www.example.com.key;\n  ssl_session_timeout         10m;\n  ssl_ciphers                 ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n  ssl_protocols               TLSv1 TLSv1.1 TLSv1.2;\n  ssl_prefer_server_ciphers   on;\n\n  location / {\n    root                    /var/nginx/html;\n    index                   index.html index.htm index.md;\n    try_files               $uri $uri/ /index.html;\n  }\n}\n\n```\n\n- **`listen 443 ssl;`**：指定监听的端口号，并开启 SSL。\n- **`ssl_certificate 和 ssl_certificate_key`**：指定 SSL 证书和私钥的路径。\n- **`ssl_protocols`**：指定允许的 SSL/TLS 协议版本。\n- **`ssl_prefer_server_ciphers on;`**：优先使用服务器端的加密算法。\n- **`ssl_ciphers`**：指定允许的加密算法。\n\n### 隐藏 Nginx 版本信息\n\n要隐藏 `Nginx` 版本信息，您可以通过在配置文件中进行相应的设置来实现。具体来说，您需要修改 `nginx.conf` 文件，使用 `server_tokens off;` 指令来关闭 `Nginx` 的版本号显示。以下是如何进行配置的示例：\n\n``` nginx\nhttp {\n  server_tokens off;\n}\n```\n\n将上述配置添加到 `nginx.conf` 文件的 `http` 块中即可禁用 `Nginx` 版本号显示。\n\n### 禁止 ip 直接访问 80 端口\n\n要禁止直接通过 `IP` 地址访问 `80` 端口，您可以通过 `Nginx` 配置文件进行相应的设置。具体来说，您可以配置一个默认的 `server` 块，用于捕获所有请求，并返回一个错误页面或者重定向到其他地址。以下是一个示例配置：\n\n``` nginx\nserver {\n  listen 80 default_server;\n  server_name _;\n\n  return 444;\n}\n```\n\n在这个配置中：\n\n- **`listen 80 default_server;`**：指定 `Nginx` 监听默认的 `HTTP` 端口，并将此 `server` 块标记为默认服务器。\n- **`server_name _;`**： 表示该 `server` 块将匹配所有请求。\n- **`return 444;`**： 是一个特殊的 `Nginx` 返回指令，它会立即关闭客户端连接，相当于不做任何响应。\n\n通过这样的配置，当有请求通过 `IP` 地址直接访问 `80` 端口时，`Nginx` 将返回一个 `444` 错误，不会提供任何内容，从而实现了禁止直接访问 `80` 端口的目的。\n\n### 启动 web 服务 (react 项目为例)\n\n``` nginx\nserver {\n  # 项目启动端口\n  listen            80;\n  # 域名（localhost）\n  server_name       _;\n  # 禁止 iframe 嵌套\n  add_header        X-Frame-Options SAMEORIGIN;\n\n  # 访问地址 根路径配置\n  location / {\n    # 项目目录\n    root            /var/nginx/html;\n    # 默认读取文件\n    index           index.html;\n    # 配置 history 模式的刷新空白\n    try_files       $uri $uri/ /index.html;\n  }\n\n  # 后缀匹配，解决静态资源找不到问题\n  location ~* \\.(gif|jpg|jpeg|png|css|js|ico)$ {\n    root            /var/nginx/html/static/;\n  }\n\n  # 图片防盗链\n  location ~/static/.*\\.(jpg|jpeg|png|gif|webp)$ {\n    root              /var/nginx/html;\n    valid_referers    *.example.com;\n    if ($invalid_referer) {\n      return          403;\n    }\n  }\n\n  # 访问限制\n  location /static {\n    root               /var/nginx/html;\n    # allow 允许\n    allow              39.xxx.xxx.xxx;\n    # deny  拒绝\n    deny               all;\n  }\n}\n```\n\n在这个配置中：\n\n- **`listen 80;`**： 指定 Nginx 监听的端口号。\n- **`server_name _;`**： 表示该 `server` 块将匹配所有请求。\n- **`location /`**： 配置请求的 · 路径，尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。\n- **`add_header X-Frame-Options SAMEORIGIN;`**：设置响应的头部信息 `X-Frame-Options`，不允许我们的页面嵌套到第三方网页里面。\n- **`root /var/nginx/html;`**： 指定网站的根目录，这里是 `React` 项目构建后的静态文件目录。\n- **`index index.html;`**： 指定默认的索引文件。\n- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。\n\n### 一个web服务，配置多个项目 (location 匹配路由区别)\n\n``` nginx\nserver {\n  listen                80;\n  server_name           _;\n\n  # 主应用\n  location / {\n    root                /var/nginx/html/main;\n    index               index.html;\n    try_files           $uri $uri/ /index.html;\n  }\n\n  # 子应用一\n  location ^~ /user/ {\n    proxy_pass          http://localhost:8001;\n    proxy_redirect      off;\n    proxy_set_header    Host $host;\n    proxy_set_header    X-Real-IP $remote_addr;\n    proxy_set_header    X-Forwarded-For\n    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n\n  # 子应用二\n  location ^~ /product/ {\n    proxy_pass          http://localhost:8002;\n    proxy_redirect      off;\n    proxy_set_header    Host $host;\n    proxy_set_header    X-Real-IP $remote_addr;\n    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n\n  # 静态资源读取不到问题处理\n  rewrite ^/api/profile/(.*)$ /(替换成正确路径的文件的上一层目录)/$1 last;\n}\n\n# 子应用一服务\nserver {\n  listen                8001;\n  server_name           _;\n  location / {\n    root                /var/nginx/html/user;\n    index               index.html;\n    try_files           $uri $uri/ /index.html;\n  }\n\n  location ^~ /user/ {\n    alias               /var/nginx/html/user/;\n    index               index.html index.htm;\n    try_files           $uri /user/index.html;\n  }\n\n  # 接口代理\n  location  /api {\n    proxy_pass          http://localhost:3001;\n  }\n}\n\n# 子应用二服务\nserver {\n  listen                8002;\n  server_name           _;\n\n  location / {\n    root                /var/nginx/html/product;\n    index               index.html;\n    try_files           $uri $uri/ /index.html;\n  }\n\n  location ^~ /product/ {\n    alias               /var/nginx/html/product/;\n    index               index.html index.htm;\n    try_files           $uri /product/index.html;\n  }\n\n  # 接口代理\n  location  /api {\n    proxy_pass          http://localhost:3002;\n  }\n}\n```\n\n在上述配置中\n\n- **`location ^~ /user/`**：使用 `^~` 修饰的 `location` 块，匹配以 `/user/` 开头的 `URI`。如果请求的 `URI` 以 `/user/` 开头，则 `Nginx` 将立即停止搜索其他 `location` 块，而是使用这个 `location` 块进行处理，`location` 块里面使用反向代理，指向服务器 `http://localhost:8001` 的地址。\n- **`location ^~ /product/`**：同上，匹配以 `/product/` 开头的 `URI`。\n\n### PC端和移动端使用不同的项目文件映射\n\n要在 `Nginx` 中根据用户设备类型（例如PC端和移动端）使用不同的项目文件映射，您可以使用 `map` 指令创建一个变量，根据用户的 `User-Agent` 头部信息来判断设备类型，并使用if语句根据变量的值来选择不同的文件映射。以下是一个示例配置：\n\n``` nginx\nmap $http_user_agent $is_mobile {\n  default 0;\n  ~*iphone 1;\n  ~*android 1;\n  ~*mobile 1;\n}\n\nserver {\n  listen 80;\n  server_name example.com;\n\n  root /var/www;\n\n  location / {\n    if ($is_mobile) {\n      alias /var/www/mobile/;\n    }\n    alias /var/www/desktop/;\n    try_files $uri $uri/ /index.html;\n  }\n}\n```\n\n或者\n\n``` nginx\nserver {\n  location / {\n    root /var/www/desktop;\n    if ($http_user_agent ~* '(mobile|android|iphone|ipad|phone)') {\n      root /var/www/mobile;\n    }\n    index index.html;\n  }\n}\n```\n\n在这个配置中：\n\n- **`map $http_user_agent $is_mobile`**：创建一个变量 `$is_mobile`，根据 `$http_user_agent` 中的 `User-Agent` 头部信息判断设备类型。如果 `User-Agent` 中包含 `iphone`、`android`、`mobile` 等关键词，则将 `$is_mobile` 设置为 `1`，否则设置为 `0`。\n- **`location /`**：对所有请求进行匹配。\n- **`if ($is_mobile)`**：使用 `if` 语句根据 `$is_mobile` 的值判断设备类型。如果是移动设备，则将请求映射到 `/var/www/mobile/` 目录；否则映射到 `/var/www/desktop/` 目录。\n- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `/index.html`。\n\n需要注意的是，尽管 `if` 语句在 `Nginx` 中是有效的，但它可能会导致性能问题，并且在某些情况下可能不起作用。如果您担心性能问题，可以考虑使用更高效的方法，如根据不同的 `User-Agent` 头部信息设置不同的变量，并使用 `map` 指令匹配。\n\n### 配置负载均衡\n\n要在 `Nginx` 中配置负载均衡，您可以使用 `upstream` 块定义一组后端服务器，并在 `server` 块中使用 `proxy_pass` 指令将请求代理到这组后端服务器。以下是一个示例配置：\n\n``` nginx\nhttp {\n  upstream backend {\n    server backend1.example.com;\n    server backend2.example.com;\n    server backend3.example.com;\n  }\n\n  server {\n    listen 80;\n    server_name example.com;\n\n    location / {\n      proxy_pass          http://backend;\n      proxy_set_header    Host $proxy_host;\n      proxy_set_header    X-Real-IP $remote_addr;\n      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n  }\n}\n```\n\n在这个配置中：\n\n- **`upstream backend`**：定义了一个名为 `backend` 的负载均衡组，其中包含了三个后端服务器：`backend1.example.com`、`backend2.example.com` 和 `backend3.example.com`。\n- **`server块中的location /`**：匹配所有请求。\n- **`proxy_pass http://backend;`**：将请求代理到名为 `backend` 的负载均衡组中的服务器。`Nginx` 会自动根据默认的负载均衡算法（轮询）将请求分发到这组后端服务器中的一个。\n- **`proxy_set_header`**：设置代理请求的头部信息，如真实 `IP` 地址、转发者 `IP` 地址和主机地址。\n\n\n您还可以根据需要添加其他负载均衡配置选项，例如设置负载均衡算法、调整权重等。以下是一个更复杂的负载均衡配置示例：\n\n``` nginx\nhttp {\n  upstream backend {\n    least_conn; # 使用最少连接数算法\n    server backend1.example.com weight=3;\n    server backend2.example.com;\n    server backend3.example.com;\n  }\n\n  server {\n    listen 80;\n    server_name example.com;\n\n    location / {\n      proxy_pass http://backend;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n      proxy_set_header Host $host;\n    }\n  }\n}\n```\n\n在这个配置中：\n\n- **`least_conn`**：使用最少连接数算法进行负载均衡。\n- **`server backend1.example.com weight=3;`**：设置 `backend1.example.com` 的权重为 `3`，比其他后端服务器更具优先级。\n- **`proxy_set_header`**：设置代理请求的头部信息，如真实 `IP` 地址、转发者 `IP` 地址和主机地址。\n\n\n### 总结\n\n本文介绍了一些常用的 `Nginx` 基础配置，包括虚拟主机配置、`HTTP` 重定向、反向代理、`SSL/TLS` 配置等内容，并提供了详细的示例说明。正确配置 `Nginx` 不仅可以提高网站的性能和安全性，还能提升用户体验和搜索引擎排名。希望本文能够帮助您更好地理解和应用 `Nginx`，在实际项目中发挥其作用。\n\n**注意：**\n\n配置完成后，保存并关闭文件，然后重新加载Nginx以使配置生效：\n\n``` bash\nsudo systemctl reload nginx\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/651/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/651/timeline","performed_via_github_app":null,"state_reason":null},"menus":["## Nginx常用基础配置详解\n\n### 介绍\n\nNginx 是一个高性能的开源 Web 服务器，它不仅可以作为 HTTP 服务器使用，还可以用作反向代理服务器、负载均衡器、缓存服务器等。在实际应用中，正确配置 Nginx 是确保网站稳定性和性能的重要步骤。本文将详细介绍一些常用的 Nginx 基础配置，包括虚拟主机配置、HTTP 重定向、反向代理等内容，并提供详细的示例说明。\n\n### 虚拟主机配置\n\n虚拟主机是 Nginx 中非常重要的概念，它允许您在一台服务器上托管多个网站。下面是一个简单的虚拟主机配置示例：\n\n```nginx\nserver {\n    listen 80;\n    server_name example.com www.example.com;\n\n    root /var/www/example;\n    index index.html index.htm;\n\n    location / {\n        try_files $uri $uri/ /index.html;\n    }\n}\n```\n\n- **`listen 80;`**：指定 `Nginx` 监听的端口号。\n- **`server_name example.com www.example.com;`**：指定虚拟主机的域名。\n- **`root /var/www/example;`**：指定网站的根目录。\n- **`index index.html index.htm;`**：指定默认的索引文件。\n- **`location /`**：配置请求的 `URL` 路径。\n- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。\n\n### HTTP 重定向\nHTTP 重定向是将一个 URL 请求重定向到另一个 URL 的过程。下面是一个简单的 HTTP 重定向配置示例：\n\n``` nginx\nserver {\n    listen 80;\n    server_name www.example.com;\n\n    return 301 http://example.com$request_uri;\n}\n```\n\n这个配置会将所有访问 `www.example.com` 的请求重定向到 `example.com`，保证网站的访问统一性。\n\n### 反向代理\n`Nginx` 反向代理是将客户端的请求转发给后端服务器的过程，常用于负载均衡和隐藏后端服务器。下面是一个简单的反向代理配置示例：\n\n``` nginx\nserver {\n  listen 80;\n  server_name www.example.com;\n\n  location / {\n    proxy_pass http://backend_server;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n  }\n}\n```\n\n- **`proxy_pass http://backend_server;`**：指定后端服务器的地址。\n- **`proxy_set_header`**：设置代理请求的头部信息，如 `Host`、`X-Real-IP`、`X-Forwarded-For` 等。\n\n### SSL/TLS 配置\n\n`SSL/TLS` 是保护网站安全的重要手段，`Nginx` 提供了丰富的 `SSL/TLS` 配置选项。下面是一个简单的 `SSL/TLS` 配置示例：\n\n``` nginx\nserver {\n  listen                      80;\n  server_name                 www.example.com;\n  # 将 http 重定向转移到 https\n  return 301 https://$server_name$request_uri;\n}\n\nserver {\n  listen                      443 ssl;\n  server_name                 www.example.com;\n  ssl_certificate             /etc/nginx/ssl/www.example.com.pem;\n  ssl_certificate_key         /etc/nginx/ssl/www.example.com.key;\n  ssl_session_timeout         10m;\n  ssl_ciphers                 ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n  ssl_protocols               TLSv1 TLSv1.1 TLSv1.2;\n  ssl_prefer_server_ciphers   on;\n\n  location / {\n    root                    /var/nginx/html;\n    index                   index.html index.htm index.md;\n    try_files               $uri $uri/ /index.html;\n  }\n}\n\n```\n\n- **`listen 443 ssl;`**：指定监听的端口号，并开启 SSL。\n- **`ssl_certificate 和 ssl_certificate_key`**：指定 SSL 证书和私钥的路径。\n- **`ssl_protocols`**：指定允许的 SSL/TLS 协议版本。\n- **`ssl_prefer_server_ciphers on;`**：优先使用服务器端的加密算法。\n- **`ssl_ciphers`**：指定允许的加密算法。\n\n### 隐藏 Nginx 版本信息\n\n要隐藏 `Nginx` 版本信息，您可以通过在配置文件中进行相应的设置来实现。具体来说，您需要修改 `nginx.conf` 文件，使用 `server_tokens off;` 指令来关闭 `Nginx` 的版本号显示。以下是如何进行配置的示例：\n\n``` nginx\nhttp {\n  server_tokens off;\n}\n```\n\n将上述配置添加到 `nginx.conf` 文件的 `http` 块中即可禁用 `Nginx` 版本号显示。\n\n### 禁止 ip 直接访问 80 端口\n\n要禁止直接通过 `IP` 地址访问 `80` 端口，您可以通过 `Nginx` 配置文件进行相应的设置。具体来说，您可以配置一个默认的 `server` 块，用于捕获所有请求，并返回一个错误页面或者重定向到其他地址。以下是一个示例配置：\n\n``` nginx\nserver {\n  listen 80 default_server;\n  server_name _;\n\n  return 444;\n}\n```\n\n在这个配置中：\n\n- **`listen 80 default_server;`**：指定 `Nginx` 监听默认的 `HTTP` 端口，并将此 `server` 块标记为默认服务器。\n- **`server_name _;`**： 表示该 `server` 块将匹配所有请求。\n- **`return 444;`**： 是一个特殊的 `Nginx` 返回指令，它会立即关闭客户端连接，相当于不做任何响应。\n\n通过这样的配置，当有请求通过 `IP` 地址直接访问 `80` 端口时，`Nginx` 将返回一个 `444` 错误，不会提供任何内容，从而实现了禁止直接访问 `80` 端口的目的。\n\n### 启动 web 服务 (react 项目为例)\n\n``` nginx\nserver {\n  # 项目启动端口\n  listen            80;\n  # 域名（localhost）\n  server_name       _;\n  # 禁止 iframe 嵌套\n  add_header        X-Frame-Options SAMEORIGIN;\n\n  # 访问地址 根路径配置\n  location / {\n    # 项目目录\n    root            /var/nginx/html;\n    # 默认读取文件\n    index           index.html;\n    # 配置 history 模式的刷新空白\n    try_files       $uri $uri/ /index.html;\n  }\n\n  # 后缀匹配，解决静态资源找不到问题\n  location ~* \\.(gif|jpg|jpeg|png|css|js|ico)$ {\n    root            /var/nginx/html/static/;\n  }\n\n  # 图片防盗链\n  location ~/static/.*\\.(jpg|jpeg|png|gif|webp)$ {\n    root              /var/nginx/html;\n    valid_referers    *.example.com;\n    if ($invalid_referer) {\n      return          403;\n    }\n  }\n\n  # 访问限制\n  location /static {\n    root               /var/nginx/html;\n    # allow 允许\n    allow              39.xxx.xxx.xxx;\n    # deny  拒绝\n    deny               all;\n  }\n}\n```\n\n在这个配置中：\n\n- **`listen 80;`**： 指定 Nginx 监听的端口号。\n- **`server_name _;`**： 表示该 `server` 块将匹配所有请求。\n- **`location /`**： 配置请求的 · 路径，尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。\n- **`add_header X-Frame-Options SAMEORIGIN;`**：设置响应的头部信息 `X-Frame-Options`，不允许我们的页面嵌套到第三方网页里面。\n- **`root /var/nginx/html;`**： 指定网站的根目录，这里是 `React` 项目构建后的静态文件目录。\n- **`index index.html;`**： 指定默认的索引文件。\n- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `index.html`。\n\n### 一个web服务，配置多个项目 (location 匹配路由区别)\n\n``` nginx\nserver {\n  listen                80;\n  server_name           _;\n\n  # 主应用\n  location / {\n    root                /var/nginx/html/main;\n    index               index.html;\n    try_files           $uri $uri/ /index.html;\n  }\n\n  # 子应用一\n  location ^~ /user/ {\n    proxy_pass          http://localhost:8001;\n    proxy_redirect      off;\n    proxy_set_header    Host $host;\n    proxy_set_header    X-Real-IP $remote_addr;\n    proxy_set_header    X-Forwarded-For\n    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n\n  # 子应用二\n  location ^~ /product/ {\n    proxy_pass          http://localhost:8002;\n    proxy_redirect      off;\n    proxy_set_header    Host $host;\n    proxy_set_header    X-Real-IP $remote_addr;\n    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n\n  # 静态资源读取不到问题处理\n  rewrite ^/api/profile/(.*)$ /(替换成正确路径的文件的上一层目录)/$1 last;\n}\n\n# 子应用一服务\nserver {\n  listen                8001;\n  server_name           _;\n  location / {\n    root                /var/nginx/html/user;\n    index               index.html;\n    try_files           $uri $uri/ /index.html;\n  }\n\n  location ^~ /user/ {\n    alias               /var/nginx/html/user/;\n    index               index.html index.htm;\n    try_files           $uri /user/index.html;\n  }\n\n  # 接口代理\n  location  /api {\n    proxy_pass          http://localhost:3001;\n  }\n}\n\n# 子应用二服务\nserver {\n  listen                8002;\n  server_name           _;\n\n  location / {\n    root                /var/nginx/html/product;\n    index               index.html;\n    try_files           $uri $uri/ /index.html;\n  }\n\n  location ^~ /product/ {\n    alias               /var/nginx/html/product/;\n    index               index.html index.htm;\n    try_files           $uri /product/index.html;\n  }\n\n  # 接口代理\n  location  /api {\n    proxy_pass          http://localhost:3002;\n  }\n}\n```\n\n在上述配置中\n\n- **`location ^~ /user/`**：使用 `^~` 修饰的 `location` 块，匹配以 `/user/` 开头的 `URI`。如果请求的 `URI` 以 `/user/` 开头，则 `Nginx` 将立即停止搜索其他 `location` 块，而是使用这个 `location` 块进行处理，`location` 块里面使用反向代理，指向服务器 `http://localhost:8001` 的地址。\n- **`location ^~ /product/`**：同上，匹配以 `/product/` 开头的 `URI`。\n\n### PC端和移动端使用不同的项目文件映射\n\n要在 `Nginx` 中根据用户设备类型（例如PC端和移动端）使用不同的项目文件映射，您可以使用 `map` 指令创建一个变量，根据用户的 `User-Agent` 头部信息来判断设备类型，并使用if语句根据变量的值来选择不同的文件映射。以下是一个示例配置：\n\n``` nginx\nmap $http_user_agent $is_mobile {\n  default 0;\n  ~*iphone 1;\n  ~*android 1;\n  ~*mobile 1;\n}\n\nserver {\n  listen 80;\n  server_name example.com;\n\n  root /var/www;\n\n  location / {\n    if ($is_mobile) {\n      alias /var/www/mobile/;\n    }\n    alias /var/www/desktop/;\n    try_files $uri $uri/ /index.html;\n  }\n}\n```\n\n或者\n\n``` nginx\nserver {\n  location / {\n    root /var/www/desktop;\n    if ($http_user_agent ~* '(mobile|android|iphone|ipad|phone)') {\n      root /var/www/mobile;\n    }\n    index index.html;\n  }\n}\n```\n\n在这个配置中：\n\n- **`map $http_user_agent $is_mobile`**：创建一个变量 `$is_mobile`，根据 `$http_user_agent` 中的 `User-Agent` 头部信息判断设备类型。如果 `User-Agent` 中包含 `iphone`、`android`、`mobile` 等关键词，则将 `$is_mobile` 设置为 `1`，否则设置为 `0`。\n- **`location /`**：对所有请求进行匹配。\n- **`if ($is_mobile)`**：使用 `if` 语句根据 `$is_mobile` 的值判断设备类型。如果是移动设备，则将请求映射到 `/var/www/mobile/` 目录；否则映射到 `/var/www/desktop/` 目录。\n- **`try_files $uri $uri/ /index.html;`**：尝试寻找与请求 `URI` 匹配的文件，如果找不到则返回 `/index.html`。\n\n需要注意的是，尽管 `if` 语句在 `Nginx` 中是有效的，但它可能会导致性能问题，并且在某些情况下可能不起作用。如果您担心性能问题，可以考虑使用更高效的方法，如根据不同的 `User-Agent` 头部信息设置不同的变量，并使用 `map` 指令匹配。\n\n### 配置负载均衡\n\n要在 `Nginx` 中配置负载均衡，您可以使用 `upstream` 块定义一组后端服务器，并在 `server` 块中使用 `proxy_pass` 指令将请求代理到这组后端服务器。以下是一个示例配置：\n\n``` nginx\nhttp {\n  upstream backend {\n    server backend1.example.com;\n    server backend2.example.com;\n    server backend3.example.com;\n  }\n\n  server {\n    listen 80;\n    server_name example.com;\n\n    location / {\n      proxy_pass          http://backend;\n      proxy_set_header    Host $proxy_host;\n      proxy_set_header    X-Real-IP $remote_addr;\n      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n  }\n}\n```\n\n在这个配置中：\n\n- **`upstream backend`**：定义了一个名为 `backend` 的负载均衡组，其中包含了三个后端服务器：`backend1.example.com`、`backend2.example.com` 和 `backend3.example.com`。\n- **`server块中的location /`**：匹配所有请求。\n- **`proxy_pass http://backend;`**：将请求代理到名为 `backend` 的负载均衡组中的服务器。`Nginx` 会自动根据默认的负载均衡算法（轮询）将请求分发到这组后端服务器中的一个。\n- **`proxy_set_header`**：设置代理请求的头部信息，如真实 `IP` 地址、转发者 `IP` 地址和主机地址。\n\n\n您还可以根据需要添加其他负载均衡配置选项，例如设置负载均衡算法、调整权重等。以下是一个更复杂的负载均衡配置示例：\n\n``` nginx\nhttp {\n  upstream backend {\n    least_conn; # 使用最少连接数算法\n    server backend1.example.com weight=3;\n    server backend2.example.com;\n    server backend3.example.com;\n  }\n\n  server {\n    listen 80;\n    server_name example.com;\n\n    location / {\n      proxy_pass http://backend;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n      proxy_set_header Host $host;\n    }\n  }\n}\n```\n\n在这个配置中：\n\n- **`least_conn`**：使用最少连接数算法进行负载均衡。\n- **`server backend1.example.com weight=3;`**：设置 `backend1.example.com` 的权重为 `3`，比其他后端服务器更具优先级。\n- **`proxy_set_header`**：设置代理请求的头部信息，如真实 `IP` 地址、转发者 `IP` 地址和主机地址。\n\n\n### 总结\n\n本文介绍了一些常用的 `Nginx` 基础配置，包括虚拟主机配置、`HTTP` 重定向、反向代理、`SSL/TLS` 配置等内容，并提供了详细的示例说明。正确配置 `Nginx` 不仅可以提高网站的性能和安全性，还能提升用户体验和搜索引擎排名。希望本文能够帮助您更好地理解和应用 `Nginx`，在实际项目中发挥其作用。\n\n**注意：**\n\n配置完成后，保存并关闭文件，然后重新加载Nginx以使配置生效：\n\n``` bash\nsudo systemctl reload nginx\n```"]},"__N_SSG":true},"page":"/articles/[id]","query":{"id":"651"},"buildId":"01n3oM-TaM2WlnAyxyv2V","assetPrefix":"/toolkit","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>