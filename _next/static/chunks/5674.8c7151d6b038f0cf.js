"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5674],{15674:function(e,t,n){let r;n.r(t),n.d(t,{default:function(){return tS}});var o=n(85893),a=n(93967),i=n.n(a),l=n(34812),s=n(20942),u=n(67294),c=n(43018),d=n(91747),f=n.n(d),m=n(7739),g=n.n(m),h=n(27361),p=n.n(h),v=n(18721),y=n.n(v),b=n(1469),w=n.n(b);async function N(e,t){if(!e)return null;let n=p()(e,t),r=[...t].pop(),o=p()(e,t.slice(0,-1));return o?await C(o,async e=>{switch(e){case"identifier.tableName":return{type:"tableName",variant:r,token:n,tableInfo:o};case"identifier.column":if("name"===r)return{type:"tableField",token:n};return null;case"identifier.columnAfterGroup":return{type:"tableFieldAfterGroup",token:n,groupName:o.groupName.value};case"function":return{type:"functionName",token:n}}}):null}function k(e,t,n){if(!e||0===t.length)return null;let r=p()(e,t);if(!r)throw Error("Path not found from ast!");return r.token||"statement"!==r.type||n&&!0!==n(r)?t.length>1?k(e,t.slice(0,-1),n):null:r}async function x(e,t,n){let r=await N(e,t),o=k(e,t);if(!o)return[];switch(o.variant){case"select":return S(o,p()(o,"from.sources",[]),r,n);case"join":{let o=[...t];o.pop();let a=k(e,o,e=>"select"===e.variant);return S(a,p()(a,"from.sources",[]),r,n)}}return[]}async function S(e,t,n,r){return(await Promise.all(t.map(t=>F(e,t,n,r)))).flat().filter(e=>!!e)}async function F(e,t,n,r){return C(t,async o=>{switch(o){case"statement.tableSource":return[...await F(e,t.source,n,r),...w()(t.joins)?await S(e,p()(t,"joins",[]),n,r):[]];case"statement.join":return F(e,t.join,n,r);case"identifier.table":{let o=await r(t.name,n.token.value,e),a=p()(t,"name.tableNames",[]),i=null,l=p()(t,"alias.value");if(l)i=l;else{let e=0;for(let n of a){let r=p()(t,"name.".concat(n,".value"));r&&(e++,i=r)}e>1&&(i=null)}return o.map(e=>({...e,tableInfo:t.name,groupPickerName:i,originFieldName:e.label}))}case"statement.select":{let e=[],o=await S(t,t.from.sources,n,r);return e=1===t.result.length&&"*"===t.result[0].name.value?[...o]:o.map(e=>{let n=t.result.find(t=>!0===p()(t.name,"token")?t.name.value===e.label:"identifier"===p()(t.name,"type")&&"columnAfterGroup"===p()(t.name,"variant")?p()(t.name,"name.value")===e.label:"identifier"===p()(t.name,"type")&&"groupAll"===p()(t.name,"variant")&&p()(t.name,"groupName.value")===e.groupPickerName);return n?n.alias?{...e,label:n.alias.value}:e:null}).filter(e=>null!==e),y()(t,"alias.value")&&(e=e.map(e=>({...e,groupPickerName:p()(t,"alias.value")}))),e}default:return null}})}async function C(e,t){return e?t(e.variant?"".concat(e.type,".").concat(e.variant):e.type):null}async function E(e,t,n,r){return(await x(e,r,n)).find(e=>e.label===t.token.value)||null}class A{tokenize(e){let t;let n=[],r=0;for(;e.length>0;){let o=this.getNextToken(e);if(!o||!o.token)throw Error('Lexer: Unexpected string "'.concat(e,'".'));if(!(t=o.token).value)throw Error("Lexer: Regex parse error, please check your lexer config.");t.position=[r,r+t.value.length-1],r+=t.value.length,e=e.slice(t.value.length),o.config.ignore||n.push(t)}return n}getNextToken(e){for(let t of this.lexerConfig)for(let n of t.regexes){let r=this.getTokenOnFirstMatch({input:e,type:t.type,regex:n});if(r)return{token:r,config:t}}return null}getTokenOnFirstMatch(e){let{input:t,type:n,regex:r}=e,o=t.match(r);if(o)return{type:n,value:o[1]}}constructor(e){this.lexerConfig=e}}n(44908),n(45578);class T{constructor(e){this.parentIndex=e,this.childs=[],this.astResults=[],this.creatorFunction=null,this.solveAst=null}}class P{constructor(e){this.parentIndex=e,this.childs=[]}}class I{constructor(e,t,n){this.chainFunction=e,this.parentIndex=t,this.parser=n,this.run=()=>this.chainFunction()(this.parentNode,this.chainFunction,this.parentIndex,this.parser)}}class j{constructor(e,t,n){var r=this;this.matchFunction=e,this.matching=t,this.parentIndex=n,this.run=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return r.matchFunction(e,t)}}}function O(e,t){return null!==e&&(e&&e.toLowerCase())===(t&&t.toLowerCase())}function V(e,t,n){let r=e.read();return r?t(r)?(n&&e.next(),{token:r,match:!0}):{token:r,match:!1}:{token:null,match:!1}}function L(e,t){return n=>{function r(){return(t,r)=>e(t,n,r)}return r.parserName="match",r.displayName=t,r}}let M=L((e,t,n)=>V(e,e=>{var n;return n=e.value,"string"==typeof t?O(n,t):t.some(e=>O(n,e))},n)),K=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={includes:[],excludes:[],...t};return L((t,r,o)=>V(t,t=>!!n.includes.some(e=>O(e,t.value))||!n.excludes.some(e=>O(e,t.value))&&t.type===e,o),e)()},_=()=>({token:null,match:!0}),H=()=>({token:null,match:!0}),q=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)throw Error("Must have arguments!");return B([B(...t)(e=>1===t.length?e[0]:e),!0])(e=>e[0])},G=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)throw Error("Must have arguments!");let r=()=>B(B(...t)(e=>1===t.length?e[0]:e),q(r))(e=>e[1]?[e[0],...e[1]]:[e[0]]);return r},R=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)throw Error("Must have arguments!");return q(G(...t))};function D(e){let t;let n=!1,r=[];return function(){if(r.push(arguments),!n){for(n=!0;r.length>0;)t=e.apply(this,r.shift());return n=!1,t}}}let z=(e,t,n,r)=>{if(Array.isArray(e)){let o=new P(n);return o.parentNode=t,o.childs=e.map((e,t)=>z(e,o,t,r)),o}if("string"==typeof e){let r=new j(M(e)(),{type:"string",value:e},n);return r.parentNode=t,r}if("boolean"==typeof e){if(e){let e=new j(_,{type:"loose",value:!0},n);return e.parentNode=t,e}let r=new j(H,{type:"loose",value:!1},n);return r.parentNode=t,r}if("function"==typeof e){if("match"===e.parserName){let r=new j(e(),{type:"special",value:e.displayName},n);return r.parentNode=t,r}if("chainNodeFactory"===e.parserName)return e(t,null,n,r);let o=new I(e,n,r);return o.parentNode=t,o}throw Error("unknow element in chain ".concat(e))},B=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e,n=function(n,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,i=new T(o);return i.parentNode=n,i.creatorFunction=r,i.solveAst=e,i.childs=t.map((e,t)=>z(e,i,t,a)),r&&function(e,t){if(t.firstSet.has(e.creatorFunction))return;let n=function e(t,n,r){if(t instanceof T){if(t.childs[0])return e(t.childs[0],n,r)}else if(t instanceof P)return t.childs.reduce((t,o)=>[...t,...e(o,n,r)],[]);else if(t instanceof j)return[t];else if(t instanceof I)return r.relatedSet.has(t.chainFunction)?r.relatedSet.get(t.chainFunction).add(n):r.relatedSet.set(t.chainFunction,new Set([n])),[t.chainFunction];else throw Error("Unexpected node: ".concat(t))}(e,e.creatorFunction,t);t.firstOrFunctionSet.set(e.creatorFunction,n),function e(t,n){if(n.firstSet.has(t))return;let r=n.firstOrFunctionSet.get(t).reduce((e,t)=>("string"==typeof t&&n.firstSet.has(t)?e=[...e,...n.firstSet.get(t)]:e.push(t),e),[]);n.firstOrFunctionSet.set(t,r),r.every(e=>e instanceof j)&&(n.firstSet.set(t,r),n.relatedSet.has(t)&&n.relatedSet.get(t).forEach(t=>e))}(e.creatorFunction,t)}(i,a),i};return n.parserName="chainNodeFactory",n}},U=D(e=>{let{node:t,store:n,visiterOption:r,childIndex:o}=e;if(n.stop){Q(t,n,r);return}if(!t)throw Error("no node!");if(r.onCallVisiter&&r.onCallVisiter(t,n),t instanceof T){if(function(e,t,n,r){if(n.enableFirstSet&&e.creatorFunction&&0===r&&t.parser.firstSet.has(e.creatorFunction))return!t.parser.firstSet.get(e.creatorFunction).some(e=>e.run(t.scanner,!1).match)&&($(e,t,n),!0)}(t,n,r,o))return;W({node:t,store:n,visiterOption:r,childIndex:o})}else if(t instanceof P)W({node:t,store:n,visiterOption:r,childIndex:o});else if(t instanceof j){if("loose"===t.matching.type){if(!0===t.matching.value)J(t,n,r,null);else throw Error("Not support loose false!")}else r.onMatchNode(t,n,r)}else if(t instanceof I){let e=t.chainFunction.name,o=t.run();o.functionName=e,t.parentNode.childs[t.parentIndex]=o,U({node:o,store:n,visiterOption:r,childIndex:0})}else throw Error("Unexpected node type: ".concat(t))});function W(e){let{node:t,store:n,visiterOption:r,childIndex:o}=e;if(t instanceof T){let e=t.childs[o];e?U({node:e,store:n,visiterOption:r,childIndex:0}):J(t,n,r,r.generateAst?t.solveAst(t.astResults):null)}else{let e=t.childs[o];if(o+1<t.childs.length&&function(e){let{node:t,store:n,visiterOption:r,tokenIndex:o,childIndex:a,addToNextMatchNodeFinders:i}=e;n.restChances.push({node:t,tokenIndex:o,childIndex:a})}({node:t,store:n,visiterOption:r,tokenIndex:n.scanner.getIndex(),childIndex:o+1,addToNextMatchNodeFinders:!0}),e)U({node:e,store:n,visiterOption:r,childIndex:0});else throw Error("tree node unexpect end")}}let J=D((e,t,n,r)=>{if(t.stop){Q(e,t,n);return}if(n.onVisiterNextNode&&n.onVisiterNextNode(e,t),!e.parentNode)return void(t.scanner.isEnd()?n.onSuccess&&n.onSuccess():$(e,t,n));if(e.parentNode instanceof T)n.generateAst&&(e.parentNode.astResults[e.parentIndex]=r),U({node:e.parentNode,store:t,visiterOption:n,childIndex:e.parentIndex+1});else if(e.parentNode instanceof P)J(e.parentNode,t,n,r);else throw Error("Unexpected parent node type: ".concat(e.parentNode))});function $(e,t,n){if(0===t.restChances.length){Q(e,t,n);return}let r=t.restChances.pop();t.scanner.setIndex(r.tokenIndex),U({node:r.node,store:t,visiterOption:n,childIndex:r.childIndex})}function Q(e,t,n){n.onFail&&n.onFail(e)}r=[{type:"whitespace",regexes:[/^(\s+)/],ignore:!0},{type:"comment",regexes:[/^((?:#|--).*?(?:\n|$))/,/^(\/\*[^]*?(?:\*\/|$))/],ignore:!0},{type:"number",regexes:[/^(\d+(\.\d+)?|0x[\dA-Fa-f]+|0b[01]+)\b/]},{type:"word",regexes:[/^(\w+)/,/^(\${\w+})/]},{type:"string",regexes:[/^((?=")"[^"\\]*(?:\\[\S\s][^"\\]*)*")/,/^((?=')'[^'\\]*(?:\\[\S\s][^'\\]*)*')/,/^((?=`)`[^\\`]*(?:\\[\S\s][^\\`]*)*`)/]},{type:"special",regexes:[/^(\(|\))/,/^(!=|<>|==|<=|>=|!<|!>|\|\||::|->>|->|~~\*|~~|!~~\*|!~~|~\*|!~\*|!~|.)/]}],e=>new A(r).tokenize(e);let Z=["select","create","insert","from","where","order","limit","by","sounds","like","is","in","between","regexp","isnull","lateral","left","right","inner","outer","join"],X=()=>B([B(["char","varchar","tinytext","text","mediumtext","longtext"])(e=>e[0]),B(["tinyint","smallint","mediumint","int","integer","bigint"])(e=>e[0]),B(["real","double","float"])(e=>e[0]),B(["decimal","numberic"])(e=>e[0]),B(["date","tinyblob","blob","mediumblob","longblob","bool","boolean"])(e=>e[0]),B(["bit","time","timestamp","datetime","binary","varbinary","year"])(e=>e[0]),B(["enum","set"])(e=>e[0]),B("geometrycollection","linestring","multilinestring","multipoint","multipolygon","point","polygon")(e=>e[0])])(e=>e[0]),Y=()=>B(et,"=",[en,er])(),ee=()=>B(Y,R(",",Y))(),et=()=>B([K("cursor"),K("word",{excludes:Z})])(e=>e[0]),en=()=>B(K("string"))(e=>e[0]),er=()=>B(K("number"))(e=>e[0]),eo=()=>B([et,en])(e=>e[0]),ea=()=>B([et,en,ei])(e=>e[0]),ei=()=>B(q(["-","+"]),er)(),el=()=>B(["and","&&","xor","or","||"])(e=>e[0]),es=()=>B(["&&","||"])(e=>e[0]),eu=()=>B(["=",">","<","<=",">=","<>","!=","<=>"])(e=>e[0]),ec=()=>B(["not","!"])(e=>e[0]),ed=()=>B(["all","distinct","distinctrow","high_priority","straight_join","sql_small_result","sql_big_result","sql_buffer_result","sql_cache","sql_no_cache","sql_calc_found_rows"])(e=>e[0]);function ef(e){return e.filter(e=>null!=e).reduce((e,t)=>e.concat(t),[])}function em(e){let t={type:"identifier",variant:"tableName"};for(let n of Object.keys(e))t[n]=e[n];return t.tableNames=Object.keys(e),t}let eg=()=>B([eh,eA,e_,eK,e4,ts,tm,tg])(e=>e[0]),eh=()=>B("select",ey,q(ev),q(eR),q(eJ),q(ep,eh))(e=>{let t={type:"statement",variant:"select",result:e[1],from:e[2]};return e[5]&&(t.union=e[5]),t}),ep=()=>B("union",["all","distinct"])(),ev=()=>B("from",ex,q(eN),q(eG),q(eM))(e=>({sources:e[1],where:e[2],group:e[3],having:e[4]})),ey=()=>B(ew,R(eb))(ef),eb=()=>B(",",ew)(e=>e[1]),ew=()=>B([B(R("not"),[B(tl,q(eU))(e=>e[0]),B("(",tl,")")()],q(eE))(e=>({type:"identifier",variant:"column",name:e[1],alias:e[2]})),"*"])(e=>e[0]),eN=()=>B("where",e6)(e=>e[1]),ek=()=>B(tn,R(",",tn))(),ex=()=>B(eS,R(B(",",eS)(e=>e[1])))(ef),eS=()=>B(eF,R(eC))(e=>({source:e[0],joins:e[1],type:"statement",variant:"tableSource"})),eF=()=>B([B(eL,q(eE))(e=>({type:"identifier",variant:"table",name:e[0],alias:e[1]})),B([eh,B("(",eh,")")(e=>e[1])],eE)(e=>({...e[0],alias:e[1]}))])(e=>e[0]),eC=()=>B(["join","straight_join",B(["inner","cross","full"],"join")(),B(["left","right"],q("outer"),"join")(),B("natural",q(["left","right"],q("outer")),"join")()],eF,q("on",e6))(e=>({type:"statement",variant:"join",join:e[1],conditions:e[2]})),eE=()=>B([B("as",eo)(e=>e[1]),eo])(e=>e[0]),eA=()=>B("create","table",eo,"(",ej,")",q(eT))(),eT=()=>B("with","(",eP,")")(),eP=()=>B(eI,R(",",eI))(),eI=()=>B(et,"=",en)(),ej=()=>B(eO,R(",",eO))(),eO=()=>B(eo,X)(),eV=()=>chain(wordSym,optional(",",eV))(),eL=()=>B([B(eo)(),B(eo,".",eo)(e=>[e[0],e[2]])])(e=>1===e[0].length?em({namespace:null,tableName:e[0][0]}):2===e[0].length?em({namespace:e[0][0],tableName:e[0][1]}):void 0),eM=()=>B("having",e6)(),eK=()=>B("create","view",et,"as",eh)(),e_=()=>B("insert",q("ignore"),"into",eL,q(eH),[eh])(e=>({type:"statement",variant:"insert",into:{type:"indentifier",variant:"table",name:e[3]},result:e[5]})),eH=()=>B("(",eq,")")(),eq=()=>B(et,R(",",et))(),eG=()=>B("group","by",ek)(),eR=()=>B("order","by",eD)(),eD=()=>B(ez,R(",",ez))(),ez=()=>B(e6,q(["asc","desc"]))(),eB=()=>B([et,B("partition","by",e6)()])(e=>e),eU=()=>B("over","(",eW,")")(),eW=()=>B([eB,B(tl,eR)()],R(",",eW))(),eJ=()=>B("limit",[er,B(er,",",er)(),B(er,"offset",er)()])(),e$=()=>B([eZ,eX,eQ])(e=>e[0]),eQ=()=>B("if","(",te,",",tl,",",tl,")")(e=>({type:"function",name:"if",args:[e[2],e[4],e[6]]})),eZ=()=>B("cast","(",tl,"as",X,")")(e=>({type:"function",name:"cast",args:[e[2],e[4]]})),eX=()=>B(et,"(",q(eY),")",q("filter","(",eN,")"))(e=>({type:"function",name:e[0],args:e[2]})),eY=()=>B(e0,R(",",e0))(),e0=()=>B(R(ed),[tn,e1])(e=>e),e1=()=>B("case",G(e2),q("else",[tn,"null"]),["end",B("end","as",et)()])(),e2=()=>B("when",e6,"then",to)(),e4=()=>B("set",e3)(),e3=()=>B(e5,R(",",e5))(),e5=()=>B(e8,"=",["true","false",en,er])(),e8=()=>B(et,R(".",et))(),e6=()=>B(e7,R(el,e6))(ef),e7=()=>B([B("(",e6,")")(),B(ec,e6)(),B(e9)],q(B("is",q("not"),["true","false","unknown"])()))(e=>e[0]),e9=()=>B(te,R(["isnull",B([B("is","not")(),"is","not"],["null",tn])()]))(ef),te=()=>B([B(tn,tt)(),B("(",te,")",tt)()])(),tt=()=>B(q([B(eu,tn)(),B("sounds","like",tn)(),tr]),q(["or",te]))(),tn=()=>B(tl)(e=>({type:"identifier",variant:"column",name:e[0]})),tr=()=>B(q("is"),q("not"),[B("in","(",[eh,ek],")")(),B("between",tl,"and",te)(),B("like",tl,q("escape",tl))(),B("regexp",tl)(),"null"])(),to=()=>B(ta,R(es,ta))(e=>e[1]?[e[0],e[1]]:e[0]),ta=()=>B([e$,e1,B(ea,q([B(".","*")(e=>({type:"identifier",variant:"groupAll"})),B(":",eX)(),ti]))(e=>e[1]?{...e[1],groupName:e[0]}:e[0]),"*"])(e=>e[0]),ti=()=>B(".",[en,er,B(et)(e=>({type:"identifier",variant:"columnAfterGroup",name:e[0]}))])(e=>e[1]),tl=()=>(function(e){let t=()=>B(r,n)(e=>e[0]),n=()=>B(q(i,r,n))(),r=()=>B(l,o)(e=>e[0]),o=()=>B(q(a,l,o))(),a=()=>B(["*","/","%"])(e=>e[0]),i=()=>B(["+","-"])(e=>e[0]),l=()=>B([B("(",t,")")(e=>e[1]),e])(e=>e[0]);return t})(to)(),ts=()=>B("create","index",tu,tc,eN)(),tu=()=>B(en,R(".",en))(),tc=()=>B("ON",en,"(",tf,")")(),td=()=>B(en,q(["ASC","DESC"]))(),tf=()=>B(td,R(",",td))(),tm=()=>B("create","function",et,"as",en)(),tg=()=>B("UPDATE",eF,"SET",ee,q(eN))();var th=n(14035),tp=n.n(th);class tv{constructor(e){this.monaco=e,this.monacoEditorVersion="0.15.6",this.parserType="odps",this.language="sql",this.tableNames=["dt","b2b","tmall","test"],this.tableColumns={dt:Array.from({length:8}).fill(1).map((e,t)=>"dt".concat(t+1)),b2b:Array.from({length:8}).fill(1).map((e,t)=>"b2b".concat(t+1)),tmall:Array.from({length:8}).fill(1).map((e,t)=>"tmall".concat(t+1)),test:Array.from({length:8}).fill(1).map((e,t)=>"test".concat(t+1))},this.onParse=e=>{},this.onSuggestTableNames=e=>(console.log(e,"cursorInfo----------------------------"),Promise.resolve(this.tableNames.map(e=>({label:e,insertText:e,sortText:"A".concat(e),kind:this.monaco.languages.CompletionItemKind.Folder})))),this.onSuggestTableFields=e=>{let t=p()(e,"namespace.value","")+p()(e,"tableName.value","");return Promise.resolve((this.tableColumns[t]||["aa","bb","cc"]).map(e=>({label:e,insertText:e,sortText:"B".concat(e),kind:this.monaco.languages.CompletionItemKind.Field})))},this.pipeKeywords=e=>e.filter(e=>"string"===e.type).map(e=>{let t=/[A-Za-z]+/.test(e.value.toString())?tp()(e.value.toString()):e.value.toString();return{label:t,insertText:t,documentation:"documentation",detail:"detail",kind:this.monaco.languages.CompletionItemKind.Keyword,sortText:"W".concat(e.value)}}),this.onSuggestFunctionName=e=>Promise.resolve(["sum","count"].map(e=>({label:e,insertText:e,sortText:"C".concat(e),kind:this.monaco.languages.CompletionItemKind.Function}))),this.onSuggestFieldGroup=e=>({label:e,insertText:e,sortText:"D".concat(e),kind:this.monaco.languages.CompletionItemKind.Folder}),this.onHoverTableField=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve([{value:"onHoverTableField"},{value:"```json\n".concat(JSON.stringify(t,null,2),"\n```")}])},this.onHoverTableName=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve([{value:"onHoverTableName"},{value:"```json\n".concat(JSON.stringify(t,null,2),"\n```")}])},this.onHoverFunctionName=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve([{value:"onHoverFunctionName"},{value:"```json\n".concat(JSON.stringify(t,null,2),"\n```")}])}}}let ty=["0.13.2","0.15.6"],tb=new function(){return new Worker(n.p+"static/chunks/parser.worker-e88214461e376851.worker.js")},tw=0,tN=async(e,t,n)=>{let r=++tw,o=null,a=null,i=new Promise((e,t)=>{o=e,a=t});return tb.postMessage({text:e,index:t,parserType:n}),tb.onmessage=e=>{r===tw?o(e.data):a()},i};function tk(e,t){switch(t){case"0.13.2":return e;case"0.15.6":return{suggestions:e};default:throw Error("Not supported version")}}let tx=(e,t)=>{let{value:n="",defaultValue:r="",className:a,onChange:d=()=>{},onMount:m=(e,t)=>{}}=e,h=(0,u.useRef)(null),p=(0,u.useRef)(null);function v(){return p.current}return(0,u.useImperativeHandle)(t,()=>({getEditor:v,monaco:l}),[]),(0,u.useEffect)(()=>(h.current&&(p.current=l.editor.create(h.current,{readOnly:!1,language:"sql",acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:"on",accessibilityPageSize:10,accessibilitySupport:"off",autoClosingBrackets:"always",autoClosingDelete:"always",autoClosingOvertype:"always",autoClosingQuotes:"always",autoIndent:"none",automaticLayout:!0,foldingStrategy:"indentation",codeLens:!1,codeLensFontFamily:"",codeLensFontSize:14,colorDecorators:!1,comments:{ignoreEmptyLines:!0,insertSpace:!0},contextmenu:!0,columnSelection:!1,autoSurround:"never",copyWithSyntaxHighlighting:!0,cursorBlinking:"blink",cursorSmoothCaretAnimation:"off",cursorStyle:"line",cursorSurroundingLines:0,cursorSurroundingLinesStyle:"all",cursorWidth:2,minimap:{enabled:!1},folding:!0,links:!0,overviewRulerBorder:!1,renderLineHighlight:"gutter",roundedSelection:!1,scrollBeyondLastLine:!1,theme:"light"===(0,c.gh)()?"vs-dark":"vs-light"}),p.current.onDidChangeModelContent(()=>{d(p.current.getValue())}),function(e){let t="editor.action.formatDocument",{handler:n,when:r}=s.P.getCommand(t);e._standaloneKeybindingService.addDynamicKeybinding(t,l.KeyMod.CtrlCmd|l.KeyCode.KeyS,n,r)}(p.current),m(p.current,l),function(e,t,n){if(n=f()(n||{},new tv(e)),-1===ty.indexOf(n.monacoEditorVersion))throw Error("monaco-editor version ".concat(n.monacoEditorVersion," is not allowed, only support ").concat(ty.join(" ")));let r=null,o=0;t.onDidChangeModelContent(a=>{let i=++o;r=new Promise(r=>{setTimeout(()=>{let a=t.getModel();tN(t.getValue(),a.getOffsetAt(t.getPosition()),n.parserType).then(l=>{if(r(l),i===o){if(n.onParse(l),l.error){let t="incomplete"===l.error.reason?"Incomplete, expect next input: \n".concat(l.error.suggestions.map(e=>e.value).join("\n")):"Wrong input, expect: \n".concat(l.error.suggestions.map(e=>e.value).join("\n")),r=l.error.token?{startLineNumber:a.getPositionAt(l.error.token.position[0]).lineNumber,startColumn:a.getPositionAt(l.error.token.position[0]).column,endLineNumber:a.getPositionAt(l.error.token.position[1]).lineNumber,endColumn:a.getPositionAt(l.error.token.position[1]).column+1}:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0};a.getPositionAt(l.error.token),e.editor.setModelMarkers(a,n.language,[{...r,message:t,severity:function(e,t){switch(t){case"0.13.2":return e.Severity.Error;case"0.15.6":return e.MarkerSeverity.Error;default:throw Error("Not supported version")}}(e,n.monacoEditorVersion)}])}else e.editor.setModelMarkers(t.getModel(),n.language,[])}})})})}),e.languages.registerCompletionItemProvider(n.language,{triggerCharacters:" $.:{}=abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),provideCompletionItems:async()=>{let e=o,t=await r;if(e!==o)return tk([],n.monacoEditorVersion);let a=await N(t.ast,t.cursorKeyPath),i=n.pipeKeywords(t.nextMatchings);if(!a)return tk(i,n.monacoEditorVersion);switch(a.type){case"tableField":{let e=await x(t.ast,t.cursorKeyPath,n.onSuggestTableFields),r=g()(e.filter(e=>null!==e.groupPickerName),"groupPickerName");return tk([...e,...i,...await n.onSuggestFunctionName(a.token.value),...r?Object.keys(r).map(e=>n.onSuggestFieldGroup(e)):[]],n.monacoEditorVersion)}case"tableFieldAfterGroup":return tk([...(await x(t.ast,t.cursorKeyPath,n.onSuggestTableFields)).filter(e=>e.groupPickerName===a.groupName),...i],n.monacoEditorVersion);case"tableName":return tk([...await n.onSuggestTableNames(a),...i],n.monacoEditorVersion);case"functionName":return n.onSuggestFunctionName(a.token.value);default:return tk(i,n.monacoEditorVersion)}}}),e.languages.registerHoverProvider(n.language,{provideHover:async(r,o)=>{let a=await tN(t.getValue(),r.getOffsetAt(o),n.parserType),i=await N(a.ast,a.cursorKeyPath);if(!i)return null;let l=[];switch(i.type){case"tableField":{let e=await E(a.ast,i,n.onSuggestTableFields,a.cursorKeyPath);l=await n.onHoverTableField(i.token.value,e);break}case"tableFieldAfterGroup":{let e=await E(a.ast,i,n.onSuggestTableFields,a.cursorKeyPath);l=await n.onHoverTableField(i.token.value,e);break}case"tableName":l=await n.onHoverTableName(i);break;case"functionName":l=await n.onHoverFunctionName(i.token.value)}return{range:e.Range.fromPositions(r.getPositionAt(i.token.position[0]),r.getPositionAt(i.token.position[1]+1)),contents:l}}})}(l,p.current)),()=>{p.current&&p.current.dispose()}),[]),(0,u.useEffect)(()=>{if(null==p?void 0:p.current){var e;let t=null===(e=p.current)||void 0===e?void 0:e.getValue();r&&t!==r&&p.current.setValue(r)}},[r]),(0,u.useEffect)(()=>{if(null==p?void 0:p.current){var e;(null===(e=p.current)||void 0===e?void 0:e.getValue())!==n&&p.current.setValue(n)}},[n]),(0,u.useEffect)(()=>{let e=(0,c.GT)(function(e){l.editor.setTheme("light"===e?"vs-dark":"vs-light")});return()=>e()},[]),(0,u.useEffect)(()=>{let e=new ResizeObserver(()=>{window.setTimeout(()=>p.current.layout(),0)});return e.observe(h.current),()=>{e.disconnect()}},[]),(0,o.jsx)("div",{ref:h,className:i()("relative min-h-[600px] flex-auto",{[a]:a})})};tx.displayName="SqlEditor";var tS=(0,u.forwardRef)(tx)},43018:function(e,t,n){function r(){var e;return(null===(e=document.querySelector("html"))||void 0===e?void 0:e.classList.contains("dark"))?"dark":"light"}function o(e){let t=document.querySelector("html"),n=new MutationObserver(n=>{for(let r of n)"attributes"===r.type&&"class"===r.attributeName&&((null==t?void 0:t.classList.contains("dark"))?e("dark"):e("light"))});return n.observe(t,{attributes:!0}),()=>{n.disconnect()}}n.d(t,{GT:function(){return o},gh:function(){return r}})}}]);