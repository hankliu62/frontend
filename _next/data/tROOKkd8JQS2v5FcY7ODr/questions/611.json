{"pageProps":{"issue":{"url":"https://api.github.com/repos/hankliu62/interview/issues/611","repository_url":"https://api.github.com/repos/hankliu62/interview","labels_url":"https://api.github.com/repos/hankliu62/interview/issues/611/labels{/name}","comments_url":"https://api.github.com/repos/hankliu62/interview/issues/611/comments","events_url":"https://api.github.com/repos/hankliu62/interview/issues/611/events","html_url":"https://github.com/hankliu62/interview/issues/611","id":2252009824,"node_id":"I_kwDOLNphd86GOvFg","number":611,"title":"vite å¦‚ä½•å¤„ç† commonjs","user":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"labels":[{"id":6547468588,"node_id":"LA_kwDOLNphd88AAAABhkJxLA","url":"https://api.github.com/repos/hankliu62/interview/labels/webpack","name":"webpack","color":"923874","default":false,"description":"Webpackç›¸å…³"}],"state":"open","locked":false,"assignee":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"assignees":[{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/hankliu62/interview/milestones/3","html_url":"https://github.com/hankliu62/interview/milestone/3","labels_url":"https://api.github.com/repos/hankliu62/interview/milestones/3/labels","id":10707686,"node_id":"MI_kwDOLNphd84Ao2Lm","number":3,"title":"3","description":"æè¿°é—®é¢˜éš¾åº¦ï¼Œéš¾åº¦3ğŸŒŸ","creator":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"open_issues":14,"closed_issues":0,"state":"open","created_at":"2024-03-20T03:36:24Z","updated_at":"2024-04-19T04:15:32Z","due_on":null,"closed_at":null},"comments":0,"created_at":"2024-04-19T03:36:38Z","updated_at":"2024-04-19T03:36:38Z","closed_at":null,"author_association":"OWNER","active_lock_reason":null,"body":"Vite é»˜è®¤ä¸æ”¯æŒ CommonJS æ¨¡å—ï¼Œå› ä¸ºå®ƒé‡‡ç”¨ ES æ¨¡å—ä½œä¸ºä¸»è¦çš„æ¨¡å—ç³»ç»Ÿã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€äº›æ–¹å¼æ¥å¤„ç† CommonJS æ¨¡å—ï¼š\r\n\r\n1. **ä½¿ç”¨æ’ä»¶ï¼š** Vite æä¾›äº† `@vitejs/plugin-vue` å’Œ `@vitejs/plugin-react-refresh` ç­‰æ’ä»¶æ¥å¤„ç† Vue å’Œ React åº”ç”¨ä¸­çš„ CommonJS æ¨¡å—ã€‚ä½ å¯ä»¥å°è¯•ä½¿ç”¨è¿™äº›æ’ä»¶æ¥æ”¯æŒä½ çš„é¡¹ç›®ä¸­çš„ CommonJS æ¨¡å—ã€‚\r\n\r\n2. **æ‰‹åŠ¨è½¬æ¢ï¼š** å¦‚æœä½ çš„é¡¹ç›®ä¸­åªæœ‰å°‘é‡çš„ CommonJS æ¨¡å—ï¼Œä½ å¯ä»¥æ‰‹åŠ¨å°†å®ƒä»¬è½¬æ¢æˆ ES æ¨¡å—ã€‚ä½ å¯ä»¥ä½¿ç”¨å·¥å…·å¦‚ `esm` æˆ– `rollup-plugin-commonjs` ç­‰æ¥è¿›è¡Œè½¬æ¢ã€‚\r\n\r\n3. **ä½¿ç”¨ Vite çš„ `transform` é’©å­ï¼š** Vite æä¾›äº†ä¸€ä¸ª `transform` é’©å­ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè‡ªå®šä¹‰ä»£ç è½¬æ¢çš„é€»è¾‘ã€‚ä½ å¯ä»¥ç¼–å†™è‡ªå·±çš„è½¬æ¢æ’ä»¶æ¥å¤„ç† CommonJS æ¨¡å—ã€‚\r\n\r\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Vite `transform` é’©å­å¤„ç† CommonJS æ¨¡å—çš„ç®€å•ç¤ºä¾‹ï¼š\r\n\r\n```javascript\r\n// vite.config.js\r\nimport { defineConfig } from 'vite';\r\n\r\nexport default defineConfig({\r\n  plugins: [],\r\n  build: {\r\n    rollupOptions: {\r\n      plugins: [\r\n        {\r\n          transform(code, id) {\r\n            if (id.endsWith('.js') && code.includes('require(')) {\r\n              // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–å…¶ä»–æ–¹å¼æ¥è½¬æ¢ CommonJS æ¨¡å—\r\n              code = code.replace(/require\\(/g, 'import(');\r\n            }\r\n            return {\r\n              code,\r\n              map: null // å¦‚æœä¸éœ€è¦ sourcemapï¼Œå¯ä»¥è¿”å› null\r\n            };\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n});\r\n```\r\nä¸Šé¢çš„ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ `Vite` é…ç½®æ–‡ä»¶ï¼Œå®ƒä½¿ç”¨äº† `transform` é’©å­æ¥æŸ¥æ‰¾å¹¶æ›¿æ¢ `JavaScript` ä»£ç ä¸­çš„ `require(`ï¼Œå°†å…¶è½¬æ¢ä¸º `ES` æ¨¡å—çš„ `import(`ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ç¼–å†™æ›´å¤æ‚çš„è½¬æ¢é€»è¾‘ã€‚\r\n\r\næ€»çš„æ¥è¯´ï¼Œè™½ç„¶ `Vite` é»˜è®¤ä¸æ”¯æŒ `CommonJS` æ¨¡å—ï¼Œä½†ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨æ’ä»¶ã€æ‰‹åŠ¨è½¬æ¢æˆ–è‡ªå®šä¹‰è½¬æ¢é€»è¾‘æ¥å¤„ç†ä½ çš„é¡¹ç›®ä¸­çš„ `CommonJS` æ¨¡å—ã€‚\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/hankliu62/interview/issues/611/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hankliu62/interview/issues/611/timeline","performed_via_github_app":null,"state_reason":null},"menus":[]},"__N_SSG":true}