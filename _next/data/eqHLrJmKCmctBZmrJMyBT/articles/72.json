{"pageProps":{"article":{"url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/72","repository_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com","labels_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/72/labels{/name}","comments_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/72/comments","events_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/72/events","html_url":"https://github.com/hankliu62/hankliu62.github.com/issues/72","id":1787404541,"node_id":"I_kwDOBiJZIc5qiaD9","number":72,"title":"Taro 开发问题记录","user":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"labels":[{"id":688950687,"node_id":"MDU6TGFiZWw2ODg5NTA2ODc=","url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/labels/blog","name":"blog","color":"1677ff","default":false,"description":"博客文章"},{"id":6536139147,"node_id":"LA_kwDOBiJZIc8AAAABhZWRiw","url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/labels/mixture","name":"mixture","color":"AF4C82","default":false,"description":"分类-混合开发相关"}],"state":"open","locked":false,"assignee":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"assignees":[{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2023-07-04T08:12:32Z","updated_at":"2024-04-08T05:16:56Z","closed_at":null,"author_association":"OWNER","active_lock_reason":null,"body":"### 1.编译较慢5s左右\r\n\r\n```\r\nyarn dev:weapp\r\n\r\nwarnning:\r\n1. 预览模式生成的文件较大，设置 NODE_ENV 为 production 可以开启压缩。\r\nExample:\r\n$ NODE_ENV=production taro build --type weapp --watch\r\n2. 建议开启持久化缓存功能，能有效提升二次编译速度，详情请参考: https://docs.taro.zone/docs/config-detail#cache。\r\n\r\nsolve:\r\n1.修改package.json内容：\r\n\"scripts\": {\r\n   \"dev:weapp\": \"taro build --type weapp --watch --env production\"\r\n}\r\n\r\n2.webpack5持久化https://juejin.cn/post/7055109923746611208\r\n```\r\n\r\n### 2.用vscode实时预览小程序模拟器，暂时没有解决方案【TODO】\r\n\r\n### 3.路由直接在app.config.ts中配置，使用\r\n``` tsx\r\nimport Taro from '@tarojs/taro'\r\nTaro.redirectTo({\r\n    url: '/pages/cartPage/index',\r\n  })\r\n```\r\n\r\n### 4.安装组件库taro-ui\r\n``` bash\r\nyarn global add @tarojs/cli\r\n\r\nimport 'taro-ui/dist/style/index.scss' // 样式全局引入一次即可\r\n```\r\n\r\n### 5.使用react hook\r\n\r\n原因：[https://zhuanlan.zhihu.com/p/137183261](https://links.jianshu.com/go?to=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F137183261)\r\n\r\n- Component非UI逻辑复用困难。\r\n- 组件的生命周期函数不适合side effect逻辑的管理。\r\n- 不友好的Class Component\r\n\r\n### 6.设置别名alias，无需eject出config/webpack.config.js\r\n\r\n[https://juejin.cn/post/6892636779850137608](https://links.jianshu.com/go?to=https%3A%2F%2Fjuejin.cn%2Fpost%2F6892636779850137608)\r\n\r\n### 7.taro无法使用相对路径引用本地图片资源\r\n[https://blog.csdn.net/qzw752890913/article/details/111395962](https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fqzw752890913%2Farticle%2Fdetails%2F111395962)\r\n\r\n###  8.引用taro-ui组件报错 “xxxx”不能用作 JSX 组件\r\n\r\n解决React中遇到的 “xxxx”不能用作 JSX 组件 问题 \r\n\r\n![4b2b951d5af24defb06f2254205bc085~tplv-k3u1fbpfcp-zoom-crop-mark_1304_1304_1304_734](https://github.com/hankliu62/hankliu62.github.com/assets/8088864/874ac1fe-d92c-48ab-a33c-678f236fdbfb)\r\n\r\n2022 年 3 月 29 日，React 18 正式版发布，带来很多新的能力，React 终于不再支持 IE（前端界的努力，让 IE 去死）。新的版本发布，React 的整体生态圈也会同步更新支持，也就导致 npm 包的依赖不可避免的产生一些混乱。记录下今天小伙伴抛出来的问题。\r\n\r\n问题背景\r\n最近公司新立了一些新项目，我就用项目中公共的脚手架模版进行了复制，但是我对其中很多包也同步做了升级，并将yarn.lock文件做了删除，重新更新了依赖（本来打算将react也升级到18，但是发现 craco 并没有明确支持 React 18， antd也还在对React 18做适配支持，所以也就停留在了 17）。\r\n\r\n然后问题就来了： \r\n\r\n\r\n```\r\n“SplitPane”不能用作 JSX 组件。\r\n  其实例类型 \"SplitPane\" 不是有效的 JSX 元素。\r\n    在这些类型中，\"render()\" 返回的类型不兼容。\r\n      不能将类型“React.ReactNode”分配给类型“import(\"/Users/tulies/data/test/my-app/node_modules/@testing-library/react/node_modules/@types/react/index\").ReactNode”。\r\n        不能将类型“{}”分配给类型“ReactNode”。ts(2786)\r\n```\r\n\r\n```\r\n'SplitPane' cannot be used as a JSX component.\r\n  Its instance type 'SplitPane' is not a valid JSX element.\r\n    The types returned by 'render()' are incompatible between these types.\r\n      Type 'React.ReactNode' is not assignable to type 'import(\"/Users/tulies/data/test/my-app/node_modules/@testing-library/react/node_modules/@types/react/index\").ReactNode'.\r\n        Type '{}' is not assignable to type 'ReactNode'.ts(2786)\r\nreact-split-pane 和 antd 的一些组件都报 “xxxxx”不能用作 JSX 组件。\r\n```\r\n\r\n分析原因\r\n先看下出问题之前的 package.json 的 dependencies 和 devDependencies 配置：\r\n``` json\r\n\"dependencies\": {\r\n    \"antd\": \"^4.19.5\",\r\n    \"react\": \"^17.0.2\",\r\n    \"react-dom\": \"^17.0.2\",\r\n    \"react-split-pane\": \"^0.1.92\",\r\n    \"typescript\": \"4.1.2\",\r\n    \"web-vitals\": \"^2.1.4\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@testing-library/jest-dom\": \"^5.16.4\",\r\n    \"@testing-library/react\": \"^13.1.1\",\r\n    \"@testing-library/user-event\": \"^13.5.0\",\r\n    \"@types/jest\": \"^27.4.1\",\r\n    \"@types/node\": \"^16.11.27\",\r\n    \"@types/react\": \"^17.0.44\",\r\n    \"@types/react-dom\": \"^17.0.15\"\r\n  }\r\n```\r\n因为是删除了 yarn.lock 文件之后发生的问题，所以肯定是npm包的依赖出现了问题。脚手架中的几个核心包我都是一直同步最新的包更新，所以应该不是这些包的问题，所以想到会不会是 React 18 的问题。 虽然想到了这点了，但是起初也没到想到会是 @types/react-dom 的问题，经过很笨的的排除法终于找到这点。\r\n\r\n@types/react-dom 的 package.json 中，dependencies 设置了@types/react 版本为 '*'，但是现在最新版本已经是 18. 虽然在 package.json 中指定了 ^17.0.44，但是 @types/react-dom 还是会安装自己的依赖包。 \r\n\r\n![2105ae7676924db29efd58147323c952~tplv-k3u1fbpfcp-zoom-in-crop-mark_1304_0_0_0](https://github.com/hankliu62/hankliu62.github.com/assets/8088864/2a3e8537-164b-4d03-8abb-6a7a5d0afd9d)\r\n\r\n解决办法\r\n通过 resolutions 指定版本\r\n\r\n``` json\r\n\"resolutions\": {\r\n  \"@types/react\": \"17.0.44\"\r\n},\r\n```\r\ntips: 我用的是 yarn ，如果您使用的是npm 的话，您还需要在 package.json 的 script 中添加如下 preinstall，通过使用[npm-force-resolutions](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fnpm-force-resolutions)包来根据 resolutions 进行版本限定。\r\n``` sh\r\n\"preinstall\": \"npm install --package-lock-only --ignore-scripts && npx npm-force-resolutions\"\r\n```\r\n[http://www.whaleal.com/thread?topicId=102](https://links.jianshu.com/go?to=http%3A%2F%2Fwww.whaleal.com%2Fthread%3FtopicId%3D102)\r\n\r\n### 9.报错 解决升级taro-ui\r\n[https://blog.csdn.net/qq_28827635/article/details/122725509](https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fqq_28827635%2Farticle%2Fdetails%2F122725509)\r\n\r\n### 10.jsx runtime\r\n\r\n[https://developer.aliyun.com/article/1130017](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1130017)\r\n\r\n[https://blog.csdn.net/qq_42592823/article/details/125498832](https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fqq_42592823%2Farticle%2Fdetails%2F125498832)\r\n\r\n### 11.ts报错 \r\n\r\n[类型“Readonly＜{}＞”上不存在属性_范天缘的博客-CSDN博客](https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fweixin_42821697%2Farticle%2Fdetails%2F117716428)\r\n\r\n### 12.微信小程序页面，底部横向滚动条，去除方法【todo】\r\n\r\n### 13.tsconfig.ts文件编译属性 \r\n\r\n[TSConfig 之 include、exclude 和 files 选项 - 掘金 (juejin.cn)](https://links.jianshu.com/go?to=https%3A%2F%2Fjuejin.cn%2Fpost%2F6924264635218542605)\r\n\r\n### 14.底部固定标签栏使用reducer\r\n\r\n[https://juejin.cn/post/6844904168382005256#heading-7](https://links.jianshu.com/go?to=https%3A%2F%2Fjuejin.cn%2Fpost%2F6844904168382005256%23heading-7)\r\n\r\n### 15.引入iconfont图标，不得不说taro-ui的图标真的太少了xd\r\n``` tsx\r\n    <AtIcon prefixClass='icon' value='daifukuan' size='30' color='#F00'></AtIcon>\r\n    <View className='icon'>&#xe600;</View>\r\n    <AtTabBar\r\n     tabList={[\r\n        { title: '待付款', iconPrefixClass:'icon', iconType: 'daifukuan'}\r\n      ]}\r\n   />\r\n```\r\n更新图库：\r\n下载iconfont替换如下文件即可\r\n\r\n![18100762-b12f1c0b69d411ad](https://github.com/hankliu62/hankliu62.github.com/assets/8088864/bf593d75-bdb4-4528-9484-8f89855b6062)\r\n\r\n### 16. icon调节亮度，可以起到加深颜色的效果\r\n参考：[https://www.codenong.com/1625681/](https://links.jianshu.com/go?to=https%3A%2F%2Fwww.codenong.com%2F1625681%2F)\r\n\r\nfilter: brightness(85%);\r\n\r\n### 17. 引入taro-ui报错\r\n```\r\n✘ [ERROR] [plugin entry] Can't resolve './style/index.scss' in '/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+taro-ui@2.3.4/node_modules/taro-ui/dist/weapp'\r\n\r\n    node_modules/.pnpm/registry.npmmirror.com+enhanced-resolve@5.15.0/node_modules/enhanced-resolve/lib/Resolver.js:369:17:\r\n      369 │       const error = new Error(\"Can't \" + message);\r\n          ╵                     ^\r\n\r\n    at finishWithoutResolve (/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+enhanced-resolve@5.15.0/node_modules/enhanced-resolve/lib/Resolver.js:369:18)\r\n    at /Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+enhanced-resolve@5.15.0/node_modules/enhanced-resolve/lib/Resolver.js:461:15\r\n    at /Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+enhanced-resolve@5.15.0/node_modules/enhanced-resolve/lib/Resolver.js:519:5\r\n    at eval (eval at create (/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+tapable@2.2.1/node_modules/tapable/lib/HookCodeFactory.js:33:10), <anonymous>:15:1)\r\n    at /Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+enhanced-resolve@5.15.0/node_modules/enhanced-resolve/lib/Resolver.js:519:5\r\n    at eval (eval at create (/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+tapable@2.2.1/node_modules/tapable/lib/HookCodeFactory.js:33:10), <anonymous>:27:1)\r\n    at /Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+enhanced-resolve@5.15.0/node_modules/enhanced-resolve/lib/DescriptionFilePlugin.js:89:43\r\n    at /Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+enhanced-resolve@5.15.0/node_modules/enhanced-resolve/lib/Resolver.js:519:5\r\n    at eval (eval at create (/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+tapable@2.2.1/node_modules/tapable/lib/HookCodeFactory.js:33:10), <anonymous>:16:1)\r\n    at /Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+enhanced-resolve@5.15.0/node_modules/enhanced-resolve/lib/forEachBail.js:39:13\r\n\r\n  This error came from the \"onResolve\" callback registered here:\r\n\r\n    node_modules/.pnpm/registry.npmmirror.com+esbuild@0.14.54/node_modules/esbuild/lib/main.js:855:22:\r\n      855 │         let promise = setup({\r\n          ╵                       ^\r\n\r\n    at setup (/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+@tarojs+webpack5-prebundle@3.6.8_@types+react@17.0.44_webpack@5.78.0/node_modules/@tarojs/webpack5-prebundle/src/prebundle/bundle.ts:114:13)\r\n    at handlePlugins (/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+esbuild@0.14.54/node_modules/esbuild/lib/main.js:855:23)\r\n    at Object.buildOrServe (/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+esbuild@0.14.54/node_modules/esbuild/lib/main.js:1149:7)\r\n    at /Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+esbuild@0.14.54/node_modules/esbuild/lib/main.js:2110:17\r\n    at new Promise (<anonymous>)\r\n    at Object.build (/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+esbuild@0.14.54/node_modules/esbuild/lib/main.js:2109:14)\r\n    at Object.build (/Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+esbuild@0.14.54/node_modules/esbuild/lib/main.js:1956:51)\r\n    at /Users/xxxxxx/Workspace/xxxxxx/hackathon_2022/lazy/lazy-miniprogram/node_modules/.pnpm/registry.npmmirror.com+@tarojs+webpack5-prebundle@3.6.8_@types+react@17.0.44_webpack@5.78.0/node_modules/@tarojs/webpack5-prebundle/src/prebundle/bundle.ts:68:18\r\n    at Generator.next (<anonymous>)\r\n\r\n  The plugin \"entry\" was triggered by this import\r\n\r\n    node_modules/.pnpm/registry.npmmirror.com+taro-ui@2.3.4/node_modules/taro-ui/dist/weapp/index.ts:2:7:\r\n      2 │ import './style/index.scss'\r\n```\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/72/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/72/timeline","performed_via_github_app":null,"state_reason":null},"menus":["### 1.编译较慢5s左右","### 2.用vscode实时预览小程序模拟器，暂时没有解决方案【TODO】","### 3.路由直接在app.config.ts中配置，使用","### 4.安装组件库taro-ui","### 5.使用react hook","### 6.设置别名alias，无需eject出config/webpack.config.js","### 7.taro无法使用相对路径引用本地图片资源","###  8.引用taro-ui组件报错 “xxxx”不能用作 JSX 组件","### 9.报错 解决升级taro-ui","### 10.jsx runtime","### 11.ts报错 ","### 12.微信小程序页面，底部横向滚动条，去除方法【todo】","### 13.tsconfig.ts文件编译属性 ","### 14.底部固定标签栏使用reducer","### 15.引入iconfont图标，不得不说taro-ui的图标真的太少了xd","### 16. icon调节亮度，可以起到加深颜色的效果","### 17. 引入taro-ui报错"]},"__N_SSG":true}