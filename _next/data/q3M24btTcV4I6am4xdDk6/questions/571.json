{"pageProps":{"issue":{"url":"https://api.github.com/repos/hankliu62/interview/issues/571","repository_url":"https://api.github.com/repos/hankliu62/interview","labels_url":"https://api.github.com/repos/hankliu62/interview/issues/571/labels{/name}","comments_url":"https://api.github.com/repos/hankliu62/interview/issues/571/comments","events_url":"https://api.github.com/repos/hankliu62/interview/issues/571/events","html_url":"https://github.com/hankliu62/interview/issues/571","id":2175308381,"node_id":"I_kwDOLNphd86BqJJd","number":571,"title":"script 元素 crossorigin 和 integrity 属性","user":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"labels":[{"id":6547468066,"node_id":"LA_kwDOLNphd88AAAABhkJvIg","url":"https://api.github.com/repos/hankliu62/interview/labels/html","name":"html","color":"13c2c2","default":false,"description":"HTML相关"},{"id":6547468110,"node_id":"LA_kwDOLNphd88AAAABhkJvTg","url":"https://api.github.com/repos/hankliu62/interview/labels/javascript","name":"javascript","color":"383040","default":false,"description":"Javascript相关"}],"state":"open","locked":false,"assignee":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"assignees":[{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2024-03-08T05:29:46Z","updated_at":"2024-03-09T03:04:59Z","closed_at":null,"author_association":"OWNER","active_lock_reason":null,"body":"### crossorigin 属性\r\n\r\n`script` 标签去请求资源的时候，`request` 是没有 `origin` 头的。\r\n\r\n`script` 标签请求跨域资源的时候，内部运行如果报错的话，`window.onerror` 捕获的时候，内部的 `error.message` 只能看到 `Script error.` 看不到完整的错误内容。这个应该是浏览器的安全策略。\r\n\r\n``` js\r\nwindow.addEventListener('error', function(msg, url, lineno, colno, error) {\r\n  console.log('error catch:', msg.message);\r\n  return false\r\n})\r\n```\r\n\r\n**设置 crossorigin属性后**\r\n\r\n1. `script` 标签去请求资源的时候，`request` 会带上 `origin` 头，然后会要求服务器进行 `cors` 校验，跨域的时候如果 `response header` 没有 `‘Access-Control-Allow-Origin’` 是不会拿到资源的。`cors` 验证通过后，拿到的`script`运行内部报错的话，`window.onerror` 捕获的时候，内部的 `error.message` 可以看到完整的错误信息。\r\n2. `crossorigin` 的属性值分为 `anonymous` 和 `use-credentials` 。如果设置了 `crossorigin` 属性，但是属性值不正确的话，默认是 `anonymous`。\r\n3. `anonymous` 代表同域会带上 `cookie` ，跨域则不带上 `cookie` ，相当于 `fecth` 请求的 `credentials: 'same-origin'`。\r\n4. `use-credentials` 跨域也会带上 `cookie` ，相当于 `fetch` 请求的 `credentials: 'include'`，这种情况下跨域的 `response header` 需要设置`'Access-Control-Allow-Credentials' = true`，否则 `cors` 失败。\r\n\r\n### integrity 属性安全验证\r\n\r\n引入远程文件存在一个问题，如果对应的文件被篡改了，那么可能会对用户造成影响。虽然cdn一般都是可靠的，但是不排除受到黑客的攻击。\r\n\r\nintegrity属性设置引入js文件的hash值，浏览器在下载js文件时候，会对js文件进行hash计算，如果一致则正常加载，否则拒绝加载运行。\r\n\r\n[生成hash值的工具地址](https://www.srihash.org/)\r\n\r\n``` html\r\n<script integrity=\"sha384-*****\" src=\"https://cdn.xxx.xx/js/index.js\"></script>\r\n```\r\n\r\n### 总结\r\n\r\n1. 设置了 `crossorigin` 就相当于开启了 `cors` 校验。\r\n2. 开启 `cors` 校验之后，跨域的 `script` 资源在运行出错的时候，`window.onerror` 可以捕获到完整的错误信息。\r\n3. `crossorigin=use-credentials`可以跨域带上`cookie`。\r\n4. `integrity`可以做远程文件安全验证","closed_by":null,"reactions":{"url":"https://api.github.com/repos/hankliu62/interview/issues/571/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hankliu62/interview/issues/571/timeline","performed_via_github_app":null,"state_reason":null},"menus":["### crossorigin 属性","### integrity 属性安全验证","### 总结"]},"__N_SSG":true}