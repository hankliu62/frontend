{"pageProps":{"issue":{"url":"https://api.github.com/repos/hankliu62/interview/issues/621","repository_url":"https://api.github.com/repos/hankliu62/interview","labels_url":"https://api.github.com/repos/hankliu62/interview/issues/621/labels{/name}","comments_url":"https://api.github.com/repos/hankliu62/interview/issues/621/comments","events_url":"https://api.github.com/repos/hankliu62/interview/issues/621/events","html_url":"https://github.com/hankliu62/interview/issues/621","id":2264899071,"node_id":"I_kwDOLNphd86G_53_","number":621,"title":"è¯´ä¸‹Viteçš„åŸç†","user":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"labels":[{"id":6547468546,"node_id":"LA_kwDOLNphd88AAAABhkJxAg","url":"https://api.github.com/repos/hankliu62/interview/labels/vue","name":"vue","color":"0E8A16","default":false,"description":"Vueç›¸å…³"},{"id":6547468588,"node_id":"LA_kwDOLNphd88AAAABhkJxLA","url":"https://api.github.com/repos/hankliu62/interview/labels/webpack","name":"webpack","color":"923874","default":false,"description":"Webpackç›¸å…³"}],"state":"open","locked":false,"assignee":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"assignees":[{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/hankliu62/interview/milestones/5","html_url":"https://github.com/hankliu62/interview/milestone/5","labels_url":"https://api.github.com/repos/hankliu62/interview/milestones/5/labels","id":10707688,"node_id":"MI_kwDOLNphd84Ao2Lo","number":5,"title":"5","description":"æè¿°é—®é¢˜éš¾åº¦ï¼Œéš¾åº¦5ğŸŒŸ","creator":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"open_issues":5,"closed_issues":0,"state":"open","created_at":"2024-03-20T03:36:41Z","updated_at":"2024-04-26T03:44:40Z","due_on":null,"closed_at":null},"comments":0,"created_at":"2024-04-26T03:44:40Z","updated_at":"2024-04-26T03:45:54Z","closed_at":null,"author_association":"OWNER","active_lock_reason":null,"body":"### èƒŒæ™¯\r\nè¿™é‡Œçš„èƒŒæ™¯ä»‹ç»ä¼šä»ä¸ `Vite` ç´§å¯†ç›¸å…³çš„ä¸¤ä¸ªæ¦‚å¿µçš„å‘å±•å²è¯´èµ·ï¼Œä¸€ä¸ªæ˜¯JavaScriptçš„æ¨¡å—åŒ–æ ‡å‡†ï¼Œå¦ä¸€ä¸ªæ˜¯å‰ç«¯æ„å»ºå·¥å…·ã€‚\r\n\r\n### å…±å­˜çš„æ¨¡å—åŒ–æ ‡å‡†\r\n\r\nä¸ºä»€ä¹ˆ JavaScript ä¼šæœ‰å¤šç§å…±å­˜çš„æ¨¡å—åŒ–æ ‡å‡†ï¼Ÿå› ä¸ºjsåœ¨è®¾è®¡ä¹‹åˆå¹¶æ²¡æœ‰æ¨¡å—åŒ–çš„æ¦‚å¿µï¼Œéšç€å‰ç«¯ä¸šåŠ¡å¤æ‚åº¦ä¸æ–­æé«˜ï¼Œæ¨¡å—åŒ–è¶Šæ¥è¶Šå—åˆ°å¼€å‘è€…çš„é‡è§†ï¼Œç¤¾åŒºå¼€å§‹æ¶Œç°å¤šç§æ¨¡å—åŒ–è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬ç›¸äº’å€Ÿé‰´ï¼Œä¹Ÿäº‰è®®ä¸æ–­ï¼Œå½¢æˆå¤šä¸ªæ´¾ç³»ï¼Œä»CommonJSå¼€å§‹ï¼Œåˆ°ES6æ­£å¼æ¨å‡ºES Modulesè§„èŒƒç»“æŸï¼Œæ‰€æœ‰äº‰è®ºï¼Œç»ˆæˆå†å²ï¼ŒES Modulesä¹Ÿæˆä¸ºå‰ç«¯é‡è¦çš„åŸºç¡€è®¾æ–½ã€‚\r\n\r\n- **`CommonJS`**ï¼šç°ä¸»è¦ç”¨äº `Node.js`ï¼ˆNode@13.2.0å¼€å§‹æ”¯æŒç›´æ¥ä½¿ç”¨ES Moduleï¼‰\r\n- **`AMD`**ï¼š`require.js` ä¾èµ–å‰ç½®ï¼Œå¸‚åœºå­˜é‡ä¸å»ºè®®ä½¿ç”¨\r\n- **`CMD`**ï¼š`sea.js` å°±è¿‘æ‰§è¡Œï¼Œå¸‚åœºå­˜é‡ä¸å»ºè®®ä½¿ç”¨\r\n- **`ES Module`**ï¼šESè¯­è¨€è§„èŒƒï¼Œæ ‡å‡†ï¼Œè¶‹åŠ¿ï¼Œæœªæ¥\r\nå¯¹æ¨¡å—åŒ–å‘å±•å²æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸‹ç‰ä¼¯å¤§ä½¬ã€Šå‰ç«¯æ¨¡å—åŒ–å¼€å‘é‚£ç‚¹å†å²ã€‹`https://github.com/seajs/seajs/issues/588`ï¼Œè€ŒViteçš„æ ¸å¿ƒæ­£æ˜¯ä¾é æµè§ˆå™¨å¯¹ES Moduleè§„èŒƒçš„å®ç°ã€‚\r\n\r\n### å‘å±•ä¸­çš„æ„å»ºå·¥å…·\r\nè¿‘äº›å¹´å‰ç«¯å·¥ç¨‹åŒ–å‘å±•è¿…é€Ÿï¼Œå„ç§æ„å»ºå·¥å…·å±‚å‡ºä¸ç©·ï¼Œç›®å‰ `Webpack` ä»ç„¶å æ®ç»Ÿæ²»åœ°ä½ï¼Œnpm æ¯å‘¨ä¸‹è½½é‡è¾¾åˆ°ä¸¤åƒå¤šä¸‡æ¬¡ã€‚ä¸‹é¢æ˜¯æˆ‘æŒ‰ npm å‘ç‰ˆæ—¶é—´çº¿åˆ—å‡ºçš„å¼€å‘è€…æ¯”è¾ƒç†ŸçŸ¥çš„ä¸€äº›æ„å»ºå·¥å…·ã€‚\r\n\r\n![image](https://github.com/hankliu62/interview/assets/8088864/42ff4c0f-221f-4e9a-947f-a56f0aafc2dd)\r\n\r\n### å½“å‰å·¥ç¨‹åŒ–ç—›ç‚¹\r\n\r\nç°åœ¨å¸¸ç”¨çš„æ„å»ºå·¥å…·å¦‚ `Webpack`ï¼Œä¸»è¦æ˜¯é€šè¿‡æŠ“å–-ç¼–è¯‘-æ„å»ºæ•´ä¸ªåº”ç”¨çš„ä»£ç ï¼ˆä¹Ÿå°±æ˜¯å¸¸è¯´çš„æ‰“åŒ…è¿‡ç¨‹ï¼‰ï¼Œç”Ÿæˆä¸€ä»½ç¼–è¯‘ã€ä¼˜åŒ–åèƒ½è‰¯å¥½å…¼å®¹å„ä¸ªæµè§ˆå™¨çš„çš„ç”Ÿäº§ç¯å¢ƒä»£ç ã€‚åœ¨å¼€å‘ç¯å¢ƒæµç¨‹ä¹ŸåŸºæœ¬ç›¸åŒï¼Œéœ€è¦å…ˆå°†æ•´ä¸ªåº”ç”¨æ„å»ºæ‰“åŒ…åï¼Œå†æŠŠæ‰“åŒ…åçš„ä»£ç äº¤ç»™ `dev server`ï¼ˆå¼€å‘æœåŠ¡å™¨ï¼‰ã€‚\r\n\r\n`Webpack` ç­‰æ„å»ºå·¥å…·çš„è¯ç”Ÿç»™å‰ç«¯å¼€å‘å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ï¼Œä½†éšç€å‰ç«¯ä¸šåŠ¡çš„å¤æ‚åŒ–ï¼Œjsä»£ç é‡å‘ˆæŒ‡æ•°å¢é•¿ï¼Œæ‰“åŒ…æ„å»ºæ—¶é—´è¶Šæ¥è¶Šä¹…ï¼Œ`dev server`ï¼ˆå¼€å‘æœåŠ¡å™¨ï¼‰æ€§èƒ½é‡åˆ°ç“¶é¢ˆï¼š\r\n\r\n- **ç¼“æ…¢çš„æœåŠ¡å¯åŠ¨**ï¼š å¤§å‹é¡¹ç›®ä¸­ `dev server` å¯åŠ¨æ—¶é—´è¾¾åˆ°å‡ åç§’ç”šè‡³å‡ åˆ†é’Ÿã€‚\r\n\r\n- **ç¼“æ…¢çš„HMRçƒ­æ›´æ–°**ï¼š å³ä½¿é‡‡ç”¨äº† `HMR` æ¨¡å¼ï¼Œå…¶çƒ­æ›´æ–°é€Ÿåº¦ä¹Ÿä¼šéšç€åº”ç”¨è§„æ¨¡çš„å¢é•¿è€Œæ˜¾è‘—ä¸‹é™ï¼Œå·²è¾¾åˆ°æ€§èƒ½ç“¶é¢ˆï¼Œæ— å¤šå°‘ä¼˜åŒ–ç©ºé—´ã€‚\r\n\r\nç¼“æ…¢çš„å¼€å‘ç¯å¢ƒï¼Œå¤§å¤§é™ä½äº†å¼€å‘è€…çš„å¹¸ç¦æ„Ÿï¼Œåœ¨ä»¥ä¸ŠèƒŒæ™¯ä¸‹ `Vite` åº”è¿è€Œç”Ÿã€‚\r\n\r\n### ä»€ä¹ˆæ˜¯Viteï¼Ÿ\r\n\r\nåŸºäº `esbuild` ä¸ `Rollup`ï¼Œä¾é æµè§ˆå™¨è‡ªèº« `ESM` ç¼–è¯‘åŠŸèƒ½ï¼Œ å®ç°æè‡´å¼€å‘ä½“éªŒçš„æ–°ä¸€ä»£æ„å»ºå·¥å…·ï¼\r\n\r\n#### æ¦‚å¿µ\r\n\r\nå…ˆä»‹ç»ä»¥ä¸‹æ–‡ä¸­ä¼šç»å¸¸æåˆ°çš„ä¸€äº›åŸºç¡€æ¦‚å¿µï¼š\r\n\r\n- **ä¾èµ–**ï¼š æŒ‡å¼€å‘ä¸ä¼šå˜åŠ¨çš„éƒ¨åˆ†(npmåŒ…ã€UIç»„ä»¶åº“)ï¼Œesbuildè¿›è¡Œé¢„æ„å»ºã€‚\r\n- **æºç **ï¼š æµè§ˆå™¨ä¸èƒ½ç›´æ¥æ‰§è¡Œçš„éjsä»£ç (.jsxã€.cssã€.vueç­‰)ï¼Œviteåªåœ¨æµè§ˆå™¨è¯·æ±‚ç›¸å…³æºç çš„æ—¶å€™è¿›è¡Œè½¬æ¢ï¼Œä»¥æä¾› `ESM` æºç ã€‚\r\n\r\n#### å¼€å‘ç¯å¢ƒ\r\n\r\n- åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿçš„ `ES Module` ç¼–è¯‘èƒ½åŠ›ï¼Œçœç•¥è´¹æ—¶çš„ç¼–è¯‘ç¯èŠ‚ï¼Œç›´ç»™æµè§ˆå™¨å¼€å‘ç¯å¢ƒæºç ï¼Œ`dev server` åªæä¾›è½»é‡æœåŠ¡ã€‚\r\n- æµè§ˆå™¨æ‰§è¡Œ `ESM` çš„ `import` æ—¶ï¼Œä¼šå‘ `dev server` å‘èµ·è¯¥æ¨¡å—çš„ `ajax` è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯¹æºç åšç®€å•å¤„ç†åè¿”å›ç»™æµè§ˆå™¨ã€‚\r\n- `Vite` ä¸­ `HMR` æ˜¯åœ¨åŸç”Ÿ `ESM` ä¸Šæ‰§è¡Œçš„ã€‚å½“ç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œ`Vite` åªéœ€è¦ç²¾ç¡®åœ°ä½¿å·²ç¼–è¾‘çš„æ¨¡å—å¤±æ´»ï¼Œä½¿å¾—æ— è®ºåº”ç”¨å¤§å°å¦‚ä½•ï¼Œ`HMR` å§‹ç»ˆèƒ½ä¿æŒå¿«é€Ÿæ›´æ–°ã€‚\r\n- ä½¿ç”¨ `esbuild` å¤„ç†é¡¹ç›®ä¾èµ–ï¼Œ`esbuild` ä½¿ç”¨ `go` ç¼–å†™ï¼Œæ¯”ä¸€èˆ¬ `node.js` ç¼–å†™çš„ç¼–è¯‘å™¨å¿«å‡ ä¸ªæ•°é‡çº§ã€‚\r\n\r\n#### ç”Ÿäº§ç¯å¢ƒ\r\n\r\n- é›†æˆ `Rollup` æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒä»£ç ï¼Œä¾èµ–å…¶æˆç†Ÿç¨³å®šçš„ç”Ÿæ€ä¸æ›´ç®€æ´çš„æ’ä»¶æœºåˆ¶ã€‚\r\n\r\n#### å¤„ç†æµç¨‹å¯¹æ¯”\r\n\r\n`Webpack` é€šè¿‡å…ˆå°†æ•´ä¸ªåº”ç”¨æ‰“åŒ…ï¼Œå†å°†æ‰“åŒ…åä»£ç æä¾›ç»™ `dev server`ï¼Œå¼€å‘è€…æ‰èƒ½å¼€å§‹å¼€å‘ã€‚\r\n\r\n![image](https://github.com/hankliu62/interview/assets/8088864/8dddb164-f1d2-4eaa-b4b7-254b5caddc60)\r\n\r\n`Vite` ç›´æ¥å°†æºç äº¤ç»™æµè§ˆå™¨ï¼Œå®ç° `dev server` ç§’å¼€ï¼Œæµè§ˆå™¨æ˜¾ç¤ºé¡µé¢éœ€è¦ç›¸å…³æ¨¡å—æ—¶ï¼Œå†å‘ `dev server` å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç®€å•å¤„ç†åï¼Œå°†è¯¥æ¨¡å—è¿”å›ç»™æµè§ˆå™¨ï¼Œå®ç°çœŸæ­£æ„ä¹‰çš„æŒ‰éœ€åŠ è½½ã€‚\r\n\r\n![image](https://github.com/hankliu62/interview/assets/8088864/d7cf145a-6104-4147-a040-d8422f6919ad)\r\n\r\n### Vite åŸºæœ¬ç”¨æ³•\r\n\r\n#### åˆ›å»ºviteé¡¹ç›®\r\n``` bash\r\nnpm create vite@latest\r\n```\r\n#### é€‰å–æ¨¡æ¿\r\n`Vite` å†…ç½® `6` ç§å¸¸ç”¨æ¨¡æ¿ä¸å¯¹åº”çš„ `TS` ç‰ˆæœ¬ï¼Œå¯æ»¡è¶³å‰ç«¯å¤§éƒ¨åˆ†å¼€å‘åœºæ™¯ï¼Œå¯ä»¥ç‚¹å‡»ä¸‹åˆ—è¡¨æ ¼ä¸­æ¨¡æ¿ç›´æ¥åœ¨ [StackBlitz](https://vite.new/) ä¸­åœ¨çº¿è¯•ç”¨ï¼Œè¿˜æœ‰å…¶ä»–æ›´å¤šçš„ [ç¤¾åŒºç»´æŠ¤æ¨¡æ¿](https://github.com/vitejs/awesome-vite#templates)å¯ä»¥ä½¿ç”¨ã€‚\r\n\r\n| JavaScript | TypeScript |\r\n| ---- | ---- |\r\n| [vanilla](https://vite.new/vanilla) | [vanilla-ts](https://vite.new/vanilla-ts) |\r\n| [vue](https://vite.new/vue) | [vue-ts](https://vite.new/vue-ts) |\r\n| [react](https://vite.new/react) | [react-ts](https://vite.new/react-ts) |\r\n| [preact](https://vite.new/preact) | [preact-ts](https://vite.new/preact-ts) |\r\n| [lit](https://vite.new/lit) | [lit-ts](https://vite.new/lit-ts) |\r\n| [svelte](https://vite.new/svelte) | [svelte-ts](https://vite.new/svelte-ts) |\r\n\r\n#### å¯åŠ¨\r\n``` bash\r\n{\r\n  \"scripts\": {\r\n    \"dev\": \"vite\", // å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œåˆ«åï¼š`vite dev`ï¼Œ`vite serve`\r\n    \"build\": \"vite build\", // ä¸ºç”Ÿäº§ç¯å¢ƒæ„å»ºäº§ç‰©\r\n    \"preview\": \"vite preview\" // æœ¬åœ°é¢„è§ˆç”Ÿäº§æ„å»ºäº§ç‰©\r\n  }\r\n}\r\n```\r\n\r\n### Vite å®ç°åŸç†\r\n\r\n#### ESbuild ç¼–è¯‘\r\n\r\nesbuild ä½¿ç”¨goç¼–å†™ï¼Œcpuå¯†é›†ä¸‹æ›´å…·æ€§èƒ½ä¼˜åŠ¿ï¼Œç¼–è¯‘é€Ÿåº¦æ›´å¿«ï¼Œä»¥ä¸‹æ‘˜è‡ªå®˜ç½‘çš„æ„å»ºé€Ÿåº¦å¯¹æ¯”ï¼š\r\n\r\n**æµè§ˆå™¨ï¼šâ€œå¼€å§‹äº†å—ï¼Ÿâ€**\r\n**æœåŠ¡å™¨ï¼šâ€œå·²ç»ç»“æŸäº†ã€‚â€**\r\n**å¼€å‘è€…ï¼šâ€œå¥½å¿«ï¼Œå¥½å–œæ¬¢ï¼ï¼â€**\r\n\r\n![image](https://github.com/hankliu62/interview/assets/8088864/31748a48-bb0c-4352-bc79-5f0066626ad7)\r\n\r\n\r\n#### ä¾èµ–é¢„æ„å»º\r\n\r\n- **æ¨¡å—åŒ–å…¼å®¹**ï¼š å¦‚å¼€å¤´èƒŒæ™¯æ‰€å†™ï¼Œç°ä»å…±å­˜å¤šç§æ¨¡å—åŒ–æ ‡å‡†ä»£ç ï¼Œ`Vite` åœ¨é¢„æ„å»ºé˜¶æ®µå°†ä¾èµ–ä¸­å„ç§å…¶ä»–æ¨¡å—åŒ–è§„èŒƒ(`CommonJS`ã€`UMD`)è½¬æ¢æˆ `ESM`ï¼Œä»¥æä¾›ç»™æµè§ˆå™¨ã€‚\r\n- **æ€§èƒ½ä¼˜åŒ–**ï¼š `npm` åŒ…ä¸­å¤§é‡çš„ `ESM` ä»£ç ï¼Œå¤§é‡çš„ `import` è¯·æ±‚ï¼Œä¼šé€ æˆç½‘ç»œæ‹¥å¡ã€‚`Vite` ä½¿ç”¨ `esbuild`ï¼Œå°†æœ‰å¤§é‡å†…éƒ¨æ¨¡å—çš„ `ESM` å…³ç³»è½¬æ¢æˆå•ä¸ªæ¨¡å—ï¼Œä»¥å‡å°‘ `import` æ¨¡å—è¯·æ±‚æ¬¡æ•°ã€‚\r\n\r\n#### æŒ‰éœ€åŠ è½½\r\n- æœåŠ¡å™¨åªåœ¨æ¥å—åˆ°importè¯·æ±‚çš„æ—¶å€™ï¼Œæ‰ä¼šç¼–è¯‘å¯¹åº”çš„æ–‡ä»¶ï¼Œå°†ESMæºç è¿”å›ç»™æµè§ˆå™¨ï¼Œå®ç°çœŸæ­£çš„æŒ‰éœ€åŠ è½½ã€‚\r\n\r\n#### ç¼“å­˜\r\n- **HTTPç¼“å­˜**ï¼š å……åˆ†åˆ©ç”¨ `http` ç¼“å­˜åšä¼˜åŒ–ï¼Œä¾èµ–ï¼ˆä¸ä¼šå˜åŠ¨çš„ä»£ç ï¼‰éƒ¨åˆ†ç”¨ `max-age`, `immutable` å¼ºç¼“å­˜ï¼Œæºç éƒ¨åˆ†ç”¨ `304`åå•†ç¼“å­˜ï¼Œæå‡é¡µé¢æ‰“å¼€é€Ÿåº¦ã€‚\r\n- **æ–‡ä»¶ç³»ç»Ÿç¼“å­˜**ï¼š `Vite` åœ¨é¢„æ„å»ºé˜¶æ®µï¼Œå°†æ„å»ºåçš„ä¾èµ–ç¼“å­˜åˆ° `node_modules/.vite` ï¼Œç›¸å…³é…ç½®æ›´æ”¹æ—¶ï¼Œæˆ–æ‰‹åŠ¨æ§åˆ¶æ—¶æ‰ä¼šé‡æ–°æ„å»ºï¼Œä»¥æå‡é¢„æ„å»ºé€Ÿåº¦ã€‚\r\n\r\n#### é‡å†™æ¨¡å—è·¯å¾„\r\n\r\næµè§ˆå™¨ `import` åªèƒ½å¼•å…¥ç›¸å¯¹/ç»å¯¹è·¯å¾„ï¼Œè€Œå¼€å‘ä»£ç ç»å¸¸ä½¿ç”¨ `npm` åŒ…åç›´æ¥å¼•å…¥ `node_module` ä¸­çš„æ¨¡å—ï¼Œéœ€è¦åšè·¯å¾„è½¬æ¢åäº¤ç»™æµè§ˆå™¨ã€‚\r\n\r\n- `es-module-lexer` æ‰«æ `import` è¯­æ³•\r\n- `magic-string` é‡å†™æ¨¡å—çš„å¼•å…¥è·¯å¾„\r\n\r\n``` js\r\n// å¼€å‘ä»£ç \r\nimport { createApp } from 'vue'\r\n\r\n// è½¬æ¢å\r\nimport { createApp } from '/node_modules/vue/dist/vue.js'\r\n```\r\n\r\n### Vite æºç åˆ†æ\r\n\r\nä¸ `Webpack-dev-server` ç±»ä¼¼ `Vite` åŒæ ·ä½¿ç”¨ `WebSocket` ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ï¼Œå®ç°çƒ­æ›´æ–°ï¼Œæºç å®ç°åŸºæœ¬å¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œæºç ä½ç½®åœ¨:\r\n\r\n- `vite/packages/vite/src/client` clientï¼ˆç”¨äºå®¢æˆ·ç«¯ï¼‰\r\n- `vite/packages/vite/src/node` serverï¼ˆç”¨äºå¼€å‘æœåŠ¡å™¨ï¼‰\r\n\r\n`client` ä»£ç ä¼šåœ¨å¯åŠ¨æœåŠ¡æ—¶æ³¨å…¥åˆ°å®¢æˆ·ç«¯ï¼Œç”¨äºå®¢æˆ·ç«¯å¯¹äº `WebSocket` æ¶ˆæ¯çš„å¤„ç†ï¼ˆå¦‚æ›´æ–°é¡µé¢æŸä¸ªæ¨¡å—ã€åˆ·æ–°é¡µé¢ï¼‰ï¼›\r\n`server` ä»£ç æ˜¯æœåŠ¡ç«¯é€»è¾‘ï¼Œç”¨äºå¤„ç†ä»£ç çš„æ„å»ºä¸é¡µé¢æ¨¡å—çš„è¯·æ±‚ã€‚\r\n\r\nç®€å•çœ‹äº†ä¸‹æºç ï¼ˆvite@2.7.2ï¼‰ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¸»è¦æ˜¯ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼ˆä»¥ä¸‹ä¸ºæºç æˆªå–ï¼Œéƒ¨åˆ†é€»è¾‘åšäº†åˆ å‡ï¼‰ï¼š\r\n\r\n1. å‘½ä»¤è¡Œå¯åŠ¨æœåŠ¡ `npm run dev` åï¼Œæºç æ‰§è¡Œ `cli.ts`ï¼Œè°ƒç”¨ `createServer` æ–¹æ³•ï¼Œåˆ›å»º `http` æœåŠ¡ï¼Œç›‘å¬å¼€å‘æœåŠ¡å™¨ç«¯å£ã€‚\r\n\r\n``` ts\r\n// æºç ä½ç½® vite/packages/vite/src/node/cli.ts\r\nconst { createServer } = await import('./server')\r\ntry {\r\n    const server = await createServer({\r\n        root,\r\n        base: options.base,\r\n        ...\r\n    })\r\n    if (!server.httpServer) {\r\n        throw new Error('HTTP server not available')\r\n    }\r\n    await server.listen()\r\n}\r\n```\r\n\r\n2. `createServer` æ–¹æ³•çš„æ‰§è¡Œåšäº†å¾ˆå¤šå·¥ä½œï¼Œå¦‚æ•´åˆé…ç½®é¡¹ã€åˆ›å»º `http` æœåŠ¡ï¼ˆæ—©æœŸé€šè¿‡ `koa` åˆ›å»ºï¼‰ã€åˆ›å»º `WebSocket` æœåŠ¡ã€åˆ›å»ºæºç çš„æ–‡ä»¶ç›‘å¬ã€æ’ä»¶æ‰§è¡Œã€`optimize` ä¼˜åŒ–ç­‰ã€‚ä¸‹é¢æ³¨é‡Šä¸­æ ‡å‡ºã€‚\r\n\r\n``` ts\r\n// æºç ä½ç½® vite/packages/vite/src/node/server/index.ts\r\nexport async function createServer(\r\n    inlineConfig: InlineConfig = {}\r\n): Promise<ViteDevServer> {\r\n    // Vite é…ç½®æ•´åˆ\r\n    const config = await resolveConfig(inlineConfig, 'serve', 'development')\r\n    const root = config.root\r\n    const serverConfig = config.server\r\n\r\n    // åˆ›å»ºhttpæœåŠ¡\r\n    const httpServer = await resolveHttpServer(serverConfig, middlewares, httpsOptions)\r\n\r\n    // åˆ›å»ºwsæœåŠ¡\r\n    const ws = createWebSocketServer(httpServer, config, httpsOptions)\r\n\r\n    // åˆ›å»ºwatcherï¼Œè®¾ç½®ä»£ç æ–‡ä»¶ç›‘å¬\r\n    const watcher = chokidar.watch(path.resolve(root), {\r\n        ignored: [\r\n            '**/node_modules/**',\r\n            '**/.git/**',\r\n            ...(Array.isArray(ignored) ? ignored : [ignored])\r\n        ],\r\n        ...watchOptions\r\n    }) as FSWatcher\r\n\r\n    // åˆ›å»ºserverå¯¹è±¡\r\n    const server: ViteDevServer = {\r\n        config,\r\n        middlewares,\r\n        httpServer,\r\n        watcher,\r\n        ws,\r\n        moduleGraph,\r\n        listen,\r\n        ...\r\n    }\r\n\r\n    // æ–‡ä»¶ç›‘å¬å˜åŠ¨ï¼Œwebsocketå‘å‰ç«¯é€šä¿¡\r\n    watcher.on('change', async (file) => {\r\n        ...\r\n        handleHMRUpdate()\r\n    })\r\n\r\n    // éå¸¸å¤šçš„ middleware\r\n    middlewares.use(...)\r\n    \r\n    // optimize\r\n    const runOptimize = async () => {...}\r\n\r\n    return server\r\n}\r\n```\r\n\r\n3. ä½¿ç”¨[chokidar](https://www.npmjs.com/package/chokidar)ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œç»‘å®šç›‘å¬äº‹ä»¶ã€‚\r\n\r\n``` ts\r\n// æºç ä½ç½® vite/packages/vite/src/node/server/index.ts\r\n  const watcher = chokidar.watch(path.resolve(root), {\r\n    ignored: [\r\n      '**/node_modules/**',\r\n      '**/.git/**',\r\n      ...(Array.isArray(ignored) ? ignored : [ignored])\r\n    ],\r\n    ignoreInitial: true,\r\n    ignorePermissionErrors: true,\r\n    disableGlobbing: true,\r\n    ...watchOptions\r\n  }) as FSWatcher\r\n```\r\n\r\n4. é€šè¿‡ [ws](https://www.npmjs.com/package/ws) æ¥åˆ›å»º `WebSocket` æœåŠ¡ï¼Œç”¨äºç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–æ—¶è§¦å‘çƒ­æ›´æ–°ï¼Œå‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚\r\n\r\n``` ts\r\n// æºç ä½ç½® vite/packages/vite/src/node/server/ws.ts\r\nexport function createWebSocketServer(...){\r\n    let wss: WebSocket\r\n    const hmr = isObject(config.server.hmr) && config.server.hmr\r\n    const wsServer = (hmr && hmr.server) || server\r\n\r\n    if (wsServer) {\r\n        wss = new WebSocket({ noServer: true })\r\n        wsServer.on('upgrade', (req, socket, head) => {\r\n            // æœåŠ¡å°±ç»ª\r\n            if (req.headers['sec-websocket-protocol'] === HMR_HEADER) {\r\n                wss.handleUpgrade(req, socket as Socket, head, (ws) => {\r\n                    wss.emit('connection', ws, req)\r\n                })\r\n            }\r\n        })\r\n    } else {\r\n        ...\r\n    }\r\n    // æœåŠ¡å‡†å¤‡å°±ç»ªï¼Œå°±èƒ½åœ¨æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ°ç†Ÿæ‚‰çš„æ‰“å° [vite] connected.\r\n    wss.on('connection', (socket) => {\r\n        socket.send(JSON.stringify({ type: 'connected' }))\r\n        ...\r\n    })\r\n    // å¤±è´¥\r\n    wss.on('error', (e: Error & { code: string }) => {\r\n        ...\r\n    })\r\n    // è¿”å›wså¯¹è±¡\r\n    return {\r\n        on: wss.on.bind(wss),\r\n        off: wss.off.bind(wss),\r\n        // å‘å®¢æˆ·ç«¯å‘é€ä¿¡æ¯\r\n        // å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è§¦å‘\r\n        send(payload: HMRPayload) {\r\n            const stringified = JSON.stringify(payload)\r\n            wss.clients.forEach((client) => {\r\n                // readyState 1 means the connection is open\r\n                client.send(stringified)\r\n            })\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n6. åœ¨æœåŠ¡å¯åŠ¨æ—¶ä¼šå‘æµè§ˆå™¨æ³¨å…¥ä»£ç ï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ `WebSocket` æ¶ˆæ¯ï¼Œå¦‚é‡æ–°å‘èµ·æ¨¡å—è¯·æ±‚ã€åˆ·æ–°é¡µé¢ã€‚\r\n\r\n``` ts\r\n//æºç ä½ç½® vite/packages/vite/src/client/client.ts\r\nasync function handleMessage(payload: HMRPayload) {\r\n  switch (payload.type) {\r\n    case 'connected':\r\n      console.log(`[vite] connected.`)\r\n      break\r\n    case 'update':\r\n      notifyListeners('vite:beforeUpdate', payload)\r\n      ...\r\n      break\r\n    case 'custom': {\r\n      notifyListeners(payload.event as CustomEventName<any>, payload.data)\r\n      ...\r\n      break\r\n    }\r\n    case 'full-reload':\r\n      notifyListeners('vite:beforeFullReload', payload)\r\n      ...\r\n      break\r\n    case 'prune':\r\n      notifyListeners('vite:beforePrune', payload)\r\n      ...\r\n      break\r\n    case 'error': {\r\n      notifyListeners('vite:error', payload)\r\n      ...\r\n      break\r\n    }\r\n    default: {\r\n      const check: never = payload\r\n      return check\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n### ä¼˜åŠ¿\r\n- å¿«ï¼å¿«ï¼éå¸¸å¿«ï¼ï¼\r\n- é«˜åº¦é›†æˆï¼Œå¼€ç®±å³ç”¨ã€‚\r\n- åŸºäº `ESM` æ€¥é€Ÿçƒ­æ›´æ–°ï¼Œæ— éœ€æ‰“åŒ…ç¼–è¯‘ã€‚\r\n- åŸºäº `esbuild` çš„ä¾èµ–é¢„å¤„ç†ï¼Œæ¯” `Webpack` ç­‰ `node` ç¼–å†™çš„ç¼–è¯‘å™¨å¿«å‡ ä¸ªæ•°é‡çº§ã€‚\r\n- å…¼å®¹ `Rollup` åºå¤§çš„æ’ä»¶æœºåˆ¶ï¼Œæ’ä»¶å¼€å‘æ›´ç®€æ´ã€‚\r\n- ä¸ä¸ `Vue` ç»‘å®šï¼Œæ”¯æŒ `React` ç­‰å…¶ä»–æ¡†æ¶ï¼Œç‹¬ç«‹çš„æ„å»ºå·¥å…·ã€‚\r\n- å†…ç½® `SSR` æ”¯æŒã€‚\r\n- å¤©ç„¶æ”¯æŒ `TS`ã€‚\r\n\r\n### ä¸è¶³\r\n- `Vue` ä»ä¸ºç¬¬ä¸€ä¼˜å…ˆæ”¯æŒï¼Œé‡èº«å®šåšçš„ç¼–è¯‘æ’ä»¶ï¼Œå¯¹ `React` çš„æ”¯æŒä¸å¦‚ `Vue` å¼ºå¤§ã€‚\r\n- è™½ç„¶å·²ç»æ¨å‡º `2.0` æ­£å¼ç‰ˆï¼Œå·²ç»å¯ä»¥ç”¨äºæ­£å¼çº¿ä¸Šç”Ÿäº§ï¼Œä½†ç›®å‰å¸‚åœºä¸Šå®è·µå°‘ã€‚\r\n- ç”Ÿäº§ç¯å¢ƒé›†æˆ `Rollup` æ‰“åŒ…ï¼Œä¸å¼€å‘ç¯å¢ƒæœ€ç»ˆæ‰§è¡Œçš„ä»£ç ä¸ä¸€è‡´ã€‚\r\n\r\n### ä¸ webpack å¯¹æ¯”\r\n\r\nç”±äº `Vite` ä¸»æ‰“çš„æ˜¯å¼€å‘ç¯å¢ƒçš„æè‡´ä½“éªŒï¼Œç”Ÿäº§ç¯å¢ƒé›†æˆ `Rollup`ï¼Œè¿™é‡Œçš„å¯¹æ¯”ä¸»è¦æ˜¯ `Webpack-dev-server` ä¸ `Vite-dev-server` çš„å¯¹æ¯”ï¼š\r\n\r\n- åˆ°ç›®å‰å¾ˆé•¿æ—¶é—´ä»¥æ¥ `Webpack` åœ¨å‰ç«¯å·¥ç¨‹é¢†åŸŸå ç»Ÿæ²»åœ°ä½ï¼Œ`Vite` æ¨å‡ºä»¥æ¥å¤‡å—å…³æ³¨ï¼Œç¤¾åŒºæ´»è·ƒï¼Œ`GitHub star` æ•°é‡æ¿€å¢ï¼Œç›®å‰è¾¾åˆ°\r\n![image](https://github.com/hankliu62/interview/assets/8088864/d3e2613d-64d4-41f6-9bb7-02018d31b394)\r\n\r\n- `Webpack` é…ç½®ä¸°å¯Œä½¿ç”¨æä¸ºçµæ´»ä½†ä¸Šæ‰‹æˆæœ¬é«˜ï¼Œ`Vite` å¼€ç®±å³ç”¨é…ç½®é«˜åº¦é›†æˆ\r\n- `Webpack` å¯åŠ¨æœåŠ¡éœ€æ‰“åŒ…æ„å»ºï¼Œé€Ÿåº¦æ…¢ï¼Œ`Vite` å…ç¼–è¯‘å¯ç§’å¼€\r\n- `Webpack` çƒ­æ›´æ–°éœ€æ‰“åŒ…æ„å»ºï¼Œé€Ÿåº¦æ…¢ï¼Œ`Vite` æ¯«ç§’å“åº”\r\n- `Webpack` æˆç†Ÿç¨³å®šã€èµ„æºä¸°å¯Œã€å¤§é‡å®è·µæ¡ˆä¾‹ï¼Œ`Vite` å®è·µè¾ƒå°‘\r\n- `Vite` ä½¿ç”¨ `esbuild` ç¼–è¯‘ï¼Œæ„å»ºé€Ÿåº¦æ¯” `webpack` å¿«å‡ ä¸ªæ•°é‡çº§\r\n\r\n### å…¼å®¹æ€§\r\n\r\n- é»˜è®¤ç›®æ ‡æµè§ˆå™¨æ˜¯åœ¨ `script` æ ‡ç­¾ä¸Šæ”¯æŒåŸç”Ÿ `ESM` å’Œ åŸç”Ÿ `ESM` åŠ¨æ€å¯¼å…¥\r\n- å¯ä½¿ç”¨å®˜æ–¹æ’ä»¶ `@vitejs/plugin-legacy`ï¼Œè½¬ä¹‰æˆä¼ ç»Ÿç‰ˆæœ¬å’Œç›¸å¯¹åº”çš„ `polyfill`\r\n- \r\n### æœªæ¥æ¢ç´¢\r\n- ä¼ ç»Ÿæ„å»ºå·¥å…·æ€§èƒ½å·²åˆ°ç“¶é¢ˆï¼Œä¸»æ‰“å¼€å‘ä½“éªŒçš„ `Vite`ï¼Œå¯èƒ½ä¼šå—åˆ°æ¬¢è¿ã€‚\r\n- ä¸»æµæµè§ˆå™¨åŸºæœ¬æ”¯æŒ `ESM`ï¼Œ`ESM` å°†æˆä¸ºä¸»æµã€‚\r\n- `Vite` åœ¨ `Vue3.0` ä»£æ›¿ `vue-cli`ï¼Œä½œä¸ºå®˜æ–¹è„šæ‰‹æ¶ï¼Œä¼šå¤§å¤§æé«˜ä½¿ç”¨é‡ã€‚\r\n- `Vite2.0` æ¨å‡ºåï¼Œå·²å¯ä»¥åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ `Vite`ã€‚\r\n- å¦‚æœè§‰å¾—ç›´æ¥ä½¿ç”¨ `Vite` å¤ªå†’é™©ï¼Œåˆç¡®å®æœ‰ `dev server` é€Ÿåº¦æ…¢çš„é—®é¢˜éœ€è¦è§£å†³ï¼Œå¯ä»¥å°è¯•ç”¨ `Vite` å•ç‹¬æ­å»ºä¸€å¥— `dev server`\r\n\r\n### ç›¸å…³èµ„æº\r\n\r\nå®˜æ–¹æ’ä»¶\r\né™¤äº†æ”¯æŒç°æœ‰çš„ `Rollup` æ’ä»¶ç³»ç»Ÿå¤–ï¼Œå®˜æ–¹æä¾›äº†å››ä¸ªæœ€å…³é”®çš„æ’ä»¶\r\n\r\n- `@vitejs/plugin-vue` æä¾› `Vue3` å•æ–‡ä»¶ç»„ä»¶æ”¯æŒ\r\n- `@vitejs/plugin-vue-jsx` æä¾› `Vue3 JSX` æ”¯æŒï¼ˆä¸“ç”¨çš„ `Babel` è½¬æ¢æ’ä»¶ï¼‰\r\n- `@vitejs/plugin-react` æä¾›å®Œæ•´çš„ `React` æ”¯æŒ\r\n- `@vitejs/plugin-legacy` ä¸ºæ‰“åŒ…åçš„æ–‡ä»¶æä¾›ä¼ ç»Ÿæµè§ˆå™¨å…¼å®¹æ€§æ”¯æŒ\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/hankliu62/interview/issues/621/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hankliu62/interview/issues/621/timeline","performed_via_github_app":null,"state_reason":null},"menus":["### èƒŒæ™¯","### å…±å­˜çš„æ¨¡å—åŒ–æ ‡å‡†","### å‘å±•ä¸­çš„æ„å»ºå·¥å…·","### å½“å‰å·¥ç¨‹åŒ–ç—›ç‚¹","### ä»€ä¹ˆæ˜¯Viteï¼Ÿ","#### æ¦‚å¿µ","#### å¼€å‘ç¯å¢ƒ","#### ç”Ÿäº§ç¯å¢ƒ","#### å¤„ç†æµç¨‹å¯¹æ¯”","### Vite åŸºæœ¬ç”¨æ³•","#### åˆ›å»ºviteé¡¹ç›®","#### é€‰å–æ¨¡æ¿","#### å¯åŠ¨","### Vite å®ç°åŸç†","#### ESbuild ç¼–è¯‘","#### ä¾èµ–é¢„æ„å»º","#### æŒ‰éœ€åŠ è½½","#### ç¼“å­˜","#### é‡å†™æ¨¡å—è·¯å¾„","### Vite æºç åˆ†æ","### ä¼˜åŠ¿","### ä¸è¶³","### ä¸ webpack å¯¹æ¯”","### å…¼å®¹æ€§","### æœªæ¥æ¢ç´¢","### ç›¸å…³èµ„æº"]},"__N_SSG":true}