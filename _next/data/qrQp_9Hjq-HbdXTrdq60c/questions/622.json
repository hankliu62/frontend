{"pageProps":{"issue":{"url":"https://api.github.com/repos/hankliu62/interview/issues/622","repository_url":"https://api.github.com/repos/hankliu62/interview","labels_url":"https://api.github.com/repos/hankliu62/interview/issues/622/labels{/name}","comments_url":"https://api.github.com/repos/hankliu62/interview/issues/622/comments","events_url":"https://api.github.com/repos/hankliu62/interview/issues/622/events","html_url":"https://github.com/hankliu62/interview/issues/622","id":2268281053,"node_id":"I_kwDOLNphd86HMzjd","number":622,"title":"Monorepo是什么，有什么作用？","user":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"labels":[{"id":6547468280,"node_id":"LA_kwDOLNphd88AAAABhkJv-A","url":"https://api.github.com/repos/hankliu62/interview/labels/project","name":"project","color":"2B80B3","default":false,"description":"项目相关"}],"state":"open","locked":false,"assignee":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"assignees":[{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/hankliu62/interview/milestones/3","html_url":"https://github.com/hankliu62/interview/milestone/3","labels_url":"https://api.github.com/repos/hankliu62/interview/milestones/3/labels","id":10707686,"node_id":"MI_kwDOLNphd84Ao2Lm","number":3,"title":"3","description":"描述问题难度，难度3🌟","creator":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"open_issues":16,"closed_issues":0,"state":"open","created_at":"2024-03-20T03:36:24Z","updated_at":"2024-05-03T08:08:15Z","due_on":null,"closed_at":null},"comments":0,"created_at":"2024-04-29T07:04:09Z","updated_at":"2024-04-29T07:05:25Z","closed_at":null,"author_association":"OWNER","active_lock_reason":null,"body":"Monorepo 是一种项目代码管理方式，指单个仓库中管理多个项目，有助于简化代码共享、依赖管理、版本控制、构建和部署等方面的复杂性，并提供更好的可重用性和协作性。Monorepo 提倡了开放、透明、共享的组织文化，这种方法已经被很多大型公司广泛使用，如 Google、Facebook 和 Microsoft 等。\r\n\r\n### 优势\r\nMonorepo 的主要优势包括：\r\n\r\n- 代码共享和重用：所有项目共享同一个代码库，这可以减少重复代码并提高开发效率。\r\n- 依赖管理简化：所有项目都使用相同的依赖项，这可以简化依赖管理并减少冲突。\r\n- 持续集成和持续交付：Monorepo 可以简化持续集成和持续交付流程，因为所有项目都可以在同一个管道中构建和测试。\r\n- 改进的协作：Monorepo 可以改善开发人员之间的协作，因为他们可以轻松地访问所有项目的代码。\r\n\r\n### Monorepo 方案\r\n\r\n#### Turborepo\r\n[Turborepo](https://link.juejin.cn/?target=https%3A%2F%2Fturbo.build%2F) 是 Vercel 团队开源的高性能构建代码仓库系统，允许开发者使用不同的构建系统。\r\n\r\n构建加速思路：\r\n\r\n- Multiple Running Task：构建任务并行进行，构建顺序交给开发者配置\r\n- Cache、Remote Cache：通过缓存 及 远程缓存，减少构建时间\r\n\r\n举例 Multiple Running Task：我们现在有一个 Monorepo 的项目，有以下几个 package：\r\n\r\n- apps/web，依赖 shared\r\n- apps/docs，依赖 shared\r\n- package/shared，被 web 和 docs 依赖\r\n\r\n``` bash\r\n# 当我们使用正常的 yarn workspace 去管理 monorepo 的工作流任务时，例如执行以下命令：\r\nyarn workspaces run lint\r\nyarn workspaces run test\r\nyarn workspaces run build\r\n```\r\n\r\n#### Nx\r\nNx 是 [Nrwl](https://link.juejin.cn/?target=https%3A%2F%2Fnx.app%2Fcompany) 团队开发的，同时在维护 Lerna，目前 Nx 可以与 Learn 5.1及以上集成使用\r\n\r\n构建加速思路（比 Turborepo 更丰富）\r\n\r\n- 缓存： 通过缓存 及 远程缓存，减少构建时间（远程缓存：Nx 公开了一个公共 API，它允许您提供自己的远程缓存实现，Turborepo 必须使用内置的远程缓存）\r\n- 增量构建： 最小范围构建，非全量构建\r\n- 并行构建： Nx 自动分析项目的关联关系，对这些任务进行排序以最大化并行性\r\n- 分布式构建： 结合 Nx Cloud，您的任务将自动分布在 CI 代理中（多台远程构建机器），同时考虑构建顺序、最大化并行化和代理利用率\r\n- 用 Nx 强大的任务调度器加速 Lerna：Lerna 擅长管理依赖关系和发布，但扩展基于 Lerna 的 Monorepos 很快就会变得很痛苦，因为 Lerna 很慢。这就是 Nx 的闪光点，也是它可以真正加速你的 monorepo 的地方。\r\n\r\n#### Lerna\r\n\r\n**[Lerna](https://link.juejin.cn/?target=https%3A%2F%2Flerna.js.org%2F) 是什么？**\r\n\r\n- Lerna 是 Babel 为实现 Monorepo 开发的工具；最擅长管理依赖关系和发布\r\n- Lerna 优化了多包工作流，解决了多包依赖、发版手动维护版本等问题\r\n- Lerna 不提供构建、测试等任务，工程能力较弱，项目中往往需要基于它进行顶层能力的封装\r\n\r\n**Lerna 主要做三件事**\r\n\r\n1. 为单个包或多个包运行命令 (lerna run)\r\n2. 管理依赖项 (lerna bootstrap)\r\n3. 发布依赖包，处理版本管理，并生成变更日志 (lerna publish)\r\n\r\n**Lerna 能解决了什么问题？**\r\n\r\n1. 代码共享，调试便捷： 一个依赖包更新，其他依赖此包的包/项目无需安装最新版本，因为 Lerna 自动 Link\r\n2. 安装依赖，减少冗余：多个包都使用相同版本的依赖包时，Lerna 优先将依赖包安装在根目录\r\n3. 规范版本管理： Lerna 通过 Git 检测代码变动，自动发版、更新版本号；两种模式管理多个依赖包的版本号\r\n4. 自动生成发版日志：使用插件，根据 Git Commit 记录，自动生成 ChangeLog\r\n\r\n**Lerna 自动检测发布，判断逻辑**\r\n\r\n- 校验本地是否有没有被 commit 内容？\r\n- 判断当前的分支是否正常？\r\n- 判断当前分支是否在 remote 存在？\r\n- 判断当前分支是否在 lerna.json 允许的 allowBranch 设置之中？\r\n- 判断当前分支提交是否落后于 remote\r\n\r\n\r\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/hankliu62/interview/issues/622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hankliu62/interview/issues/622/timeline","performed_via_github_app":null,"state_reason":null},"menus":["### 优势","### Monorepo 方案","#### Turborepo","#### Nx","#### Lerna"]},"__N_SSG":true}