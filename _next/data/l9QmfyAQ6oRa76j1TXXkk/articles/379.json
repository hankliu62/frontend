{"pageProps":{"article":{"url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/379","repository_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com","labels_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/379/labels{/name}","comments_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/379/comments","events_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/379/events","html_url":"https://github.com/hankliu62/hankliu62.github.com/issues/379","id":2125624858,"node_id":"I_kwDOBiJZIc5-snYa","number":379,"title":"IntersectionObserver","user":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"labels":[{"id":6527252877,"node_id":"LA_kwDOBiJZIc8AAAABhQ35jQ","url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/labels/interview%20questions","name":"interview questions","color":"722ed1","default":false,"description":"面试题"},{"id":6536118829,"node_id":"LA_kwDOBiJZIc8AAAABhZVCLQ","url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/labels/javascript","name":"javascript","color":"383040","default":false,"description":"分类-Javascript相关"}],"state":"open","locked":false,"assignee":{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false},"assignees":[{"login":"hankliu62","id":8088864,"node_id":"MDQ6VXNlcjgwODg4NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8088864?v=4","gravatar_id":"","url":"https://api.github.com/users/hankliu62","html_url":"https://github.com/hankliu62","followers_url":"https://api.github.com/users/hankliu62/followers","following_url":"https://api.github.com/users/hankliu62/following{/other_user}","gists_url":"https://api.github.com/users/hankliu62/gists{/gist_id}","starred_url":"https://api.github.com/users/hankliu62/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hankliu62/subscriptions","organizations_url":"https://api.github.com/users/hankliu62/orgs","repos_url":"https://api.github.com/users/hankliu62/repos","events_url":"https://api.github.com/users/hankliu62/events{/privacy}","received_events_url":"https://api.github.com/users/hankliu62/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2024-02-08T16:42:45Z","updated_at":"2024-02-09T07:19:02Z","closed_at":null,"author_association":"OWNER","active_lock_reason":null,"body":"IntersectionObserver接口(从属于Intersection Observer API)为开发者提供了一种可以异步监听目标元素与其祖先或视窗(viewport)交叉状态的手段。祖先元素与视窗(viewport)被称为根(root)。\r\n\r\n### API\r\n\r\n``` js\r\nvar io = new IntersectionObserver(callback, options)\r\n\r\nio.observe(document.querySelector('img'))  // 开始观察，接受一个DOM节点对象\r\nio.unobserve(element)  // 停止观察 接受一个element元素\r\nio.disconnect()  // 关闭观察器\r\n```\r\n\r\n#### options\r\n\r\n- root\r\n\r\n用于观察的根元素，默认是浏览器的视口，也可以指定具体元素，指定元素的时候用于观察的元素必须是指定元素的子元素\r\n\r\n- threshold\r\n\r\n用来指定交叉比例，决定什么时候触发回调函数，是一个数组，默认是[0]。\r\n\r\n``` js\r\nconst options = {\r\n    root: null,\r\n    threshold: [0, 0.5, 1] // 我们指定了交叉比例为0，0.5，1，当观察元素img0%、50%、100%时候就会触发回调函数\r\n}\r\nvar io = new IntersectionObserver(callback, options)\r\nio.observe(document.querySelector('img'))\r\n```\r\n\r\n- rootMargin\r\n\r\n用来扩大或者缩小视窗的的大小，使用css的定义方法，10px 10px 30px 20px表示top、right、bottom 和 left的值\r\n\r\n\r\n#### callback\r\n\r\ncallback函数会触发两次，元素进入视窗（开始可见时）和元素离开视窗（开始不可见时）都会触发\r\n\r\n``` ts\r\ncallback: (entries: IntersectionObserverEntry[]) => void;\r\n```\r\n\r\n### IntersectionObserverEntry\r\n\r\nIntersectionObserverEntry提供观察元素的信息，有七个属性。\r\n\r\n- boundingClientRect 目标元素的矩形信息\r\n- intersectionRatio 相交区域和目标元素的比例值 intersectionRect/boundingClientRect 不可见时小于等于0\r\n- intersectionRect 目标元素和视窗（根）相交的矩形信息 可以称为相交区域\r\n- isIntersecting 目标元素当前是否可见 Boolean值 可见为true\r\n- rootBounds 根元素的矩形信息，没有指定根元素就是当前视窗的矩形信息\r\n- target 观察的目标元素\r\n- time 返回一个记录从IntersectionObserver的时间到交叉被触发的时间的时间戳\r\n\r\n\r\n### 懒加载\r\n\r\n``` js\r\n\r\nlet io;\r\n\r\nfunction callback(entries) {\r\n  entries.forEach((item) => { // 遍历entries数组\r\n    if(item.isIntersecting) { // 当前元素可见\r\n      item.target.src = item.target.dataset.src  // 替换src\r\n      io.unobserve(item.target)  // 停止观察当前元素 避免不可见时候再次调用callback函数\r\n    }\r\n  })\r\n}\r\n\r\nio = new IntersectionObserver(callback)\r\n\r\nlet ings = document.querySelectorAll('[data-src]') // 将图片的真实url设置为data-src src属性为占位图 元素可见时候替换src\r\n\r\nimgs.forEach((item) => {  // io.observe接受一个DOM元素，添加多个监听 使用forEach\r\n  io.observe(item)\r\n})\r\n```","closed_by":null,"reactions":{"url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hankliu62/hankliu62.github.com/issues/379/timeline","performed_via_github_app":null,"state_reason":null},"menus":["### API","#### options","#### callback","### IntersectionObserverEntry","### 懒加载"]},"__N_SSG":true}